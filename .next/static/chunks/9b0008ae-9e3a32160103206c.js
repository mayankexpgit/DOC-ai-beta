"use strict";(self["webpackChunk_N_E"]=self["webpackChunk_N_E"]||[]).push([[84],{13824:(t,e,s)=>{s.d(e,{EA:()=>i7,YE:()=>ny,rE:()=>nR});var i=s(49509);var n=s(44134)["hp"];var r={};(()=>{r.d=(t,e)=>{for(var s in e){if(r.o(e,s)&&!r.o(t,s)){Object.defineProperty(t,s,{enumerable:true,get:e[s]})}}}})();(()=>{r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e)})();var a=globalThis.pdfjsLib={};r.d(a,{AbortException:()=>Y,AnnotationEditorLayer:()=>iq,AnnotationEditorParamsType:()=>A,AnnotationEditorType:()=>b,AnnotationEditorUIManager:()=>tJ,AnnotationLayer:()=>iM,AnnotationMode:()=>g,ColorPicker:()=>iB,DOMSVGFactory:()=>s3,DrawLayer:()=>iK,FeatureTest:()=>tn,GlobalWorkerOptions:()=>e2,ImageKind:()=>w,InvalidPDFException:()=>W,MissingPDFException:()=>q,OPS:()=>R,OutputScale:()=>t$,PDFDataRangeTransport:()=>sU,PDFDateString:()=>tF,PDFWorker:()=>sV,PasswordResponses:()=>k,PermissionFlag:()=>v,PixelsPerInch:()=>t_,RenderingCancelledException:()=>tS,TextLayer:()=>sT,TouchManager:()=>t0,UnexpectedResponseException:()=>K,Util:()=>ta,VerbosityLevel:()=>I,XfaLayer:()=>s5,build:()=>sJ,createValidAbsoluteUrl:()=>U,fetchData:()=>tx,getDocument:()=>sO,getFilenameFromUrl:()=>tM,getPdfFilenameFromUrl:()=>tP,getXfaPageViewport:()=>tO,isDataScheme:()=>tC,isPdfFile:()=>tT,noContextMenu:()=>tk,normalizeUnicode:()=>tg,setLayerDimensions:()=>tU,shadow:()=>$,stopEvent:()=>tD,version:()=>sQ});const o=typeof i==="object"&&i+""==="[object process]"&&!i.versions.nw&&!(i.versions.electron&&i.type&&i.type!=="browser");const l=[1,0,0,1,0,0];const h=[.001,0,0,.001,0,0];const c=1e7;const d=1.35;const u=.35;const f=u/d;const p={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256};const g={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};const m="pdfjs_internal_editor_";const b={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15};const A={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41};const v={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};const y={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};const w={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};const _={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};const x={GROUP:"Group",REPLY:"R"};const E={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};const S={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:0x1000000,RICHTEXT:0x2000000,RADIOSINUNISON:0x2000000,COMMITONSELCHANGE:0x4000000};const C={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};const T={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};const M={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};const P={O:"PageOpen",C:"PageClose"};const I={ERRORS:0,WARNINGS:1,INFOS:5};const R={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93};const k={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let D=I.WARNINGS;function L(t){if(Number.isInteger(t)){D=t}}function F(){return D}function O(t){if(D>=I.INFOS){console.log(`Info: ${t}`)}}function N(t){if(D>=I.WARNINGS){console.log(`Warning: ${t}`)}}function B(t){throw new Error(t)}function H(t,e){if(!t){B(e)}}function z(t){switch(t?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return true;default:return false}}function U(t,e=null,s=null){if(!t){return null}try{if(s&&typeof t==="string"){if(s.addDefaultProtocol&&t.startsWith("www.")){const e=t.match(/\./g);if(e?.length>=2){t=`http://${t}`}}if(s.tryConvertEncoding){try{t=th(t)}catch{}}}const i=e?new URL(t,e):new URL(t);if(z(i)){return i}}catch{}return null}function $(t,e,s,i=false){Object.defineProperty(t,e,{value:s,enumerable:!i,configurable:true,writable:false});return s}const G=function t(){function t(t,e){this.message=t;this.name=e}t.prototype=new Error;t.constructor=t;return t}();class j extends G{constructor(t,e){super(t,"PasswordException");this.code=e}}class V extends G{constructor(t,e){super(t,"UnknownErrorException");this.details=e}}class W extends G{constructor(t){super(t,"InvalidPDFException")}}class q extends G{constructor(t){super(t,"MissingPDFException")}}class K extends G{constructor(t,e){super(t,"UnexpectedResponseException");this.status=e}}class X extends G{constructor(t){super(t,"FormatError")}}class Y extends G{constructor(t){super(t,"AbortException")}}function Q(t){if(typeof t!=="object"||t?.length===undefined){B("Invalid argument for bytesToString")}const e=t.length;const s=8192;if(e<s){return String.fromCharCode.apply(null,t)}const i=[];for(let n=0;n<e;n+=s){const r=Math.min(n+s,e);const a=t.subarray(n,r);i.push(String.fromCharCode.apply(null,a))}return i.join("")}function J(t){if(typeof t!=="string"){B("Invalid argument for stringToBytes")}const e=t.length;const s=new Uint8Array(e);for(let i=0;i<e;++i){s[i]=t.charCodeAt(i)&255}return s}function Z(t){return String.fromCharCode(t>>24&255,t>>16&255,t>>8&255,t&255)}function tt(t){return Object.keys(t).length}function te(t){const e=Object.create(null);for(const[s,i]of t){e[s]=i}return e}function ts(){const t=new Uint8Array(4);t[0]=1;const e=new Uint32Array(t.buffer,0,1);return e[0]===1}function ti(){try{new Function("");return true}catch{return false}}class tn{static get isLittleEndian(){return $(this,"isLittleEndian",ts())}static get isEvalSupported(){return $(this,"isEvalSupported",ti())}static get isOffscreenCanvasSupported(){return $(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas!=="undefined")}static get isImageDecoderSupported(){return $(this,"isImageDecoderSupported",typeof ImageDecoder!=="undefined")}static get platform(){if(typeof navigator!=="undefined"&&typeof navigator?.platform==="string"){return $(this,"platform",{isMac:navigator.platform.includes("Mac"),isWindows:navigator.platform.includes("Win"),isFirefox:typeof navigator?.userAgent==="string"&&navigator.userAgent.includes("Firefox")})}return $(this,"platform",{isMac:false,isWindows:false,isFirefox:false})}static get isCSSRoundSupported(){return $(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const tr=Array.from(Array(256).keys(),t=>t.toString(16).padStart(2,"0"));class ta{static makeHexColor(t,e,s){return`#${tr[t]}${tr[e]}${tr[s]}`}static scaleMinMax(t,e){let s;if(t[0]){if(t[0]<0){s=e[0];e[0]=e[2];e[2]=s}e[0]*=t[0];e[2]*=t[0];if(t[3]<0){s=e[1];e[1]=e[3];e[3]=s}e[1]*=t[3];e[3]*=t[3]}else{s=e[0];e[0]=e[1];e[1]=s;s=e[2];e[2]=e[3];e[3]=s;if(t[1]<0){s=e[1];e[1]=e[3];e[3]=s}e[1]*=t[1];e[3]*=t[1];if(t[2]<0){s=e[0];e[0]=e[2];e[2]=s}e[0]*=t[2];e[2]*=t[2]}e[0]+=t[4];e[1]+=t[5];e[2]+=t[4];e[3]+=t[5]}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static applyTransform(t,e){const s=t[0]*e[0]+t[1]*e[2]+e[4];const i=t[0]*e[1]+t[1]*e[3]+e[5];return[s,i]}static applyInverseTransform(t,e){const s=e[0]*e[3]-e[1]*e[2];const i=(t[0]*e[3]-t[1]*e[2]+e[2]*e[5]-e[4]*e[3])/s;const n=(-t[0]*e[1]+t[1]*e[0]+e[4]*e[1]-e[5]*e[0])/s;return[i,n]}static getAxialAlignedBoundingBox(t,e){const s=this.applyTransform(t,e);const i=this.applyTransform(t.slice(2,4),e);const n=this.applyTransform([t[0],t[3]],e);const r=this.applyTransform([t[2],t[1]],e);return[Math.min(s[0],i[0],n[0],r[0]),Math.min(s[1],i[1],n[1],r[1]),Math.max(s[0],i[0],n[0],r[0]),Math.max(s[1],i[1],n[1],r[1])]}static inverseTransform(t){const e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t){const e=[t[0],t[2],t[1],t[3]];const s=t[0]*e[0]+t[1]*e[2];const i=t[0]*e[1]+t[1]*e[3];const n=t[2]*e[0]+t[3]*e[2];const r=t[2]*e[1]+t[3]*e[3];const a=(s+r)/2;const o=Math.sqrt((s+r)**2-4*(s*r-n*i))/2;const l=a+o||1;const h=a-o||1;return[Math.sqrt(l),Math.sqrt(h)]}static normalizeRect(t){const e=t.slice(0);if(t[0]>t[2]){e[0]=t[2];e[2]=t[0]}if(t[1]>t[3]){e[1]=t[3];e[3]=t[1]}return e}static intersect(t,e){const s=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2]));const i=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(s>i){return null}const n=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3]));const r=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));if(n>r){return null}return[s,n,i,r]}static #t(t,e,s,i,n,r,a,o,l,h){if(l<=0||l>=1){return}const c=1-l;const d=l*l;const u=d*l;const f=c*(c*(c*t+3*l*e)+3*d*s)+u*i;const p=c*(c*(c*n+3*l*r)+3*d*a)+u*o;h[0]=Math.min(h[0],f);h[1]=Math.min(h[1],p);h[2]=Math.max(h[2],f);h[3]=Math.max(h[3],p)}static #e(t,e,s,i,n,r,a,o,l,h,c,d){if(Math.abs(l)<1e-12){if(Math.abs(h)>=1e-12){this.#t(t,e,s,i,n,r,a,o,-c/h,d)}return}const u=h**2-4*c*l;if(u<0){return}const f=Math.sqrt(u);const p=2*l;this.#t(t,e,s,i,n,r,a,o,(-h+f)/p,d);this.#t(t,e,s,i,n,r,a,o,(-h-f)/p,d)}static bezierBoundingBox(t,e,s,i,n,r,a,o,l){if(l){l[0]=Math.min(l[0],t,a);l[1]=Math.min(l[1],e,o);l[2]=Math.max(l[2],t,a);l[3]=Math.max(l[3],e,o)}else{l=[Math.min(t,a),Math.min(e,o),Math.max(t,a),Math.max(e,o)]}this.#e(t,s,n,a,e,i,r,o,3*(-t+3*(s-n)+a),6*(t-2*s+n),3*(s-t),l);this.#e(t,s,n,a,e,i,r,o,3*(-e+3*(i-r)+o),6*(e-2*i+r),3*(i-e),l);return l}}const to=null&&null&&0;function tl(t){if(t[0]>="\xef"){let e;if(t[0]==="\xfe"&&t[1]==="\xff"){e="utf-16be";if(t.length%2===1){t=t.slice(0,-1)}}else if(t[0]==="\xff"&&t[1]==="\xfe"){e="utf-16le";if(t.length%2===1){t=t.slice(0,-1)}}else if(t[0]==="\xef"&&t[1]==="\xbb"&&t[2]==="\xbf"){e="utf-8"}if(e){try{const s=new TextDecoder(e,{fatal:true});const i=J(t);const n=s.decode(i);if(!n.includes("\x1b")){return n}return n.replaceAll(/\x1b[^\x1b]*(?:\x1b|$)/g,"")}catch(t){N(`stringToPDFString: "${t}".`)}}}const e=[];for(let s=0,i=t.length;s<i;s++){const n=t.charCodeAt(s);if(n===27){while(++s<i&&t.charCodeAt(s)!==27){}continue}const r=to[n];e.push(r?String.fromCharCode(r):t.charAt(s))}return e.join("")}function th(t){return decodeURIComponent(escape(t))}function tc(t){return unescape(encodeURIComponent(t))}function td(t,e){if(t.length!==e.length){return false}for(let s=0,i=t.length;s<i;s++){if(t[s]!==e[s]){return false}}return true}function tu(t=new Date){const e=[t.getUTCFullYear().toString(),(t.getUTCMonth()+1).toString().padStart(2,"0"),t.getUTCDate().toString().padStart(2,"0"),t.getUTCHours().toString().padStart(2,"0"),t.getUTCMinutes().toString().padStart(2,"0"),t.getUTCSeconds().toString().padStart(2,"0")];return e.join("")}let tf=null;let tp=null;function tg(t){if(!tf){tf=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu;tp=new Map([["ﬅ","ſt"]])}return t.replaceAll(tf,(t,e,s)=>e?e.normalize("NFKC"):tp.get(s))}function tm(){if(typeof crypto.randomUUID==="function"){return crypto.randomUUID()}const t=new Uint8Array(32);crypto.getRandomValues(t);return Q(t)}const tb="pdfjs_internal_id_";function tA(t){if(Uint8Array.prototype.toHex){return t.toHex()}return Array.from(t,t=>tr[t]).join("")}function tv(t){if(Uint8Array.prototype.toBase64){return t.toBase64()}return btoa(Q(t))}function ty(t){if(Uint8Array.fromBase64){return Uint8Array.fromBase64(t)}return J(atob(t))}if(typeof Promise.try!=="function"){Promise.try=function(t,...e){return new Promise(s=>{s(t(...e))})}};const tw="http://www.w3.org/2000/svg";class t_{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function tx(t,e="text"){if(tR(t,document.baseURI)){const s=await fetch(t);if(!s.ok){throw new Error(s.statusText)}switch(e){case"arraybuffer":return s.arrayBuffer();case"blob":return s.blob();case"json":return s.json()}return s.text()}return new Promise((s,i)=>{const n=new XMLHttpRequest;n.open("GET",t,true);n.responseType=e;n.onreadystatechange=()=>{if(n.readyState!==XMLHttpRequest.DONE){return}if(n.status===200||n.status===0){switch(e){case"arraybuffer":case"blob":case"json":s(n.response);return}s(n.responseText);return}i(new Error(n.statusText))};n.send(null)})}class tE{constructor({viewBox:t,userUnit:e,scale:s,rotation:i,offsetX:n=0,offsetY:r=0,dontFlip:a=false}){this.viewBox=t;this.userUnit=e;this.scale=s;this.rotation=i;this.offsetX=n;this.offsetY=r;s*=e;const o=(t[2]+t[0])/2;const l=(t[3]+t[1])/2;let h,c,d,u;i%=360;if(i<0){i+=360}switch(i){case 180:h=-1;c=0;d=0;u=1;break;case 90:h=0;c=1;d=1;u=0;break;case 270:h=0;c=-1;d=-1;u=0;break;case 0:h=1;c=0;d=0;u=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}if(a){d=-d;u=-u}let f,p;let g,m;if(h===0){f=Math.abs(l-t[1])*s+n;p=Math.abs(o-t[0])*s+r;g=(t[3]-t[1])*s;m=(t[2]-t[0])*s}else{f=Math.abs(o-t[0])*s+n;p=Math.abs(l-t[1])*s+r;g=(t[2]-t[0])*s;m=(t[3]-t[1])*s}this.transform=[h*s,c*s,d*s,u*s,f-h*s*o-d*s*l,p-c*s*o-u*s*l];this.width=g;this.height=m}get rawDims(){const{userUnit:t,viewBox:e}=this;const s=e.map(e=>e*t);return $(this,"rawDims",{pageWidth:s[2]-s[0],pageHeight:s[3]-s[1],pageX:s[0],pageY:s[1]})}clone({scale:t=this.scale,rotation:e=this.rotation,offsetX:s=this.offsetX,offsetY:i=this.offsetY,dontFlip:n=false}={}){return new tE({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:t,rotation:e,offsetX:s,offsetY:i,dontFlip:n})}convertToViewportPoint(t,e){return ta.applyTransform([t,e],this.transform)}convertToViewportRectangle(t){const e=ta.applyTransform([t[0],t[1]],this.transform);const s=ta.applyTransform([t[2],t[3]],this.transform);return[e[0],e[1],s[0],s[1]]}convertToPdfPoint(t,e){return ta.applyInverseTransform([t,e],this.transform)}}class tS extends G{constructor(t,e=0){super(t,"RenderingCancelledException");this.extraDelay=e}}function tC(t){const e=t.length;let s=0;while(s<e&&t[s].trim()===""){s++}return t.substring(s,s+5).toLowerCase()==="data:"}function tT(t){return typeof t==="string"&&/\.pdf$/i.test(t)}function tM(t){[t]=t.split(/[#?]/,1);return t.substring(t.lastIndexOf("/")+1)}function tP(t,e="document.pdf"){if(typeof t!=="string"){return e}if(tC(t)){N('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.');return e}const s=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/;const i=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i;const n=s.exec(t);let r=i.exec(n[1])||i.exec(n[2])||i.exec(n[3]);if(r){r=r[0];if(r.includes("%")){try{r=i.exec(decodeURIComponent(r))[0]}catch{}}}return r||e}class tI{started=Object.create(null);times=[];time(t){if(t in this.started){N(`Timer is already running for ${t}`)}this.started[t]=Date.now()}timeEnd(t){if(!(t in this.started)){N(`Timer has not been started for ${t}`)}this.times.push({name:t,start:this.started[t],end:Date.now()});delete this.started[t]}toString(){const t=[];let e=0;for(const{name:t}of this.times){e=Math.max(t.length,e)}for(const{name:s,start:i,end:n}of this.times){t.push(`${s.padEnd(e)} ${n-i}ms
`)}return t.join("")}}function tR(t,e){try{const{protocol:s}=e?new URL(t,e):new URL(t);return s==="http:"||s==="https:"}catch{return false}}function tk(t){t.preventDefault()}function tD(t){t.preventDefault();t.stopPropagation()}function tL(t){console.log("Deprecated API usage: "+t)}class tF{static #s;static toDateObject(t){if(!t||typeof t!=="string"){return null}this.#s||=new RegExp("^D:"+"(\\d{4})"+"(\\d{2})?"+"(\\d{2})?"+"(\\d{2})?"+"(\\d{2})?"+"(\\d{2})?"+"([Z|+|-])?"+"(\\d{2})?"+"'?"+"(\\d{2})?"+"'?");const e=this.#s.exec(t);if(!e){return null}const s=parseInt(e[1],10);let i=parseInt(e[2],10);i=i>=1&&i<=12?i-1:0;let n=parseInt(e[3],10);n=n>=1&&n<=31?n:1;let r=parseInt(e[4],10);r=r>=0&&r<=23?r:0;let a=parseInt(e[5],10);a=a>=0&&a<=59?a:0;let o=parseInt(e[6],10);o=o>=0&&o<=59?o:0;const l=e[7]||"Z";let h=parseInt(e[8],10);h=h>=0&&h<=23?h:0;let c=parseInt(e[9],10)||0;c=c>=0&&c<=59?c:0;if(l==="-"){r+=h;a+=c}else if(l==="+"){r-=h;a-=c}return new Date(Date.UTC(s,i,n,r,a,o))}}function tO(t,{scale:e=1,rotation:s=0}){const{width:i,height:n}=t.attributes.style;const r=[0,0,parseInt(i),parseInt(n)];return new tE({viewBox:r,userUnit:1,scale:e,rotation:s})}function tN(t){if(t.startsWith("#")){const e=parseInt(t.slice(1),16);return[(e&0xff0000)>>16,(e&65280)>>8,e&255]}if(t.startsWith("rgb(")){return t.slice(4,-1).split(",").map(t=>parseInt(t))}if(t.startsWith("rgba(")){return t.slice(5,-1).split(",").map(t=>parseInt(t)).slice(0,3)}N(`Not a valid color format: "${t}"`);return[0,0,0]}function tB(t){const e=document.createElement("span");e.style.visibility="hidden";document.body.append(e);for(const s of t.keys()){e.style.color=s;const i=window.getComputedStyle(e).color;t.set(s,tN(i))}e.remove()}function tH(t){const{a:e,b:s,c:i,d:n,e:r,f:a}=t.getTransform();return[e,s,i,n,r,a]}function tz(t){const{a:e,b:s,c:i,d:n,e:r,f:a}=t.getTransform().invertSelf();return[e,s,i,n,r,a]}function tU(t,e,s=false,i=true){if(e instanceof tE){const{pageWidth:i,pageHeight:n}=e.rawDims;const{style:r}=t;const a=tn.isCSSRoundSupported;const o=`var(--scale-factor) * ${i}px`,l=`var(--scale-factor) * ${n}px`;const h=a?`round(down, ${o}, var(--scale-round-x, 1px))`:`calc(${o})`,c=a?`round(down, ${l}, var(--scale-round-y, 1px))`:`calc(${l})`;if(!s||e.rotation%180===0){r.width=h;r.height=c}else{r.width=c;r.height=h}}if(i){t.setAttribute("data-main-rotation",e.rotation)}}class t${constructor(){const t=window.devicePixelRatio||1;this.sx=t;this.sy=t}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}};class tG{#i=null;#n=null;#r;#a=null;#o=null;static #l=null;constructor(t){this.#r=t;tG.#l||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button"})}render(){const t=this.#i=document.createElement("div");t.classList.add("editToolbar","hidden");t.setAttribute("role","toolbar");const e=this.#r._uiManager._signal;t.addEventListener("contextmenu",tk,{signal:e});t.addEventListener("pointerdown",tG.#h,{signal:e});const s=this.#a=document.createElement("div");s.className="buttons";t.append(s);const i=this.#r.toolbarPosition;if(i){const{style:e}=t;const s=this.#r._uiManager.direction==="ltr"?1-i[0]:i[0];e.insetInlineEnd=`${100*s}%`;e.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}this.#c();return t}get div(){return this.#i}static #h(t){t.stopPropagation()}#d(t){this.#r._focusEventsAllowed=false;tD(t)}#u(t){this.#r._focusEventsAllowed=true;tD(t)}#f(t){const e=this.#r._uiManager._signal;t.addEventListener("focusin",this.#d.bind(this),{capture:true,signal:e});t.addEventListener("focusout",this.#u.bind(this),{capture:true,signal:e});t.addEventListener("contextmenu",tk,{signal:e})}hide(){this.#i.classList.add("hidden");this.#n?.hideDropdown()}show(){this.#i.classList.remove("hidden");this.#o?.shown()}#c(){const{editorType:t,_uiManager:e}=this.#r;const s=document.createElement("button");s.className="delete";s.tabIndex=0;s.setAttribute("data-l10n-id",tG.#l[t]);this.#f(s);s.addEventListener("click",t=>{e.delete()},{signal:e._signal});this.#a.append(s)}get #p(){const t=document.createElement("div");t.className="divider";return t}async addAltText(t){const e=await t.render();this.#f(e);this.#a.prepend(e,this.#p);this.#o=t}addColorPicker(t){this.#n=t;const e=t.renderButton();this.#f(e);this.#a.prepend(e,this.#p)}remove(){this.#i.remove();this.#n?.destroy();this.#n=null}}class tj{#a=null;#i=null;#g;constructor(t){this.#g=t}#m(){const t=this.#i=document.createElement("div");t.className="editToolbar";t.setAttribute("role","toolbar");t.addEventListener("contextmenu",tk,{signal:this.#g._signal});const e=this.#a=document.createElement("div");e.className="buttons";t.append(e);this.#b();return t}#A(t,e){let s=0;let i=0;for(const n of t){const t=n.y+n.height;if(t<s){continue}const r=n.x+(e?n.width:0);if(t>s){i=r;s=t;continue}if(e){if(r>i){i=r}}else if(r<i){i=r}}return[e?1-i:i,s]}show(t,e,s){const[i,n]=this.#A(e,s);const{style:r}=this.#i||=this.#m();t.append(this.#i);r.insetInlineEnd=`${100*i}%`;r.top=`calc(${100*n}% + var(--editor-toolbar-vert-offset))`}hide(){this.#i.remove()}#b(){const t=document.createElement("button");t.className="highlightButton";t.tabIndex=0;t.setAttribute("data-l10n-id",`pdfjs-highlight-floating-button1`);const e=document.createElement("span");t.append(e);e.className="visuallyHidden";e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const s=this.#g._signal;t.addEventListener("contextmenu",tk,{signal:s});t.addEventListener("click",()=>{this.#g.highlightSelection("floating_button")},{signal:s});this.#a.append(t)}};function tV(t,e,s){for(const i of s){e.addEventListener(i,t[i].bind(t))}}function tW(t){return Math.round(Math.min(255,Math.max(1,255*t))).toString(16).padStart(2,"0")}class tq{#v=0;get id(){return`${m}${this.#v++}`}}class tK{#y=tm();#v=0;#w=null;static get _isSVGFittingCanvas(){const t=`data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>`;const e=new OffscreenCanvas(1,3);const s=e.getContext("2d",{willReadFrequently:true});const i=new Image;i.src=t;const n=i.decode().then(()=>{s.drawImage(i,0,0,1,1,0,0,1,3);return new Uint32Array(s.getImageData(0,0,1,1).data.buffer)[0]===0});return $(this,"_isSVGFittingCanvas",n)}async #_(t,e){this.#w||=new Map;let s=this.#w.get(t);if(s===null){return null}if(s?.bitmap){s.refCounter+=1;return s}try{s||={bitmap:null,id:`image_${this.#y}_${this.#v++}`,refCounter:0,isSvg:false};let t;if(typeof e==="string"){s.url=e;t=await tx(e,"blob")}else if(e instanceof File){t=s.file=e}else if(e instanceof Blob){t=e}if(t.type==="image/svg+xml"){const e=tK._isSVGFittingCanvas;const i=new FileReader;const n=new Image;const r=new Promise((t,r)=>{n.onload=()=>{s.bitmap=n;s.isSvg=true;t()};i.onload=async()=>{const t=s.svgUrl=i.result;n.src=await e?`${t}#svgView(preserveAspectRatio(none))`:t};n.onerror=i.onerror=r});i.readAsDataURL(t);await r}else{s.bitmap=await createImageBitmap(t)}s.refCounter=1}catch(t){N(t);s=null}this.#w.set(t,s);if(s){this.#w.set(s.id,s)}return s}async getFromFile(t){const{lastModified:e,name:s,size:i,type:n}=t;return this.#_(`${e}_${s}_${i}_${n}`,t)}async getFromUrl(t){return this.#_(t,t)}async getFromBlob(t,e){const s=await e;return this.#_(t,s)}async getFromId(t){this.#w||=new Map;const e=this.#w.get(t);if(!e){return null}if(e.bitmap){e.refCounter+=1;return e}if(e.file){return this.getFromFile(e.file)}if(e.blobPromise){const{blobPromise:t}=e;delete e.blobPromise;return this.getFromBlob(e.id,t)}return this.getFromUrl(e.url)}getFromCanvas(t,e){this.#w||=new Map;let s=this.#w.get(t);if(s?.bitmap){s.refCounter+=1;return s}const i=new OffscreenCanvas(e.width,e.height);const n=i.getContext("2d");n.drawImage(e,0,0);s={bitmap:i.transferToImageBitmap(),id:`image_${this.#y}_${this.#v++}`,refCounter:1,isSvg:false};this.#w.set(t,s);this.#w.set(s.id,s);return s}getSvgUrl(t){const e=this.#w.get(t);if(!e?.isSvg){return null}return e.svgUrl}deleteId(t){this.#w||=new Map;const e=this.#w.get(t);if(!e){return}e.refCounter-=1;if(e.refCounter!==0){return}const{bitmap:s}=e;if(!e.url&&!e.file){const t=new OffscreenCanvas(s.width,s.height);const i=t.getContext("bitmaprenderer");i.transferFromImageBitmap(s);e.blobPromise=t.convertToBlob()}s.close?.();e.bitmap=null}isValidId(t){return t.startsWith(`image_${this.#y}_`)}}class tX{#x=[];#E=false;#S;#C=-1;constructor(t=128){this.#S=t}add({cmd:t,undo:e,post:s,mustExec:i,type:n=NaN,overwriteIfSameType:r=false,keepUndo:a=false}){if(i){t()}if(this.#E){return}const o={cmd:t,undo:e,post:s,type:n};if(this.#C===-1){if(this.#x.length>0){this.#x.length=0}this.#C=0;this.#x.push(o);return}if(r&&this.#x[this.#C].type===n){if(a){o.undo=this.#x[this.#C].undo}this.#x[this.#C]=o;return}const l=this.#C+1;if(l===this.#S){this.#x.splice(0,1)}else{this.#C=l;if(l<this.#x.length){this.#x.splice(l)}}this.#x.push(o)}undo(){if(this.#C===-1){return}this.#E=true;const{undo:t,post:e}=this.#x[this.#C];t();e?.();this.#E=false;this.#C-=1}redo(){if(this.#C<this.#x.length-1){this.#C+=1;this.#E=true;const{cmd:t,post:e}=this.#x[this.#C];t();e?.();this.#E=false}}hasSomethingToUndo(){return this.#C!==-1}hasSomethingToRedo(){return this.#C<this.#x.length-1}cleanType(t){if(this.#C===-1){return}for(let e=this.#C;e>=0;e--){if(this.#x[e].type!==t){this.#x.splice(e+1,this.#C-e);this.#C=e;return}}this.#x.length=0;this.#C=-1}destroy(){this.#x=null}}class tY{constructor(t){this.buffer=[];this.callbacks=new Map;this.allKeys=new Set;const{isMac:e}=tn.platform;for(const[s,i,n={}]of t){for(const t of s){const s=t.startsWith("mac+");if(e&&s){this.callbacks.set(t.slice(4),{callback:i,options:n});this.allKeys.add(t.split("+").at(-1))}else if(!e&&!s){this.callbacks.set(t,{callback:i,options:n});this.allKeys.add(t.split("+").at(-1))}}}}#T(t){if(t.altKey){this.buffer.push("alt")}if(t.ctrlKey){this.buffer.push("ctrl")}if(t.metaKey){this.buffer.push("meta")}if(t.shiftKey){this.buffer.push("shift")}this.buffer.push(t.key);const e=this.buffer.join("+");this.buffer.length=0;return e}exec(t,e){if(!this.allKeys.has(e.key)){return}const s=this.callbacks.get(this.#T(e));if(!s){return}const{callback:i,options:{bubbles:n=false,args:r=[],checker:a=null}}=s;if(a&&!a(t,e)){return}i.bind(t,...r,e)();if(!n){tD(e)}}}class tQ{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const t=new Map([["CanvasText",null],["Canvas",null]]);tB(t);return $(this,"_colors",t)}convert(t){const e=tN(t);if(!window.matchMedia("(forced-colors: active)").matches){return e}for(const[t,s]of this._colors){if(s.every((t,s)=>t===e[s])){return tQ._colorsMapping.get(t)}}return e}getHexCode(t){const e=this._colors.get(t);if(!e){return t}return ta.makeHexColor(...e)}}class tJ{#M=new AbortController;#P=null;#I=new Map;#R=new Map;#k=null;#D=null;#L=null;#F=new tX;#O=null;#N=null;#B=0;#H=new Set;#z=null;#U=null;#$=new Set;_editorUndoBar=null;#G=false;#j=false;#V=false;#W=null;#q=null;#K=null;#X=null;#Y=false;#Q=null;#J=new tq;#Z=false;#tt=false;#te=null;#ts=null;#ti=null;#tn=null;#tr=b.NONE;#ta=new Set;#to=null;#tl=null;#th=null;#tc={isEditing:false,isEmpty:true,hasSomethingToUndo:false,hasSomethingToRedo:false,hasSelectedEditor:false,hasSelectedText:false};#td=[0,0];#tu=null;#tf=null;#tp=null;#tg=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const t=tJ.prototype;const e=t=>t.#tf.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&t.hasSomethingToControl();const s=(t,{target:e})=>{if(e instanceof HTMLInputElement){const{type:t}=e;return t!=="text"&&t!=="number"}return true};const i=this.TRANSLATE_SMALL;const n=this.TRANSLATE_BIG;return $(this,"_keyboardManager",new tY([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:s}],[["ctrl+z","mac+meta+z"],t.undo,{checker:s}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:s}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:s}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(t,{target:e})=>!(e instanceof HTMLButtonElement)&&t.#tf.contains(e)&&!t.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(t,{target:e})=>!(e instanceof HTMLButtonElement)&&t.#tf.contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-i,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-n,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[i,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[n,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-i],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-n],checker:e}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,i],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,n],checker:e}]]))}constructor(t,e,s,i,n,r,a,o,l,h,c,d,u){const f=this._signal=this.#M.signal;this.#tf=t;this.#tp=e;this.#k=s;this._eventBus=i;i._on("editingaction",this.onEditingAction.bind(this),{signal:f});i._on("pagechanging",this.onPageChanging.bind(this),{signal:f});i._on("scalechanging",this.onScaleChanging.bind(this),{signal:f});i._on("rotationchanging",this.onRotationChanging.bind(this),{signal:f});i._on("setpreference",this.onSetPreference.bind(this),{signal:f});i._on("switchannotationeditorparams",t=>this.updateParams(t.type,t.value),{signal:f});this.#tm();this.#tb();this.#tA();this.#D=n.annotationStorage;this.#W=n.filterFactory;this.#tl=r;this.#X=a||null;this.#G=o;this.#j=l;this.#V=h;this.#tn=c||null;this.viewParameters={realScale:t_.PDF_TO_CSS_UNITS,rotation:0};this.isShiftKeyDown=false;this._editorUndoBar=d||null;this._supportsPinchToZoom=u!==false}destroy(){this.#tg?.resolve();this.#tg=null;this.#M?.abort();this.#M=null;this._signal=null;for(const t of this.#R.values()){t.destroy()}this.#R.clear();this.#I.clear();this.#$.clear();this.#P=null;this.#ta.clear();this.#F.destroy();this.#k?.destroy();this.#Q?.hide();this.#Q=null;if(this.#q){clearTimeout(this.#q);this.#q=null}if(this.#tu){clearTimeout(this.#tu);this.#tu=null}this._editorUndoBar?.destroy()}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return this.#tn}get useNewAltTextFlow(){return this.#j}get useNewAltTextWhenAddingImage(){return this.#V}get hcmFilter(){return $(this,"hcmFilter",this.#tl?this.#W.addHCMFilter(this.#tl.foreground,this.#tl.background):"none")}get direction(){return $(this,"direction",getComputedStyle(this.#tf).direction)}get highlightColors(){return $(this,"highlightColors",this.#X?new Map(this.#X.split(",").map(t=>t.split("=").map(t=>t.trim()))):null)}get highlightColorNames(){return $(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}setCurrentDrawingSession(t){if(t){this.unselectAll();this.disableUserSelect(true)}else{this.disableUserSelect(false)}this.#N=t}setMainHighlightColorPicker(t){this.#ti=t}editAltText(t,e=false){this.#k?.editAltText(this,t,e)}switchToMode(t,e){this._eventBus.on("annotationeditormodechanged",e,{once:true,signal:this._signal});this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,e){this._eventBus.dispatch("setpreference",{source:this,name:t,value:e})}onSetPreference({name:t,value:e}){switch(t){case"enableNewAltTextWhenAddingImage":this.#V=e;break}}onPageChanging({pageNumber:t}){this.#B=t-1}focusMainContainer(){this.#tf.focus()}findParent(t,e){for(const s of this.#R.values()){const{x:i,y:n,width:r,height:a}=s.div.getBoundingClientRect();if(t>=i&&t<=i+r&&e>=n&&e<=n+a){return s}}return null}disableUserSelect(t=false){this.#tp.classList.toggle("noUserSelect",t)}addShouldRescale(t){this.#$.add(t)}removeShouldRescale(t){this.#$.delete(t)}onScaleChanging({scale:t}){this.commitOrRemove();this.viewParameters.realScale=t*t_.PDF_TO_CSS_UNITS;for(const t of this.#$){t.onScaleChanging()}this.#N?.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove();this.viewParameters.rotation=t}#tv({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t}#ty(t){const{currentLayer:e}=this;if(e.hasTextLayer(t)){return e}for(const e of this.#R.values()){if(e.hasTextLayer(t)){return e}}return null}highlightSelection(t=""){const e=document.getSelection();if(!e||e.isCollapsed){return}const{anchorNode:s,anchorOffset:i,focusNode:n,focusOffset:r}=e;const a=e.toString();const o=this.#tv(e);const l=o.closest(".textLayer");const h=this.getSelectionBoxes(l);if(!h){return}e.empty();const c=this.#ty(l);const d=this.#tr===b.NONE;const u=()=>{c?.createAndAddNewEditor({x:0,y:0},false,{methodOfCreation:t,boxes:h,anchorNode:s,anchorOffset:i,focusNode:n,focusOffset:r,text:a});if(d){this.showAllEditors("highlight",true,true)}};if(d){this.switchToMode(b.HIGHLIGHT,u);return}u()}#tw(){const t=document.getSelection();if(!t||t.isCollapsed){return}const e=this.#tv(t);const s=e.closest(".textLayer");const i=this.getSelectionBoxes(s);if(!i){return}this.#Q||=new tj(this);this.#Q.show(s,i,this.direction==="ltr")}addToAnnotationStorage(t){if(!t.isEmpty()&&this.#D&&!this.#D.has(t.id)){this.#D.setValue(t.id,t)}}#t_(){const t=document.getSelection();if(!t||t.isCollapsed){if(this.#to){this.#Q?.hide();this.#to=null;this.#tx({hasSelectedText:false})}return}const{anchorNode:e}=t;if(e===this.#to){return}const s=this.#tv(t);const i=s.closest(".textLayer");if(!i){if(this.#to){this.#Q?.hide();this.#to=null;this.#tx({hasSelectedText:false})}return}this.#Q?.hide();this.#to=e;this.#tx({hasSelectedText:true});if(this.#tr!==b.HIGHLIGHT&&this.#tr!==b.NONE){return}if(this.#tr===b.HIGHLIGHT){this.showAllEditors("highlight",true,true)}this.#Y=this.isShiftKeyDown;if(!this.isShiftKeyDown){const t=this.#tr===b.HIGHLIGHT?this.#ty(i):null;t?.toggleDrawing();const e=new AbortController;const s=this.combinedSignal(e);const n=s=>{if(s.type==="pointerup"&&s.button!==0){return}e.abort();t?.toggleDrawing(true);if(s.type==="pointerup"){this.#tE("main_toolbar")}};window.addEventListener("pointerup",n,{signal:s});window.addEventListener("blur",n,{signal:s})}}#tE(t=""){if(this.#tr===b.HIGHLIGHT){this.highlightSelection(t)}else if(this.#G){this.#tw()}}#tm(){document.addEventListener("selectionchange",this.#t_.bind(this),{signal:this._signal})}#tS(){if(this.#K){return}this.#K=new AbortController;const t=this.combinedSignal(this.#K);window.addEventListener("focus",this.focus.bind(this),{signal:t});window.addEventListener("blur",this.blur.bind(this),{signal:t})}#tC(){this.#K?.abort();this.#K=null}blur(){this.isShiftKeyDown=false;if(this.#Y){this.#Y=false;this.#tE("main_toolbar")}if(!this.hasSelection){return}const{activeElement:t}=document;for(const e of this.#ta){if(e.div.contains(t)){this.#ts=[e,t];e._focusEventsAllowed=false;break}}}focus(){if(!this.#ts){return}const[t,e]=this.#ts;this.#ts=null;e.addEventListener("focusin",()=>{t._focusEventsAllowed=true},{once:true,signal:this._signal});e.focus()}#tA(){if(this.#te){return}this.#te=new AbortController;const t=this.combinedSignal(this.#te);window.addEventListener("keydown",this.keydown.bind(this),{signal:t});window.addEventListener("keyup",this.keyup.bind(this),{signal:t})}#tT(){this.#te?.abort();this.#te=null}#tM(){if(this.#O){return}this.#O=new AbortController;const t=this.combinedSignal(this.#O);document.addEventListener("copy",this.copy.bind(this),{signal:t});document.addEventListener("cut",this.cut.bind(this),{signal:t});document.addEventListener("paste",this.paste.bind(this),{signal:t})}#tP(){this.#O?.abort();this.#O=null}#tb(){const t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t});document.addEventListener("drop",this.drop.bind(this),{signal:t})}addEditListeners(){this.#tA();this.#tM()}removeEditListeners(){this.#tT();this.#tP()}dragOver(t){for(const{type:e}of t.dataTransfer.items){for(const s of this.#U){if(s.isHandlingMimeForPasting(e)){t.dataTransfer.dropEffect="copy";t.preventDefault();return}}}}drop(t){for(const e of t.dataTransfer.items){for(const s of this.#U){if(s.isHandlingMimeForPasting(e.type)){s.paste(e,this.currentLayer);t.preventDefault();return}}}}copy(t){t.preventDefault();this.#P?.commitOrRemove();if(!this.hasSelection){return}const e=[];for(const t of this.#ta){const s=t.serialize(true);if(s){e.push(s)}}if(e.length===0){return}t.clipboardData.setData("application/pdfjs",JSON.stringify(e))}cut(t){this.copy(t);this.delete()}async paste(t){t.preventDefault();const{clipboardData:e}=t;for(const t of e.items){for(const e of this.#U){if(e.isHandlingMimeForPasting(t.type)){e.paste(t,this.currentLayer);return}}}let s=e.getData("application/pdfjs");if(!s){return}try{s=JSON.parse(s)}catch(t){N(`paste: "${t.message}".`);return}if(!Array.isArray(s)){return}this.unselectAll();const i=this.currentLayer;try{const t=[];for(const e of s){const s=await i.deserialize(e);if(!s){return}t.push(s)}const e=()=>{for(const e of t){this.#tI(e)}this.#tR(t)};const n=()=>{for(const e of t){e.remove()}};this.addCommands({cmd:e,undo:n,mustExec:true})}catch(t){N(`paste: "${t.message}".`)}}keydown(t){if(!this.isShiftKeyDown&&t.key==="Shift"){this.isShiftKeyDown=true}if(this.#tr!==b.NONE&&!this.isEditorHandlingKeyboard){tJ._keyboardManager.exec(this,t)}}keyup(t){if(this.isShiftKeyDown&&t.key==="Shift"){this.isShiftKeyDown=false;if(this.#Y){this.#Y=false;this.#tE("main_toolbar")}}}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}#tx(t){const e=Object.entries(t).some(([t,e])=>this.#tc[t]!==e);if(e){this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#tc,t)});if(this.#tr===b.HIGHLIGHT&&t.hasSelectedEditor===false){this.#tk([[A.HIGHLIGHT_FREE,true]])}}}#tk(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})}setEditingState(t){if(t){this.#tS();this.#tM();this.#tx({isEditing:this.#tr!==b.NONE,isEmpty:this.#tD(),hasSomethingToUndo:this.#F.hasSomethingToUndo(),hasSomethingToRedo:this.#F.hasSomethingToRedo(),hasSelectedEditor:false})}else{this.#tC();this.#tP();this.#tx({isEditing:false});this.disableUserSelect(false)}}registerEditorTypes(t){if(this.#U){return}this.#U=t;for(const t of this.#U){this.#tk(t.defaultPropertiesToUpdate)}}getId(){return this.#J.id}get currentLayer(){return this.#R.get(this.#B)}getLayer(t){return this.#R.get(t)}get currentPageIndex(){return this.#B}addLayer(t){this.#R.set(t.pageIndex,t);if(this.#Z){t.enable()}else{t.disable()}}removeLayer(t){this.#R.delete(t.pageIndex)}async updateMode(t,e=null,s=false){if(this.#tr===t){return}if(this.#tg){await this.#tg.promise;if(!this.#tg){return}}this.#tg=Promise.withResolvers();this.#tr=t;if(t===b.NONE){this.setEditingState(false);this.#tL();this._editorUndoBar?.hide();this.#tg.resolve();return}this.setEditingState(true);await this.#tF();this.unselectAll();for(const e of this.#R.values()){e.updateMode(t)}if(!e){if(s){this.addNewEditorFromKeyboard()}this.#tg.resolve();return}for(const t of this.#I.values()){if(t.annotationElementId===e){this.setSelected(t);t.enterInEditMode()}else{t.unselect()}}this.#tg.resolve()}addNewEditorFromKeyboard(){if(this.currentLayer.canCreateNewEmptyEditor()){this.currentLayer.addNewEditor()}}updateToolbar(t){if(t===this.#tr){return}this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:t})}updateParams(t,e){if(!this.#U){return}switch(t){case A.CREATE:this.currentLayer.addNewEditor();return;case A.HIGHLIGHT_DEFAULT_COLOR:this.#ti?.updateColor(e);break;case A.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}});(this.#th||=new Map).set(t,e);this.showAllEditors("highlight",e);break}for(const s of this.#ta){s.updateParams(t,e)}for(const s of this.#U){s.updateDefaultParams(t,e)}}showAllEditors(t,e,s=false){for(const s of this.#I.values()){if(s.editorType===t){s.show(e)}}const i=this.#th?.get(A.HIGHLIGHT_SHOW_ALL)??true;if(i!==e){this.#tk([[A.HIGHLIGHT_SHOW_ALL,e]])}}enableWaiting(t=false){if(this.#tt===t){return}this.#tt=t;for(const e of this.#R.values()){if(t){e.disableClick()}else{e.enableClick()}e.div.classList.toggle("waiting",t)}}async #tF(){if(!this.#Z){this.#Z=true;const t=[];for(const e of this.#R.values()){t.push(e.enable())}await Promise.all(t);for(const t of this.#I.values()){t.enable()}}}#tL(){this.unselectAll();if(this.#Z){this.#Z=false;for(const t of this.#R.values()){t.disable()}for(const t of this.#I.values()){t.disable()}}}getEditors(t){const e=[];for(const s of this.#I.values()){if(s.pageIndex===t){e.push(s)}}return e}getEditor(t){return this.#I.get(t)}addEditor(t){this.#I.set(t.id,t)}removeEditor(t){if(t.div.contains(document.activeElement)){if(this.#q){clearTimeout(this.#q)}this.#q=setTimeout(()=>{this.focusMainContainer();this.#q=null},0)}this.#I.delete(t.id);this.unselect(t);if(!t.annotationElementId||!this.#H.has(t.annotationElementId)){this.#D?.remove(t.id)}}addDeletedAnnotationElement(t){this.#H.add(t.annotationElementId);this.addChangedExistingAnnotation(t);t.deleted=true}isDeletedAnnotationElement(t){return this.#H.has(t)}removeDeletedAnnotationElement(t){this.#H.delete(t.annotationElementId);this.removeChangedExistingAnnotation(t);t.deleted=false}#tI(t){const e=this.#R.get(t.pageIndex);if(e){e.addOrRebuild(t)}else{this.addEditor(t);this.addToAnnotationStorage(t)}}setActiveEditor(t){if(this.#P===t){return}this.#P=t;if(t){this.#tk(t.propertiesToUpdate)}}get #tO(){let t=null;for(t of this.#ta){}return t}updateUI(t){if(this.#tO===t){this.#tk(t.propertiesToUpdate)}}updateUIForDefaultProperties(t){this.#tk(t.defaultPropertiesToUpdate)}toggleSelected(t){if(this.#ta.has(t)){this.#ta.delete(t);t.unselect();this.#tx({hasSelectedEditor:this.hasSelection});return}this.#ta.add(t);t.select();this.#tk(t.propertiesToUpdate);this.#tx({hasSelectedEditor:true})}setSelected(t){this.#N?.commitOrRemove();for(const e of this.#ta){if(e!==t){e.unselect()}}this.#ta.clear();this.#ta.add(t);t.select();this.#tk(t.propertiesToUpdate);this.#tx({hasSelectedEditor:true})}isSelected(t){return this.#ta.has(t)}get firstSelectedEditor(){return this.#ta.values().next().value}unselect(t){t.unselect();this.#ta.delete(t);this.#tx({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#ta.size!==0}get isEnterHandled(){return this.#ta.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#F.undo();this.#tx({hasSomethingToUndo:this.#F.hasSomethingToUndo(),hasSomethingToRedo:true,isEmpty:this.#tD()});this._editorUndoBar?.hide()}redo(){this.#F.redo();this.#tx({hasSomethingToUndo:true,hasSomethingToRedo:this.#F.hasSomethingToRedo(),isEmpty:this.#tD()})}addCommands(t){this.#F.add(t);this.#tx({hasSomethingToUndo:true,hasSomethingToRedo:false,isEmpty:this.#tD()})}cleanUndoStack(t){this.#F.cleanType(t)}#tD(){if(this.#I.size===0){return true}if(this.#I.size===1){for(const t of this.#I.values()){return t.isEmpty()}}return false}delete(){this.commitOrRemove();const t=this.currentLayer?.endDrawingSession(true);if(!this.hasSelection&&!t){return}const e=t?[t]:[...this.#ta];const s=()=>{this._editorUndoBar?.show(i,e.length===1?e[0].editorType:e.length);for(const t of e){t.remove()}};const i=()=>{for(const t of e){this.#tI(t)}};this.addCommands({cmd:s,undo:i,mustExec:true})}commitOrRemove(){this.#P?.commitOrRemove()}hasSomethingToControl(){return this.#P||this.hasSelection}#tR(t){for(const t of this.#ta){t.unselect()}this.#ta.clear();for(const e of t){if(e.isEmpty()){continue}this.#ta.add(e);e.select()}this.#tx({hasSelectedEditor:this.hasSelection})}selectAll(){for(const t of this.#ta){t.commit()}this.#tR(this.#I.values())}unselectAll(){if(this.#P){this.#P.commitOrRemove();if(this.#tr!==b.NONE){return}}if(this.#N?.commitOrRemove()){return}if(!this.hasSelection){return}for(const t of this.#ta){t.unselect()}this.#ta.clear();this.#tx({hasSelectedEditor:false})}translateSelectedEditors(t,e,s=false){if(!s){this.commitOrRemove()}if(!this.hasSelection){return}this.#td[0]+=t;this.#td[1]+=e;const[i,n]=this.#td;const r=[...this.#ta];const a=1e3;if(this.#tu){clearTimeout(this.#tu)}this.#tu=setTimeout(()=>{this.#tu=null;this.#td[0]=this.#td[1]=0;this.addCommands({cmd:()=>{for(const t of r){if(this.#I.has(t.id)){t.translateInPage(i,n)}}},undo:()=>{for(const t of r){if(this.#I.has(t.id)){t.translateInPage(-i,-n)}}},mustExec:false})},a);for(const s of r){s.translateInPage(t,e)}}setUpDragSession(){if(!this.hasSelection){return}this.disableUserSelect(true);this.#z=new Map;for(const t of this.#ta){this.#z.set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#z){return false}this.disableUserSelect(false);const t=this.#z;this.#z=null;let e=false;for(const[{x:s,y:i,pageIndex:n},r]of t){r.newX=s;r.newY=i;r.newPageIndex=n;e||=s!==r.savedX||i!==r.savedY||n!==r.savedPageIndex}if(!e){return false}const s=(t,e,s,i)=>{if(this.#I.has(t.id)){const n=this.#R.get(i);if(n){t._setParentAndPosition(n,e,s)}else{t.pageIndex=i;t.x=e;t.y=s}}};this.addCommands({cmd:()=>{for(const[e,{newX:i,newY:n,newPageIndex:r}]of t){s(e,i,n,r)}},undo:()=>{for(const[e,{savedX:i,savedY:n,savedPageIndex:r}]of t){s(e,i,n,r)}},mustExec:true});return true}dragSelectedEditors(t,e){if(!this.#z){return}for(const s of this.#z.keys()){s.drag(t,e)}}rebuild(t){if(t.parent===null){const e=this.getLayer(t.pageIndex);if(e){e.changeParent(t);e.addOrRebuild(t)}else{this.addEditor(t);this.addToAnnotationStorage(t);t.rebuild()}}else{t.parent.addOrRebuild(t)}}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#ta.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return this.#P===t}getActive(){return this.#P}getMode(){return this.#tr}get imageManager(){return $(this,"imageManager",new tK)}getSelectionBoxes(t){if(!t){return null}const e=document.getSelection();for(let s=0,i=e.rangeCount;s<i;s++){if(!t.contains(e.getRangeAt(s).commonAncestorContainer)){return null}}const{x:s,y:i,width:n,height:r}=t.getBoundingClientRect();let a;switch(t.getAttribute("data-main-rotation")){case"90":a=(t,e,a,o)=>({x:(e-i)/r,y:1-(t+a-s)/n,width:o/r,height:a/n});break;case"180":a=(t,e,a,o)=>({x:1-(t+a-s)/n,y:1-(e+o-i)/r,width:a/n,height:o/r});break;case"270":a=(t,e,a,o)=>({x:1-(e+o-i)/r,y:(t-s)/n,width:o/r,height:a/n});break;default:a=(t,e,a,o)=>({x:(t-s)/n,y:(e-i)/r,width:a/n,height:o/r});break}const o=[];for(let t=0,s=e.rangeCount;t<s;t++){const s=e.getRangeAt(t);if(s.collapsed){continue}for(const{x:t,y:e,width:i,height:n}of s.getClientRects()){if(i===0||n===0){continue}o.push(a(t,e,i,n))}}return o.length===0?null:o}addChangedExistingAnnotation({annotationElementId:t,id:e}){(this.#L||=new Map).set(t,e)}removeChangedExistingAnnotation({annotationElementId:t}){this.#L?.delete(t)}renderAnnotationElement(t){const e=this.#L?.get(t.data.id);if(!e){return}const s=this.#D.getRawValue(e);if(!s){return}if(this.#tr===b.NONE&&!s.hasBeenModified){return}s.renderAnnotationElement(t)}};class tZ{#o=null;#tN=false;#tB=null;#tH=null;#tz=null;#tU=null;#t$=false;#tG=null;#r=null;#tj=null;#tV=null;#tW=false;static #tq=null;static _l10n=null;constructor(t){this.#r=t;this.#tW=t._uiManager.useNewAltTextFlow;tZ.#tq||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(t){tZ._l10n??=t}async render(){const t=this.#tB=document.createElement("button");t.className="altText";t.tabIndex="0";const e=this.#tH=document.createElement("span");t.append(e);if(this.#tW){t.classList.add("new");t.setAttribute("data-l10n-id",tZ.#tq.missing);e.setAttribute("data-l10n-id",tZ.#tq["missing-label"])}else{t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button");e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label")}const s=this.#r._uiManager._signal;t.addEventListener("contextmenu",tk,{signal:s});t.addEventListener("pointerdown",t=>t.stopPropagation(),{signal:s});const i=t=>{t.preventDefault();this.#r._uiManager.editAltText(this.#r);if(this.#tW){this.#r._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#tK}})}};t.addEventListener("click",i,{capture:true,signal:s});t.addEventListener("keydown",e=>{if(e.target===t&&e.key==="Enter"){this.#t$=true;i(e)}},{signal:s});await this.#tX();return t}get #tK(){return this.#o&&"added"||this.#o===null&&this.guessedText&&"review"||"missing"}finish(){if(!this.#tB){return}this.#tB.focus({focusVisible:this.#t$});this.#t$=false}isEmpty(){if(this.#tW){return this.#o===null}return!this.#o&&!this.#tN}hasData(){if(this.#tW){return this.#o!==null||!!this.#tj}return this.isEmpty()}get guessedText(){return this.#tj}async setGuessedText(t){if(this.#o!==null){return}this.#tj=t;this.#tV=await tZ._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t});this.#tX()}toggleAltTextBadge(t=false){if(!this.#tW||this.#o){this.#tG?.remove();this.#tG=null;return}if(!this.#tG){const t=this.#tG=document.createElement("div");t.className="noAltTextBadge";this.#r.div.append(t)}this.#tG.classList.toggle("hidden",!t)}serialize(t){let e=this.#o;if(!t&&this.#tj===e){e=this.#tV}return{altText:e,decorative:this.#tN,guessedText:this.#tj,textWithDisclaimer:this.#tV}}get data(){return{altText:this.#o,decorative:this.#tN}}set data({altText:t,decorative:e,guessedText:s,textWithDisclaimer:i,cancel:n=false}){if(s){this.#tj=s;this.#tV=i}if(this.#o===t&&this.#tN===e){return}if(!n){this.#o=t;this.#tN=e}this.#tX()}toggle(t=false){if(!this.#tB){return}if(!t&&this.#tU){clearTimeout(this.#tU);this.#tU=null}this.#tB.disabled=!t}shown(){this.#r._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#tK}})}destroy(){this.#tB?.remove();this.#tB=null;this.#tH=null;this.#tz=null;this.#tG?.remove();this.#tG=null}async #tX(){const t=this.#tB;if(!t){return}if(this.#tW){t.classList.toggle("done",!!this.#o);t.setAttribute("data-l10n-id",tZ.#tq[this.#tK]);this.#tH?.setAttribute("data-l10n-id",tZ.#tq[`${this.#tK}-label`]);if(!this.#o){this.#tz?.remove();return}}else{if(!this.#o&&!this.#tN){t.classList.remove("done");this.#tz?.remove();return}t.classList.add("done");t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let e=this.#tz;if(!e){this.#tz=e=document.createElement("span");e.className="tooltip";e.setAttribute("role","tooltip");e.id=`alt-text-tooltip-${this.#r.id}`;const s=100;const i=this.#r._uiManager._signal;i.addEventListener("abort",()=>{clearTimeout(this.#tU);this.#tU=null},{once:true});t.addEventListener("mouseenter",()=>{this.#tU=setTimeout(()=>{this.#tU=null;this.#tz.classList.add("show");this.#r._reportTelemetry({action:"alt_text_tooltip"})},s)},{signal:i});t.addEventListener("mouseleave",()=>{if(this.#tU){clearTimeout(this.#tU);this.#tU=null}this.#tz?.classList.remove("show")},{signal:i})}if(this.#tN){e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip")}else{e.removeAttribute("data-l10n-id");e.textContent=this.#o}if(!e.parentNode){t.append(e)}const s=this.#r.getImageForAltText();s?.setAttribute("aria-describedby",e.id)}};class t0{#tf;#tY=false;#tQ=null;#tJ;#tZ;#t0;#t1;#t2;#t3=null;#t5;#t6=null;constructor({container:t,isPinchingDisabled:e=null,isPinchingStopped:s=null,onPinchStart:i=null,onPinching:n=null,onPinchEnd:r=null,signal:a}){this.#tf=t;this.#tQ=s;this.#tJ=e;this.#tZ=i;this.#t0=n;this.#t1=r;this.#t5=new AbortController;this.#t2=AbortSignal.any([a,this.#t5.signal]);t.addEventListener("touchstart",this.#t4.bind(this),{passive:false,signal:this.#t2})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return $(this,"MIN_TOUCH_DISTANCE_TO_PINCH",35/(window.devicePixelRatio||1))}#t4(t){if(this.#tJ?.()||t.touches.length<2){return}if(!this.#t6){this.#t6=new AbortController;const t=AbortSignal.any([this.#t2,this.#t6.signal]);const e=this.#tf;const s={signal:t,passive:false};e.addEventListener("touchmove",this.#t8.bind(this),s);e.addEventListener("touchend",this.#t7.bind(this),s);e.addEventListener("touchcancel",this.#t7.bind(this),s);this.#tZ?.()}tD(t);if(t.touches.length!==2||this.#tQ?.()){this.#t3=null;return}let[e,s]=t.touches;if(e.identifier>s.identifier){[e,s]=[s,e]}this.#t3={touch0X:e.screenX,touch0Y:e.screenY,touch1X:s.screenX,touch1Y:s.screenY}}#t8(t){if(!this.#t3||t.touches.length!==2){return}let[e,s]=t.touches;if(e.identifier>s.identifier){[e,s]=[s,e]}const{screenX:i,screenY:n}=e;const{screenX:r,screenY:a}=s;const o=this.#t3;const{touch0X:l,touch0Y:h,touch1X:c,touch1Y:d}=o;const u=c-l;const f=d-h;const p=r-i;const g=a-n;const m=Math.hypot(p,g)||1;const b=Math.hypot(u,f)||1;if(!this.#tY&&Math.abs(b-m)<=t0.MIN_TOUCH_DISTANCE_TO_PINCH){return}o.touch0X=i;o.touch0Y=n;o.touch1X=r;o.touch1Y=a;t.preventDefault();if(!this.#tY){this.#tY=true;return}const A=[(i+r)/2,(n+a)/2];this.#t0?.(A,b,m)}#t7(t){this.#t6.abort();this.#t6=null;this.#t1?.();if(!this.#t3){return}t.preventDefault();this.#t3=null;this.#tY=false}destroy(){this.#t5?.abort();this.#t5=null}};class t1{#t9=null;#et=null;#o=null;#ee=false;#es=null;#ei="";#en=false;#er=null;#ea=null;#eo=null;#el=null;#eh="";#ec=false;#ed=null;#eu=false;#ef=false;#ep=false;#eg=null;#em=0;#eb=0;#eA=null;#ev=null;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=true;_uiManager=null;_focusEventsAllowed=true;static _l10n=null;static _l10nResizer=null;#ey=false;#ew=t1._zIndex++;static _borderLineWidth=-1;static _colorManager=new tQ;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const t=t1.prototype._resizeWithKeyboard;const e=tJ.TRANSLATE_SMALL;const s=tJ.TRANSLATE_BIG;return $(this,"_resizerKeyboardManager",new tY([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-s,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[s,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-s]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,s]}],[["Escape","mac+Escape"],t1.prototype._stopResizingWithKeyboard]]))}constructor(t){this.parent=t.parent;this.id=t.id;this.width=this.height=null;this.pageIndex=t.parent.pageIndex;this.name=t.name;this.div=null;this._uiManager=t.uiManager;this.annotationElementId=null;this._willKeepAspectRatio=false;this._initialOptions.isCentered=t.isCentered;this._structTreeParentId=null;const{rotation:e,rawDims:{pageWidth:s,pageHeight:i,pageX:n,pageY:r}}=this.parent.viewport;this.rotation=e;this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360;this.pageDimensions=[s,i];this.pageTranslation=[n,r];const[a,o]=this.parentDimensions;this.x=t.x/a;this.y=t.y/o;this.isAttachedToDOM=false;this.deleted=false}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return false}static get _defaultLineColor(){return $(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){const e=new t2({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId;e.deleted=true;e._uiManager.addToAnnotationStorage(e)}static initialize(t,e){t1._l10n??=t;t1._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"});if(t1._borderLineWidth!==-1){return}const s=getComputedStyle(document.documentElement);t1._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return false}static paste(t,e){B("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#ey}set _isDraggable(t){this.#ey=t;this.div?.classList.toggle("draggable",t)}get isEnterHandled(){return true}center(){const[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(t*2);this.y+=this.width*t/(e*2);break;case 180:this.x+=this.width/2;this.y+=this.height/2;break;case 270:this.x+=this.height*e/(t*2);this.y-=this.width*t/(e*2);break;default:this.x-=this.width/2;this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#ew}setParent(t){if(t!==null){this.pageIndex=t.pageIndex;this.pageDimensions=t.pageDimensions}else{this.#e_()}this.parent=t}focusin(t){if(!this._focusEventsAllowed){return}if(!this.#ec){this.parent.setSelected(this)}else{this.#ec=false}}focusout(t){if(!this._focusEventsAllowed){return}if(!this.isAttachedToDOM){return}const e=t.relatedTarget;if(e?.closest(`#${this.id}`)){return}t.preventDefault();if(!this.parent?.isMultipleSelection){this.commitOrRemove()}}commitOrRemove(){if(this.isEmpty()){this.remove()}else{this.commit()}}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,s,i){const[n,r]=this.parentDimensions;[s,i]=this.screenToPageTranslation(s,i);this.x=(t+s)/n;this.y=(e+i)/r;this.fixAndSetPosition()}#ex([t,e],s,i){[s,i]=this.screenToPageTranslation(s,i);this.x+=s/t;this.y+=i/e;this._onTranslating(this.x,this.y);this.fixAndSetPosition()}translate(t,e){this.#ex(this.parentDimensions,t,e)}translateInPage(t,e){this.#ed||=[this.x,this.y,this.width,this.height];this.#ex(this.pageDimensions,t,e);this.div.scrollIntoView({block:"nearest"})}drag(t,e){this.#ed||=[this.x,this.y,this.width,this.height];const{div:s,parentDimensions:[i,n]}=this;this.x+=t/i;this.y+=e/n;if(this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:t,y:e}=this.div.getBoundingClientRect();if(this.parent.findNewParent(this,t,e)){this.x-=Math.floor(this.x);this.y-=Math.floor(this.y)}}let{x:r,y:a}=this;const[o,l]=this.getBaseTranslation();r+=o;a+=l;const{style:h}=s;h.left=`${(100*r).toFixed(2)}%`;h.top=`${(100*a).toFixed(2)}%`;this._onTranslating(r,a);s.scrollIntoView({block:"nearest"})}_onTranslating(t,e){}_onTranslated(t,e){}get _hasBeenMoved(){return!!this.#ed&&(this.#ed[0]!==this.x||this.#ed[1]!==this.y)}get _hasBeenResized(){return!!this.#ed&&(this.#ed[2]!==this.width||this.#ed[3]!==this.height)}getBaseTranslation(){const[t,e]=this.parentDimensions;const{_borderLineWidth:s}=t1;const i=s/t;const n=s/e;switch(this.rotation){case 90:return[-i,n];case 180:return[i,n];case 270:return[i,-n];default:return[-i,-n]}}get _mustFixPosition(){return true}fixAndSetPosition(t=this.rotation){const{div:{style:e},pageDimensions:[s,i]}=this;let{x:n,y:r,width:a,height:o}=this;a*=s;o*=i;n*=s;r*=i;if(this._mustFixPosition){switch(t){case 0:n=Math.max(0,Math.min(s-a,n));r=Math.max(0,Math.min(i-o,r));break;case 90:n=Math.max(0,Math.min(s-o,n));r=Math.min(i,Math.max(a,r));break;case 180:n=Math.min(s,Math.max(a,n));r=Math.min(i,Math.max(o,r));break;case 270:n=Math.min(s,Math.max(o,n));r=Math.max(0,Math.min(i-a,r));break}}this.x=n/=s;this.y=r/=i;const[l,h]=this.getBaseTranslation();n+=l;r+=h;e.left=`${(100*n).toFixed(2)}%`;e.top=`${(100*r).toFixed(2)}%`;this.moveInDOM()}static #eE(t,e,s){switch(s){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}}screenToPageTranslation(t,e){return t1.#eE(t,e,this.parentRotation)}pageTranslationToScreen(t,e){return t1.#eE(t,e,360-this.parentRotation)}#eS(t){switch(t){case 90:{const[t,e]=this.pageDimensions;return[0,-t/e,e/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,e]=this.pageDimensions;return[0,t/e,-e/t,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:t,pageDimensions:[e,s]}=this;return[e*t,s*t]}setDims(t,e){const[s,i]=this.parentDimensions;const{style:n}=this.div;n.width=`${(100*t/s).toFixed(2)}%`;if(!this.#en){n.height=`${(100*e/i).toFixed(2)}%`}}fixDims(){const{style:t}=this.div;const{height:e,width:s}=t;const i=s.endsWith("%");const n=!this.#en&&e.endsWith("%");if(i&&n){return}const[r,a]=this.parentDimensions;if(!i){t.width=`${(100*parseFloat(s)/r).toFixed(2)}%`}if(!this.#en&&!n){t.height=`${(100*parseFloat(e)/a).toFixed(2)}%`}}getInitialTranslation(){return[0,0]}#eC(){if(this.#er){return}this.#er=document.createElement("div");this.#er.classList.add("resizers");const t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"];const e=this._uiManager._signal;for(const s of t){const t=document.createElement("div");this.#er.append(t);t.classList.add("resizer",s);t.setAttribute("data-resizer-name",s);t.addEventListener("pointerdown",this.#eT.bind(this,s),{signal:e});t.addEventListener("contextmenu",tk,{signal:e});t.tabIndex=-1}this.div.prepend(this.#er)}#eT(t,e){e.preventDefault();const{isMac:s}=tn.platform;if(e.button!==0||e.ctrlKey&&s){return}this.#o?.toggle(false);const i=this._isDraggable;this._isDraggable=false;this.#ea=[e.screenX,e.screenY];const n=new AbortController;const r=this._uiManager.combinedSignal(n);this.parent.togglePointerEvents(false);window.addEventListener("pointermove",this.#eM.bind(this,t),{passive:true,capture:true,signal:r});window.addEventListener("touchmove",tD,{passive:false,signal:r});window.addEventListener("contextmenu",tk,{signal:r});this.#eo={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const a=this.parent.div.style.cursor;const o=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;const l=()=>{n.abort();this.parent.togglePointerEvents(true);this.#o?.toggle(true);this._isDraggable=i;this.parent.div.style.cursor=a;this.div.style.cursor=o;this.#eP()};window.addEventListener("pointerup",l,{signal:r});window.addEventListener("blur",l,{signal:r})}#eI(t,e,s,i){this.width=s;this.height=i;this.x=t;this.y=e;const[n,r]=this.parentDimensions;this.setDims(n*s,r*i);this.fixAndSetPosition();this._onResized()}_onResized(){}#eP(){if(!this.#eo){return}const{savedX:t,savedY:e,savedWidth:s,savedHeight:i}=this.#eo;this.#eo=null;const n=this.x;const r=this.y;const a=this.width;const o=this.height;if(n===t&&r===e&&a===s&&o===i){return}this.addCommands({cmd:this.#eI.bind(this,n,r,a,o),undo:this.#eI.bind(this,t,e,s,i),mustExec:true})}static _round(t){return Math.round(t*1e4)/1e4}#eM(t,e){const[s,i]=this.parentDimensions;const n=this.x;const r=this.y;const a=this.width;const o=this.height;const l=t1.MIN_SIZE/s;const h=t1.MIN_SIZE/i;const c=this.#eS(this.rotation);const d=(t,e)=>[c[0]*t+c[2]*e,c[1]*t+c[3]*e];const u=this.#eS(360-this.rotation);const f=(t,e)=>[u[0]*t+u[2]*e,u[1]*t+u[3]*e];let p;let g;let m=false;let b=false;switch(t){case"topLeft":m=true;p=(t,e)=>[0,0];g=(t,e)=>[t,e];break;case"topMiddle":p=(t,e)=>[t/2,0];g=(t,e)=>[t/2,e];break;case"topRight":m=true;p=(t,e)=>[t,0];g=(t,e)=>[0,e];break;case"middleRight":b=true;p=(t,e)=>[t,e/2];g=(t,e)=>[0,e/2];break;case"bottomRight":m=true;p=(t,e)=>[t,e];g=(t,e)=>[0,0];break;case"bottomMiddle":p=(t,e)=>[t/2,e];g=(t,e)=>[t/2,0];break;case"bottomLeft":m=true;p=(t,e)=>[0,e];g=(t,e)=>[t,0];break;case"middleLeft":b=true;p=(t,e)=>[0,e/2];g=(t,e)=>[t,e/2];break}const A=p(a,o);const v=g(a,o);let y=d(...v);const w=t1._round(n+y[0]);const _=t1._round(r+y[1]);let x=1;let E=1;let S,C;if(!e.fromKeyboard){const{screenX:t,screenY:s}=e;const[i,n]=this.#ea;[S,C]=this.screenToPageTranslation(t-i,s-n);this.#ea[0]=t;this.#ea[1]=s}else{({deltaX:S,deltaY:C}=e)}[S,C]=f(S/s,C/i);if(m){const t=Math.hypot(a,o);x=E=Math.max(Math.min(Math.hypot(v[0]-A[0]-S,v[1]-A[1]-C)/t,1/a,1/o),l/a,h/o)}else if(b){x=Math.max(l,Math.min(1,Math.abs(v[0]-A[0]-S)))/a}else{E=Math.max(h,Math.min(1,Math.abs(v[1]-A[1]-C)))/o}const T=t1._round(a*x);const M=t1._round(o*E);y=d(...g(T,M));const P=w-y[0];const I=_-y[1];this.#ed||=[this.x,this.y,this.width,this.height];this.width=T;this.height=M;this.x=P;this.y=I;this.setDims(s*T,i*M);this.fixAndSetPosition();this._onResizing()}_onResizing(){}altTextFinish(){this.#o?.finish()}async addEditToolbar(){if(this._editToolbar||this.#ef){return this._editToolbar}this._editToolbar=new tG(this);this.div.append(this._editToolbar.render());if(this.#o){await this._editToolbar.addAltText(this.#o)}return this._editToolbar}removeEditToolbar(){if(!this._editToolbar){return}this._editToolbar.remove();this._editToolbar=null;this.#o?.destroy()}addContainer(t){const e=this._editToolbar?.div;if(e){e.before(t)}else{this.div.append(t)}}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){if(this.#o){return}tZ.initialize(t1._l10n);this.#o=new tZ(this);if(this.#t9){this.#o.data=this.#t9;this.#t9=null}await this.addEditToolbar()}get altTextData(){return this.#o?.data}set altTextData(t){if(!this.#o){return}this.#o.data=t}get guessedAltText(){return this.#o?.guessedText}async setGuessedAltText(t){await this.#o?.setGuessedText(t)}serializeAltText(t){return this.#o?.serialize(t)}hasAltText(){return!!this.#o&&!this.#o.isEmpty()}hasAltTextData(){return this.#o?.hasData()??false}render(){this.div=document.createElement("div");this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360);this.div.className=this.name;this.div.setAttribute("id",this.id);this.div.tabIndex=this.#ee?-1:0;if(!this._isVisible){this.div.classList.add("hidden")}this.setInForeground();this.#eR();const[t,e]=this.parentDimensions;if(this.parentRotation%180!==0){this.div.style.maxWidth=`${(100*e/t).toFixed(2)}%`;this.div.style.maxHeight=`${(100*t/e).toFixed(2)}%`}const[s,i]=this.getInitialTranslation();this.translate(s,i);tV(this,this.div,["pointerdown"]);if(this.isResizable&&this._uiManager._supportsPinchToZoom){this.#ev||=new t0({container:this.div,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#ek.bind(this),onPinching:this.#eD.bind(this),onPinchEnd:this.#eL.bind(this),signal:this._uiManager._signal})}this._uiManager._editorUndoBar?.hide();return this.div}#ek(){this.#eo={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};this.#o?.toggle(false);this.parent.togglePointerEvents(false)}#eD(t,e,s){const i=.7;let n=i*(s/e)+1-i;if(n===1){return}const r=this.#eS(this.rotation);const a=(t,e)=>[r[0]*t+r[2]*e,r[1]*t+r[3]*e];const[o,l]=this.parentDimensions;const h=this.x;const c=this.y;const d=this.width;const u=this.height;const f=t1.MIN_SIZE/o;const p=t1.MIN_SIZE/l;n=Math.max(Math.min(n,1/d,1/u),f/d,p/u);const g=t1._round(d*n);const m=t1._round(u*n);if(g===d&&m===u){return}this.#ed||=[h,c,d,u];const b=a(d/2,u/2);const A=t1._round(h+b[0]);const v=t1._round(c+b[1]);const y=a(g/2,m/2);this.x=A-y[0];this.y=v-y[1];this.width=g;this.height=m;this.setDims(o*g,l*m);this.fixAndSetPosition();this._onResizing()}#eL(){this.#o?.toggle(true);this.parent.togglePointerEvents(true);this.#eP()}pointerdown(t){const{isMac:e}=tn.platform;if(t.button!==0||t.ctrlKey&&e){t.preventDefault();return}this.#ec=true;if(this._isDraggable){this.#eF(t);return}this.#eO(t)}get isSelected(){return this._uiManager.isSelected(this)}#eO(t){const{isMac:e}=tn.platform;if(t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e){this.parent.toggleSelected(this)}else{this.parent.setSelected(this)}}#eF(t){const{isSelected:e}=this;this._uiManager.setUpDragSession();let s=false;const i=new AbortController;const n=this._uiManager.combinedSignal(i);const r={capture:true,passive:false,signal:n};const a=t=>{i.abort();this.#es=null;this.#ec=false;if(!this._uiManager.endDragSession()){this.#eO(t)}if(s){this._onStopDragging()}};if(e){this.#em=t.clientX;this.#eb=t.clientY;this.#es=t.pointerId;this.#ei=t.pointerType;window.addEventListener("pointermove",t=>{if(!s){s=true;this._onStartDragging()}const{clientX:e,clientY:i,pointerId:n}=t;if(n!==this.#es){tD(t);return}const[r,a]=this.screenToPageTranslation(e-this.#em,i-this.#eb);this.#em=e;this.#eb=i;this._uiManager.dragSelectedEditors(r,a)},r);window.addEventListener("touchmove",tD,r);window.addEventListener("pointerdown",t=>{if(t.pointerType===this.#ei){if(this.#ev||t.isPrimary){a(t)}}tD(t)},r)}const o=t=>{if(!this.#es||this.#es===t.pointerId){a(t);return}tD(t)};window.addEventListener("pointerup",o,{signal:n});window.addEventListener("blur",o,{signal:n})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){if(this.#eg){clearTimeout(this.#eg)}this.#eg=setTimeout(()=>{this.#eg=null;this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(t,e,s){t.changeParent(this);this.x=e;this.y=s;this.fixAndSetPosition();this._onTranslated()}getRect(t,e,s=this.rotation){const i=this.parentScale;const[n,r]=this.pageDimensions;const[a,o]=this.pageTranslation;const l=t/i;const h=e/i;const c=this.x*n;const d=this.y*r;const u=this.width*n;const f=this.height*r;switch(s){case 0:return[c+l+a,r-d-h-f+o,c+l+u+a,r-d-h+o];case 90:return[c+h+a,r-d+l+o,c+h+f+a,r-d+l+u+o];case 180:return[c-l-u+a,r-d+h+o,c-l+a,r-d+h+f+o];case 270:return[c-h-f+a,r-d-l-u+o,c-h+a,r-d-l+o];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){const[s,i,n,r]=t;const a=n-s;const o=r-i;switch(this.rotation){case 0:return[s,e-r,a,o];case 90:return[s,e-i,o,a];case 180:return[n,e-i,a,o];case 270:return[n,e-r,o,a];default:throw new Error("Invalid rotation")}}onceAdded(t){}isEmpty(){return false}enableEditMode(){this.#ef=true}disableEditMode(){this.#ef=false}isInEditMode(){return this.#ef}shouldGetKeyboardEvents(){return this.#ep}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:t,left:e,bottom:s,right:i}=this.getClientDimensions();const{innerHeight:n,innerWidth:r}=window;return e<r&&i>0&&t<n&&s>0}#eR(){if(this.#el||!this.div){return}this.#el=new AbortController;const t=this._uiManager.combinedSignal(this.#el);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:t});this.div.addEventListener("focusout",this.focusout.bind(this),{signal:t})}rebuild(){this.#eR()}rotate(t){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:true,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(t=false,e=null){B("An editor must be serializable")}static async deserialize(t,e,s){const i=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:s});i.rotation=t.rotation;i.#t9=t.accessibilityData;const[n,r]=i.pageDimensions;const[a,o,l,h]=i.getRectInCurrentCoords(t.rect,r);i.x=a/n;i.y=o/r;i.width=l/n;i.height=h/r;return i}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){this.#el?.abort();this.#el=null;if(!this.isEmpty()){this.commit()}if(this.parent){this.parent.remove(this)}else{this._uiManager.removeEditor(this)}if(this.#eg){clearTimeout(this.#eg);this.#eg=null}this.#e_();this.removeEditToolbar();if(this.#eA){for(const t of this.#eA.values()){clearTimeout(t)}this.#eA=null}this.parent=null;this.#ev?.destroy();this.#ev=null}get isResizable(){return false}makeResizable(){if(this.isResizable){this.#eC();this.#er.classList.remove("hidden");tV(this,this.div,["keydown"])}}get toolbarPosition(){return null}keydown(t){if(!this.isResizable||t.target!==this.div||t.key!=="Enter"){return}this._uiManager.setSelected(this);this.#eo={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const e=this.#er.children;if(!this.#et){this.#et=Array.from(e);const t=this.#eN.bind(this);const s=this.#eB.bind(this);const i=this._uiManager._signal;for(const e of this.#et){const n=e.getAttribute("data-resizer-name");e.setAttribute("role","spinbutton");e.addEventListener("keydown",t,{signal:i});e.addEventListener("blur",s,{signal:i});e.addEventListener("focus",this.#eH.bind(this,n),{signal:i});e.setAttribute("data-l10n-id",t1._l10nResizer[n])}}const s=this.#et[0];let i=0;for(const t of e){if(t===s){break}i++}const n=(360-this.rotation+this.parentRotation)%360/90*(this.#et.length/4);if(n!==i){if(n<i){for(let t=0;t<i-n;t++){this.#er.append(this.#er.firstChild)}}else if(n>i){for(let t=0;t<n-i;t++){this.#er.firstChild.before(this.#er.lastChild)}}let t=0;for(const s of e){const e=this.#et[t++];const i=e.getAttribute("data-resizer-name");s.setAttribute("data-l10n-id",t1._l10nResizer[i])}}this.#ez(0);this.#ep=true;this.#er.firstChild.focus({focusVisible:true});t.preventDefault();t.stopImmediatePropagation()}#eN(t){t1._resizerKeyboardManager.exec(this,t)}#eB(t){if(this.#ep&&t.relatedTarget?.parentNode!==this.#er){this.#e_()}}#eH(t){this.#eh=this.#ep?t:""}#ez(t){if(!this.#et){return}for(const e of this.#et){e.tabIndex=t}}_resizeWithKeyboard(t,e){if(!this.#ep){return}this.#eM(this.#eh,{deltaX:t,deltaY:e,fromKeyboard:true})}#e_(){this.#ep=false;this.#ez(-1);this.#eP()}_stopResizingWithKeyboard(){this.#e_();this.div.focus()}select(){this.makeResizable();this.div?.classList.add("selectedEditor");if(!this._editToolbar){this.addEditToolbar().then(()=>{if(this.div?.classList.contains("selectedEditor")){this._editToolbar?.show()}});return}this._editToolbar?.show();this.#o?.toggleAltTextBadge(false)}unselect(){this.#er?.classList.add("hidden");this.div?.classList.remove("selectedEditor");if(this.div?.contains(document.activeElement)){this._uiManager.currentLayer.div.focus({preventScroll:true})}this._editToolbar?.hide();this.#o?.toggleAltTextBadge(true)}updateParams(t,e){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return this.#eu}set isEditing(t){this.#eu=t;if(!this.parent){return}if(t){this.parent.setSelected(this);this.parent.setActiveEditor(this)}else{this.parent.setActiveEditor(null)}}setAspectRatio(t,e){this.#en=true;const s=t/e;const{style:i}=this.div;i.aspectRatio=s;i.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return true}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t,e=false){if(e){this.#eA||=new Map;const{action:e}=t;let s=this.#eA.get(e);if(s){clearTimeout(s)}s=setTimeout(()=>{this._reportTelemetry(t);this.#eA.delete(e);if(this.#eA.size===0){this.#eA=null}},t1._telemetryTimeout);this.#eA.set(e,s);return}t.type||=this.editorType;this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(t=this._isVisible){this.div.classList.toggle("hidden",!t);this._isVisible=t}enable(){if(this.div){this.div.tabIndex=0}this.#ee=false}disable(){if(this.div){this.div.tabIndex=-1}this.#ee=true}renderAnnotationElement(t){let e=t.container.querySelector(".annotationContent");if(!e){e=document.createElement("div");e.classList.add("annotationContent",this.editorType);t.container.prepend(e)}else if(e.nodeName==="CANVAS"){const t=e;e=document.createElement("div");e.classList.add("annotationContent",this.editorType);t.before(e)}return e}resetAnnotationElement(t){const{firstChild:e}=t.container;if(e?.nodeName==="DIV"&&e.classList.contains("annotationContent")){e.remove()}}}class t2 extends t1{constructor(t){super(t);this.annotationElementId=t.annotationElementId;this.deleted=true}serialize(){return this.serializeDeleted()}};const t3=0xc3d2e1f0;const t5=0xffff0000;const t6=65535;class t4{constructor(t){this.h1=t?t&0xffffffff:t3;this.h2=t?t&0xffffffff:t3}update(t){let e,s;if(typeof t==="string"){e=new Uint8Array(t.length*2);s=0;for(let i=0,n=t.length;i<n;i++){const n=t.charCodeAt(i);if(n<=255){e[s++]=n}else{e[s++]=n>>>8;e[s++]=n&255}}}else if(ArrayBuffer.isView(t)){e=t.slice();s=e.byteLength}else{throw new Error("Invalid data format, must be a string or TypedArray.")}const i=s>>2;const n=s-i*4;const r=new Uint32Array(e.buffer,0,i);let a=0,o=0;let l=this.h1,h=this.h2;const c=0xcc9e2d51,d=0x1b873593;const u=c&t6,f=d&t6;for(let t=0;t<i;t++){if(t&1){a=r[t];a=a*c&t5|a*u&t6;a=a<<15|a>>>17;a=a*d&t5|a*f&t6;l^=a;l=l<<13|l>>>19;l=l*5+0xe6546b64}else{o=r[t];o=o*c&t5|o*u&t6;o=o<<15|o>>>17;o=o*d&t5|o*f&t6;h^=o;h=h<<13|h>>>19;h=h*5+0xe6546b64}}a=0;switch(n){case 3:a^=e[i*4+2]<<16;case 2:a^=e[i*4+1]<<8;case 1:a^=e[i*4];a=a*c&t5|a*u&t6;a=a<<15|a>>>17;a=a*d&t5|a*f&t6;if(i&1){l^=a}else{h^=a}}this.h1=l;this.h2=h}hexdigest(){let t=this.h1,e=this.h2;t^=e>>>1;t=t*0xed558ccd&t5|t*36045&t6;e=e*0xff51afd7&t5|((e<<16|t>>>16)*0xafd7ed55&t5)>>>16;t^=e>>>1;t=t*0x1a85ec53&t5|t*60499&t6;e=e*0xc4ceb9fe&t5|((e<<16|t>>>16)*0xb9fe1a85&t5)>>>16;t^=e>>>1;return(t>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}};const t8=Object.freeze({map:null,hash:"",transfer:undefined});class t7{#eU=false;#e$=null;#eG=new Map;constructor(){this.onSetModified=null;this.onResetModified=null;this.onAnnotationEditor=null}getValue(t,e){const s=this.#eG.get(t);if(s===undefined){return e}return Object.assign(e,s)}getRawValue(t){return this.#eG.get(t)}remove(t){this.#eG.delete(t);if(this.#eG.size===0){this.resetModified()}if(typeof this.onAnnotationEditor==="function"){for(const t of this.#eG.values()){if(t instanceof t1){return}}this.onAnnotationEditor(null)}}setValue(t,e){const s=this.#eG.get(t);let i=false;if(s!==undefined){for(const[t,n]of Object.entries(e)){if(s[t]!==n){i=true;s[t]=n}}}else{i=true;this.#eG.set(t,e)}if(i){this.#ej()}if(e instanceof t1&&typeof this.onAnnotationEditor==="function"){this.onAnnotationEditor(e.constructor._type)}}has(t){return this.#eG.has(t)}getAll(){return this.#eG.size>0?te(this.#eG):null}setAll(t){for(const[e,s]of Object.entries(t)){this.setValue(e,s)}}get size(){return this.#eG.size}#ej(){if(!this.#eU){this.#eU=true;if(typeof this.onSetModified==="function"){this.onSetModified()}}}resetModified(){if(this.#eU){this.#eU=false;if(typeof this.onResetModified==="function"){this.onResetModified()}}}get print(){return new t9(this)}get serializable(){if(this.#eG.size===0){return t8}const t=new Map,e=new t4,s=[];const i=Object.create(null);let n=false;for(const[s,r]of this.#eG){const a=r instanceof t1?r.serialize(false,i):r;if(a){t.set(s,a);e.update(`${s}:${JSON.stringify(a)}`);n||=!!a.bitmap}}if(n){for(const e of t.values()){if(e.bitmap){s.push(e.bitmap)}}}return t.size>0?{map:t,hash:e.hexdigest(),transfer:s}:t8}get editorStats(){let t=null;const e=new Map;for(const s of this.#eG.values()){if(!(s instanceof t1)){continue}const i=s.telemetryFinalData;if(!i){continue}const{type:n}=i;if(!e.has(n)){e.set(n,Object.getPrototypeOf(s).constructor)}t||=Object.create(null);const r=t[n]||=new Map;for(const[t,e]of Object.entries(i)){if(t==="type"){continue}let s=r.get(t);if(!s){s=new Map;r.set(t,s)}const i=s.get(e)??0;s.set(e,i+1)}}for(const[s,i]of e){t[s]=i.computeTelemetryFinalData(t[s])}return t}resetModifiedIds(){this.#e$=null}get modifiedIds(){if(this.#e$){return this.#e$}const t=[];for(const e of this.#eG.values()){if(!(e instanceof t1)||!e.annotationElementId||!e.serialize()){continue}t.push(e.annotationElementId)}return this.#e$={ids:new Set(t),hash:t.join(",")}}}class t9 extends t7{#eV;constructor(t){super();const{map:e,hash:s,transfer:i}=t.serializable;const n=structuredClone(e,i?{transfer:i}:null);this.#eV={map:n,hash:s,transfer:i}}get print(){B("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#eV}get modifiedIds(){return $(this,"modifiedIds",{ids:new Set,hash:""})}};class et{#eW=new Set;constructor({ownerDocument:t=globalThis.document,styleElement:e=null}){this._document=t;this.nativeFontFaces=new Set;this.styleElement=null;this.loadingRequests=[];this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t);this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t);this._document.fonts.delete(t)}insertRule(t){if(!this.styleElement){this.styleElement=this._document.createElement("style");this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement)}const e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(const t of this.nativeFontFaces){this._document.fonts.delete(t)}this.nativeFontFaces.clear();this.#eW.clear();if(this.styleElement){this.styleElement.remove();this.styleElement=null}}async loadSystemFont({systemFontInfo:t,_inspectFont:e}){if(!t||this.#eW.has(t.loadedName)){return}H(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set.");if(this.isFontLoadingAPISupported){const{loadedName:s,src:i,style:n}=t;const r=new FontFace(s,i,n);this.addNativeFontFace(r);try{await r.load();this.#eW.add(s);e?.(t)}catch{N(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`);this.removeNativeFontFace(r)}return}B("Not implemented: loadSystemFont without the Font Loading API.")}async bind(t){if(t.attached||t.missingFile&&!t.systemFontInfo){return}t.attached=true;if(t.systemFontInfo){await this.loadSystemFont(t);return}if(this.isFontLoadingAPISupported){const e=t.createNativeFontFace();if(e){this.addNativeFontFace(e);try{await e.loaded}catch(s){N(`Failed to load font '${e.family}': '${s}'.`);t.disableFontFace=true;throw s}}return}const e=t.createFontFaceRule();if(e){this.insertRule(e);if(this.isSyncFontLoadingSupported){return}await new Promise(e=>{const s=this._queueLoadingCallback(e);this._prepareFontLoadEvent(t,s)})}}get isFontLoadingAPISupported(){const t=!!this._document?.fonts;return $(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){let t=false;if(o){t=true}else if(typeof navigator!=="undefined"&&typeof navigator?.userAgent==="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent)){t=true}return $(this,"isSyncFontLoadingSupported",t)}_queueLoadingCallback(t){function e(){H(!i.done,"completeRequest() cannot be called twice.");i.done=true;while(s.length>0&&s[0].done){const t=s.shift();setTimeout(t.callback,0)}}const{loadingRequests:s}=this;const i={done:false,complete:e,callback:t};s.push(i);return i}get _loadTestFont(){const t=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQA"+"FQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAA"+"ALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgA"+"AAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1"+"AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD"+"6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACM"+"AooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4D"+"IP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAA"+"AAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUA"+"AQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgAB"+"AAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABY"+"AAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAA"+"AC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"+"AAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"+"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"+"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"+"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"+"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAA"+"AAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQAC"+"AQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3"+"Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTj"+"FQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return $(this,"_loadTestFont",t)}_prepareFontLoadEvent(t,e){function s(t,e){return t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3)&255}function i(t,e,s,i){const n=t.substring(0,e);const r=t.substring(e+s);return n+i+r}let n,r;const a=this._document.createElement("canvas");a.width=1;a.height=1;const o=a.getContext("2d");let l=0;function h(t,e){if(++l>30){N("Load test font never loaded.");e();return}o.font="30px "+t;o.fillText(".",0,20);const s=o.getImageData(0,0,1,1);if(s.data[3]>0){e();return}setTimeout(h.bind(null,t,e))}const c=`lt${Date.now()}${this.loadTestFontId++}`;let d=this._loadTestFont;const u=976;d=i(d,u,c.length,c);const f=16;const p=0x58585858;let g=s(d,f);for(n=0,r=c.length-3;n<r;n+=4){g=g-p+s(c,n)|0}if(n<c.length){g=g-p+s(c+"XXX",n)|0}d=i(d,f,4,Z(g));const m=`url(data:font/opentype;base64,${btoa(d)});`;const b=`@font-face {font-family:"${c}";src:${m}}`;this.insertRule(b);const A=this._document.createElement("div");A.style.visibility="hidden";A.style.width=A.style.height="10px";A.style.position="absolute";A.style.top=A.style.left="0px";for(const e of[t.loadedName,c]){const t=this._document.createElement("span");t.textContent="Hi";t.style.fontFamily=e;A.append(t)}this._document.body.append(A);h(c,()=>{A.remove();e.complete()})}}class ee{constructor(t,{disableFontFace:e=false,fontExtraProperties:s=false,inspectFont:i=null}){this.compiledGlyphs=Object.create(null);for(const e in t){this[e]=t[e]}this.disableFontFace=e===true;this.fontExtraProperties=s===true;this._inspectFont=i}createNativeFontFace(){if(!this.data||this.disableFontFace){return null}let t;if(!this.cssFontInfo){t=new FontFace(this.loadedName,this.data,{})}else{const e={weight:this.cssFontInfo.fontWeight};if(this.cssFontInfo.italicAngle){e.style=`oblique ${this.cssFontInfo.italicAngle}deg`}t=new FontFace(this.cssFontInfo.fontFamily,this.data,e)}this._inspectFont?.(this);return t}createFontFaceRule(){if(!this.data||this.disableFontFace){return null}const t=`url(data:${this.mimetype};base64,${tv(this.data)});`;let e;if(!this.cssFontInfo){e=`@font-face {font-family:"${this.loadedName}";src:${t}}`}else{let s=`font-weight: ${this.cssFontInfo.fontWeight};`;if(this.cssFontInfo.italicAngle){s+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`}e=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${s}src:${t}}`}this._inspectFont?.(this,t);return e}getPathGenerator(t,e){if(this.compiledGlyphs[e]!==undefined){return this.compiledGlyphs[e]}const s=this.loadedName+"_path_"+e;let i;try{i=t.get(s)}catch(t){N(`getPathGenerator - ignoring character: "${t}".`)}const n=new Path2D(i||"");if(!this.fontExtraProperties){t.delete(s)}return this.compiledGlyphs[e]=n}};const es={DATA:1,ERROR:2};const ei={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function en(){}function er(t){if(t instanceof Y||t instanceof W||t instanceof q||t instanceof j||t instanceof K||t instanceof V){return t}if(!(t instanceof Error||typeof t==="object"&&t!==null)){B('wrapReason: Expected "reason" to be a (possibly cloned) Error.')}switch(t.name){case"AbortException":return new Y(t.message);case"InvalidPDFException":return new W(t.message);case"MissingPDFException":return new q(t.message);case"PasswordException":return new j(t.message,t.code);case"UnexpectedResponseException":return new K(t.message,t.status);case"UnknownErrorException":return new V(t.message,t.details)}return new V(t.message,t.toString())}class ea{#eq=new AbortController;constructor(t,e,s){this.sourceName=t;this.targetName=e;this.comObj=s;this.callbackId=1;this.streamId=1;this.streamSinks=Object.create(null);this.streamControllers=Object.create(null);this.callbackCapabilities=Object.create(null);this.actionHandler=Object.create(null);s.addEventListener("message",this.#eK.bind(this),{signal:this.#eq.signal})}#eK({data:t}){if(t.targetName!==this.sourceName){return}if(t.stream){this.#eX(t);return}if(t.callback){const e=t.callbackId;const s=this.callbackCapabilities[e];if(!s){throw new Error(`Cannot resolve callback ${e}`)}delete this.callbackCapabilities[e];if(t.callback===es.DATA){s.resolve(t.data)}else if(t.callback===es.ERROR){s.reject(er(t.reason))}else{throw new Error("Unexpected callback case")}return}const e=this.actionHandler[t.action];if(!e){throw new Error(`Unknown action from worker: ${t.action}`)}if(t.callbackId){const s=this.sourceName,i=t.sourceName,n=this.comObj;Promise.try(e,t.data).then(function(e){n.postMessage({sourceName:s,targetName:i,callback:es.DATA,callbackId:t.callbackId,data:e})},function(e){n.postMessage({sourceName:s,targetName:i,callback:es.ERROR,callbackId:t.callbackId,reason:er(e)})});return}if(t.streamId){this.#eY(t);return}e(t.data)}on(t,e){const s=this.actionHandler;if(s[t]){throw new Error(`There is already an actionName called "${t}"`)}s[t]=e}send(t,e,s){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},s)}sendWithPromise(t,e,s){const i=this.callbackId++;const n=Promise.withResolvers();this.callbackCapabilities[i]=n;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:i,data:e},s)}catch(t){n.reject(t)}return n.promise}sendWithStream(t,e,s,i){const n=this.streamId++,r=this.sourceName,a=this.targetName,o=this.comObj;return new ReadableStream({start:s=>{const l=Promise.withResolvers();this.streamControllers[n]={controller:s,startCall:l,pullCall:null,cancelCall:null,isClosed:false};o.postMessage({sourceName:r,targetName:a,action:t,streamId:n,data:e,desiredSize:s.desiredSize},i);return l.promise},pull:t=>{const e=Promise.withResolvers();this.streamControllers[n].pullCall=e;o.postMessage({sourceName:r,targetName:a,stream:ei.PULL,streamId:n,desiredSize:t.desiredSize});return e.promise},cancel:t=>{H(t instanceof Error,"cancel must have a valid reason");const e=Promise.withResolvers();this.streamControllers[n].cancelCall=e;this.streamControllers[n].isClosed=true;o.postMessage({sourceName:r,targetName:a,stream:ei.CANCEL,streamId:n,reason:er(t)});return e.promise}},s)}#eY(t){const e=t.streamId,s=this.sourceName,i=t.sourceName,n=this.comObj;const r=this,a=this.actionHandler[t.action];const o={enqueue(t,r=1,a){if(this.isCancelled){return}const o=this.desiredSize;this.desiredSize-=r;if(o>0&&this.desiredSize<=0){this.sinkCapability=Promise.withResolvers();this.ready=this.sinkCapability.promise}n.postMessage({sourceName:s,targetName:i,stream:ei.ENQUEUE,streamId:e,chunk:t},a)},close(){if(this.isCancelled){return}this.isCancelled=true;n.postMessage({sourceName:s,targetName:i,stream:ei.CLOSE,streamId:e});delete r.streamSinks[e]},error(t){H(t instanceof Error,"error must have a valid reason");if(this.isCancelled){return}this.isCancelled=true;n.postMessage({sourceName:s,targetName:i,stream:ei.ERROR,streamId:e,reason:er(t)})},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:false,desiredSize:t.desiredSize,ready:null};o.sinkCapability.resolve();o.ready=o.sinkCapability.promise;this.streamSinks[e]=o;Promise.try(a,t.data,o).then(function(){n.postMessage({sourceName:s,targetName:i,stream:ei.START_COMPLETE,streamId:e,success:true})},function(t){n.postMessage({sourceName:s,targetName:i,stream:ei.START_COMPLETE,streamId:e,reason:er(t)})})}#eX(t){const e=t.streamId,s=this.sourceName,i=t.sourceName,n=this.comObj;const r=this.streamControllers[e],a=this.streamSinks[e];switch(t.stream){case ei.START_COMPLETE:if(t.success){r.startCall.resolve()}else{r.startCall.reject(er(t.reason))}break;case ei.PULL_COMPLETE:if(t.success){r.pullCall.resolve()}else{r.pullCall.reject(er(t.reason))}break;case ei.PULL:if(!a){n.postMessage({sourceName:s,targetName:i,stream:ei.PULL_COMPLETE,streamId:e,success:true});break}if(a.desiredSize<=0&&t.desiredSize>0){a.sinkCapability.resolve()}a.desiredSize=t.desiredSize;Promise.try(a.onPull||en).then(function(){n.postMessage({sourceName:s,targetName:i,stream:ei.PULL_COMPLETE,streamId:e,success:true})},function(t){n.postMessage({sourceName:s,targetName:i,stream:ei.PULL_COMPLETE,streamId:e,reason:er(t)})});break;case ei.ENQUEUE:H(r,"enqueue should have stream controller");if(r.isClosed){break}r.controller.enqueue(t.chunk);break;case ei.CLOSE:H(r,"close should have stream controller");if(r.isClosed){break}r.isClosed=true;r.controller.close();this.#eQ(r,e);break;case ei.ERROR:H(r,"error should have stream controller");r.controller.error(er(t.reason));this.#eQ(r,e);break;case ei.CANCEL_COMPLETE:if(t.success){r.cancelCall.resolve()}else{r.cancelCall.reject(er(t.reason))}this.#eQ(r,e);break;case ei.CANCEL:if(!a){break}const o=er(t.reason);Promise.try(a.onCancel||en,o).then(function(){n.postMessage({sourceName:s,targetName:i,stream:ei.CANCEL_COMPLETE,streamId:e,success:true})},function(t){n.postMessage({sourceName:s,targetName:i,stream:ei.CANCEL_COMPLETE,streamId:e,reason:er(t)})});a.sinkCapability.reject(o);a.isCancelled=true;delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}}async #eQ(t,e){await Promise.allSettled([t.startCall?.promise,t.pullCall?.promise,t.cancelCall?.promise]);delete this.streamControllers[e]}destroy(){this.#eq?.abort();this.#eq=null}};class eo{#eJ=false;constructor({enableHWA:t=false}){this.#eJ=t}create(t,e){if(t<=0||e<=0){throw new Error("Invalid canvas size")}const s=this._createCanvas(t,e);return{canvas:s,context:s.getContext("2d",{willReadFrequently:!this.#eJ})}}reset(t,e,s){if(!t.canvas){throw new Error("Canvas is not specified")}if(e<=0||s<=0){throw new Error("Invalid canvas size")}t.canvas.width=e;t.canvas.height=s}destroy(t){if(!t.canvas){throw new Error("Canvas is not specified")}t.canvas.width=0;t.canvas.height=0;t.canvas=null;t.context=null}_createCanvas(t,e){B("Abstract method `_createCanvas` called.")}}class el extends eo{constructor({ownerDocument:t=globalThis.document,enableHWA:e=false}){super({enableHWA:e});this._document=t}_createCanvas(t,e){const s=this._document.createElement("canvas");s.width=t;s.height=e;return s}};class eh{constructor({baseUrl:t=null,isCompressed:e=true}){this.baseUrl=t;this.isCompressed=e}async fetch({name:t}){if(!this.baseUrl){throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.")}if(!t){throw new Error("CMap name must be specified.")}const e=this.baseUrl+t+(this.isCompressed?".bcmap":"");return this._fetch(e).then(t=>({cMapData:t,isCompressed:this.isCompressed})).catch(t=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${e}`)})}async _fetch(t){B("Abstract method `_fetch` called.")}}class ec extends eh{async _fetch(t){const e=await tx(t,this.isCompressed?"arraybuffer":"text");return e instanceof ArrayBuffer?new Uint8Array(e):J(e)}};class ed{addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,e,s,i,n){return"none"}destroy(t=false){}}class eu extends ed{#eZ;#e0;#e1;#e2;#e3;#e5;#v=0;constructor({docId:t,ownerDocument:e=globalThis.document}){super();this.#e2=t;this.#e3=e}get #w(){return this.#e0||=new Map}get #e6(){return this.#e5||=new Map}get #e4(){if(!this.#e1){const t=this.#e3.createElement("div");const{style:e}=t;e.visibility="hidden";e.contain="strict";e.width=e.height=0;e.position="absolute";e.top=e.left=0;e.zIndex=-1;const s=this.#e3.createElementNS(tw,"svg");s.setAttribute("width",0);s.setAttribute("height",0);this.#e1=this.#e3.createElementNS(tw,"defs");t.append(s);s.append(this.#e1);this.#e3.body.append(t)}return this.#e1}#e8(t){if(t.length===1){const e=t[0];const s=new Array(256);for(let t=0;t<256;t++){s[t]=e[t]/255}const i=s.join(",");return[i,i,i]}const[e,s,i]=t;const n=new Array(256);const r=new Array(256);const a=new Array(256);for(let t=0;t<256;t++){n[t]=e[t]/255;r[t]=s[t]/255;a[t]=i[t]/255}return[n.join(","),r.join(","),a.join(",")]}#e7(t){if(this.#eZ===undefined){this.#eZ="";const t=this.#e3.URL;if(t!==this.#e3.baseURI){if(tC(t)){N('#createUrl: ignore "data:"-URL for performance reasons.')}else{this.#eZ=t.split("#",1)[0]}}}return`url(${this.#eZ}#${t})`}addFilter(t){if(!t){return"none"}let e=this.#w.get(t);if(e){return e}const[s,i,n]=this.#e8(t);const r=t.length===1?s:`${s}${i}${n}`;e=this.#w.get(r);if(e){this.#w.set(t,e);return e}const a=`g_${this.#e2}_transfer_map_${this.#v++}`;const o=this.#e7(a);this.#w.set(t,o);this.#w.set(r,o);const l=this.#e9(a);this.#st(s,i,n,l);return o}addHCMFilter(t,e){const s=`${t}-${e}`;const i="base";let n=this.#e6.get(i);if(n?.key===s){return n.url}if(n){n.filter?.remove();n.key=s;n.url="none";n.filter=null}else{n={key:s,url:"none",filter:null};this.#e6.set(i,n)}if(!t||!e){return n.url}const r=this.#se(t);t=ta.makeHexColor(...r);const a=this.#se(e);e=ta.makeHexColor(...a);this.#e4.style.color="";if(t==="#000000"&&e==="#ffffff"||t===e){return n.url}const o=new Array(256);for(let t=0;t<=255;t++){const e=t/255;o[t]=e<=.03928?e/12.92:((e+.055)/1.055)**2.4}const l=o.join(",");const h=`g_${this.#e2}_hcm_filter`;const c=n.filter=this.#e9(h);this.#st(l,l,l,c);this.#ss(c);const d=(t,e)=>{const s=r[t]/255;const i=a[t]/255;const n=new Array(e+1);for(let t=0;t<=e;t++){n[t]=s+t/e*(i-s)}return n.join(",")};this.#st(d(0,5),d(1,5),d(2,5),c);n.url=this.#e7(h);return n.url}addAlphaFilter(t){let e=this.#w.get(t);if(e){return e}const[s]=this.#e8([t]);const i=`alpha_${s}`;e=this.#w.get(i);if(e){this.#w.set(t,e);return e}const n=`g_${this.#e2}_alpha_map_${this.#v++}`;const r=this.#e7(n);this.#w.set(t,r);this.#w.set(i,r);const a=this.#e9(n);this.#si(s,a);return r}addLuminosityFilter(t){let e=this.#w.get(t||"luminosity");if(e){return e}let s,i;if(t){[s]=this.#e8([t]);i=`luminosity_${s}`}else{i="luminosity"}e=this.#w.get(i);if(e){this.#w.set(t,e);return e}const n=`g_${this.#e2}_luminosity_map_${this.#v++}`;const r=this.#e7(n);this.#w.set(t,r);this.#w.set(i,r);const a=this.#e9(n);this.#sn(a);if(t){this.#si(s,a)}return r}addHighlightHCMFilter(t,e,s,i,n){const r=`${e}-${s}-${i}-${n}`;let a=this.#e6.get(t);if(a?.key===r){return a.url}if(a){a.filter?.remove();a.key=r;a.url="none";a.filter=null}else{a={key:r,url:"none",filter:null};this.#e6.set(t,a)}if(!e||!s){return a.url}const[o,l]=[e,s].map(this.#se.bind(this));let h=Math.round(.2126*o[0]+.7152*o[1]+.0722*o[2]);let c=Math.round(.2126*l[0]+.7152*l[1]+.0722*l[2]);let[d,u]=[i,n].map(this.#se.bind(this));if(c<h){[h,c,d,u]=[c,h,u,d]}this.#e4.style.color="";const f=(t,e,s)=>{const i=new Array(256);const n=(c-h)/s;const r=t/255;const a=(e-t)/(255*s);let o=0;for(let t=0;t<=s;t++){const e=Math.round(h+t*n);const s=r+t*a;for(let t=o;t<=e;t++){i[t]=s}o=e+1}for(let t=o;t<256;t++){i[t]=i[o-1]}return i.join(",")};const p=`g_${this.#e2}_hcm_${t}_filter`;const g=a.filter=this.#e9(p);this.#ss(g);this.#st(f(d[0],u[0],5),f(d[1],u[1],5),f(d[2],u[2],5),g);a.url=this.#e7(p);return a.url}destroy(t=false){if(t&&this.#e5?.size){return}this.#e1?.parentNode.parentNode.remove();this.#e1=null;this.#e0?.clear();this.#e0=null;this.#e5?.clear();this.#e5=null;this.#v=0}#sn(t){const e=this.#e3.createElementNS(tw,"feColorMatrix");e.setAttribute("type","matrix");e.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0");t.append(e)}#ss(t){const e=this.#e3.createElementNS(tw,"feColorMatrix");e.setAttribute("type","matrix");e.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0");t.append(e)}#e9(t){const e=this.#e3.createElementNS(tw,"filter");e.setAttribute("color-interpolation-filters","sRGB");e.setAttribute("id",t);this.#e4.append(e);return e}#sr(t,e,s){const i=this.#e3.createElementNS(tw,e);i.setAttribute("type","discrete");i.setAttribute("tableValues",s);t.append(i)}#st(t,e,s,i){const n=this.#e3.createElementNS(tw,"feComponentTransfer");i.append(n);this.#sr(n,"feFuncR",t);this.#sr(n,"feFuncG",e);this.#sr(n,"feFuncB",s)}#si(t,e){const s=this.#e3.createElementNS(tw,"feComponentTransfer");e.append(s);this.#sr(s,"feFuncA",t)}#se(t){this.#e4.style.color=t;return tN(getComputedStyle(this.#e4).getPropertyValue("color"))}};class ef{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl){throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.")}if(!t){throw new Error("Font filename must be specified.")}const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(t=>{throw new Error(`Unable to load font data at: ${e}`)})}async _fetch(t){B("Abstract method `_fetch` called.")}}class ep extends ef{async _fetch(t){const e=await tx(t,"arraybuffer");return new Uint8Array(e)}};if(o){N("Please use the `legacy` build in Node.js environments.")}async function eg(t){const e=i.getBuiltinModule("fs");const s=await e.promises.readFile(t);return new Uint8Array(s)}class em extends ed{}class eb extends eo{_createCanvas(t,e){const s=i.getBuiltinModule("module").createRequire("file:///data/data/com.termux/files/home/doc-ai-app/node_modules/pdfjs-dist/build/pdf.mjs");const n=s("@napi-rs/canvas");return n.createCanvas(t,e)}}class eA extends eh{async _fetch(t){return eg(t)}}class ev extends ef{async _fetch(t){return eg(t)}};const ey={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function ew(t,e){if(!e){return}const s=e[2]-e[0];const i=e[3]-e[1];const n=new Path2D;n.rect(e[0],e[1],s,i);t.clip(n)}class e_{getPattern(){B("Abstract method `getPattern` called.")}}class ex extends e_{constructor(t){super();this._type=t[1];this._bbox=t[2];this._colorStops=t[3];this._p0=t[4];this._p1=t[5];this._r0=t[6];this._r1=t[7];this.matrix=null}_createGradient(t){let e;if(this._type==="axial"){e=t.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1])}else if(this._type==="radial"){e=t.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1)}for(const t of this._colorStops){e.addColorStop(t[0],t[1])}return e}getPattern(t,e,s,i){let n;if(i===ey.STROKE||i===ey.FILL){const r=e.current.getClippedPathBoundingBox(i,tH(t))||[0,0,0,0];const a=Math.ceil(r[2]-r[0])||1;const o=Math.ceil(r[3]-r[1])||1;const l=e.cachedCanvases.getCanvas("pattern",a,o);const h=l.context;h.clearRect(0,0,h.canvas.width,h.canvas.height);h.beginPath();h.rect(0,0,h.canvas.width,h.canvas.height);h.translate(-r[0],-r[1]);s=ta.transform(s,[1,0,0,1,r[0],r[1]]);h.transform(...e.baseTransform);if(this.matrix){h.transform(...this.matrix)}ew(h,this._bbox);h.fillStyle=this._createGradient(h);h.fill();n=t.createPattern(l.canvas,"no-repeat");const c=new DOMMatrix(s);n.setTransform(c)}else{ew(t,this._bbox);n=this._createGradient(t)}return n}}function eE(t,e,s,i,n,r,a,o){const l=e.coords,h=e.colors;const c=t.data,d=t.width*4;let u;if(l[s+1]>l[i+1]){u=s;s=i;i=u;u=r;r=a;a=u}if(l[i+1]>l[n+1]){u=i;i=n;n=u;u=a;a=o;o=u}if(l[s+1]>l[i+1]){u=s;s=i;i=u;u=r;r=a;a=u}const f=(l[s]+e.offsetX)*e.scaleX;const p=(l[s+1]+e.offsetY)*e.scaleY;const g=(l[i]+e.offsetX)*e.scaleX;const m=(l[i+1]+e.offsetY)*e.scaleY;const b=(l[n]+e.offsetX)*e.scaleX;const A=(l[n+1]+e.offsetY)*e.scaleY;if(p>=A){return}const v=h[r],y=h[r+1],w=h[r+2];const _=h[a],x=h[a+1],E=h[a+2];const S=h[o],C=h[o+1],T=h[o+2];const M=Math.round(p),P=Math.round(A);let I,R,k,D;let L,F,O,N;for(let t=M;t<=P;t++){if(t<m){const e=t<p?0:(p-t)/(p-m);I=f-(f-g)*e;R=v-(v-_)*e;k=y-(y-x)*e;D=w-(w-E)*e}else{let e;if(t>A){e=1}else if(m===A){e=0}else{e=(m-t)/(m-A)}I=g-(g-b)*e;R=_-(_-S)*e;k=x-(x-C)*e;D=E-(E-T)*e}let e;if(t<p){e=0}else if(t>A){e=1}else{e=(p-t)/(p-A)}L=f-(f-b)*e;F=v-(v-S)*e;O=y-(y-C)*e;N=w-(w-T)*e;const s=Math.round(Math.min(I,L));const i=Math.round(Math.max(I,L));let n=d*t+s*4;for(let t=s;t<=i;t++){e=(I-t)/(I-L);if(e<0){e=0}else if(e>1){e=1}c[n++]=R-(R-F)*e|0;c[n++]=k-(k-O)*e|0;c[n++]=D-(D-N)*e|0;c[n++]=255}}}function eS(t,e,s){const i=e.coords;const n=e.colors;let r,a;switch(e.type){case"lattice":const o=e.verticesPerRow;const l=Math.floor(i.length/o)-1;const h=o-1;for(r=0;r<l;r++){let e=r*o;for(let r=0;r<h;r++,e++){eE(t,s,i[e],i[e+1],i[e+o],n[e],n[e+1],n[e+o]);eE(t,s,i[e+o+1],i[e+1],i[e+o],n[e+o+1],n[e+1],n[e+o])}}break;case"triangles":for(r=0,a=i.length;r<a;r+=3){eE(t,s,i[r],i[r+1],i[r+2],n[r],n[r+1],n[r+2])}break;default:throw new Error("illegal figure")}}class eC extends e_{constructor(t){super();this._coords=t[2];this._colors=t[3];this._figures=t[4];this._bounds=t[5];this._bbox=t[7];this._background=t[8];this.matrix=null}_createMeshCanvas(t,e,s){const i=1.1;const n=3e3;const r=2;const a=Math.floor(this._bounds[0]);const o=Math.floor(this._bounds[1]);const l=Math.ceil(this._bounds[2])-a;const h=Math.ceil(this._bounds[3])-o;const c=Math.min(Math.ceil(Math.abs(l*t[0]*i)),n);const d=Math.min(Math.ceil(Math.abs(h*t[1]*i)),n);const u=l/c;const f=h/d;const p={coords:this._coords,colors:this._colors,offsetX:-a,offsetY:-o,scaleX:1/u,scaleY:1/f};const g=c+r*2;const m=d+r*2;const b=s.getCanvas("mesh",g,m);const A=b.context;const v=A.createImageData(c,d);if(e){const t=v.data;for(let s=0,i=t.length;s<i;s+=4){t[s]=e[0];t[s+1]=e[1];t[s+2]=e[2];t[s+3]=255}}for(const t of this._figures){eS(v,t,p)}A.putImageData(v,r,r);const y=b.canvas;return{canvas:y,offsetX:a-r*u,offsetY:o-r*f,scaleX:u,scaleY:f}}getPattern(t,e,s,i){ew(t,this._bbox);let n;if(i===ey.SHADING){n=ta.singularValueDecompose2dScale(tH(t))}else{n=ta.singularValueDecompose2dScale(e.baseTransform);if(this.matrix){const t=ta.singularValueDecompose2dScale(this.matrix);n=[n[0]*t[0],n[1]*t[1]]}}const r=this._createMeshCanvas(n,i===ey.SHADING?null:this._background,e.cachedCanvases);if(i!==ey.SHADING){t.setTransform(...e.baseTransform);if(this.matrix){t.transform(...this.matrix)}}t.translate(r.offsetX,r.offsetY);t.scale(r.scaleX,r.scaleY);return t.createPattern(r.canvas,"no-repeat")}}class eT extends e_{getPattern(){return"hotpink"}}function eM(t){switch(t[0]){case"RadialAxial":return new ex(t);case"Mesh":return new eC(t);case"Dummy":return new eT}throw new Error(`Unknown IR type: ${t[0]}`)}const eP={COLORED:1,UNCOLORED:2};class eI{static MAX_PATTERN_SIZE=3e3;constructor(t,e,s,i,n){this.operatorList=t[2];this.matrix=t[3];this.bbox=t[4];this.xstep=t[5];this.ystep=t[6];this.paintType=t[7];this.tilingType=t[8];this.color=e;this.ctx=s;this.canvasGraphicsFactory=i;this.baseTransform=n}createPatternCanvas(t){const{bbox:e,operatorList:s,paintType:i,tilingType:n,color:r,canvasGraphicsFactory:a}=this;let{xstep:o,ystep:l}=this;o=Math.abs(o);l=Math.abs(l);O("TilingType: "+n);const h=e[0],c=e[1],d=e[2],u=e[3];const f=d-h;const p=u-c;const g=ta.singularValueDecompose2dScale(this.matrix);const m=ta.singularValueDecompose2dScale(this.baseTransform);const b=g[0]*m[0];const A=g[1]*m[1];let v=f,y=p,w=false,_=false;const x=Math.ceil(o*b);const E=Math.ceil(l*A);const S=Math.ceil(f*b);const C=Math.ceil(p*A);if(x>=S){v=o}else{w=true}if(E>=C){y=l}else{_=true}const T=this.getSizeAndScale(v,this.ctx.canvas.width,b);const M=this.getSizeAndScale(y,this.ctx.canvas.height,A);const P=t.cachedCanvases.getCanvas("pattern",T.size,M.size);const I=P.context;const R=a.createCanvasGraphics(I);R.groupLevel=t.groupLevel;this.setFillAndStrokeStyleToContext(R,i,r);I.translate(-T.scale*h,-M.scale*c);R.transform(T.scale,0,0,M.scale,0,0);I.save();this.clipBbox(R,h,c,d,u);R.baseTransform=tH(R.ctx);R.executeOperatorList(s);R.endDrawing();I.restore();if(w||_){const e=P.canvas;if(w){v=o}if(_){y=l}const s=this.getSizeAndScale(v,this.ctx.canvas.width,b);const i=this.getSizeAndScale(y,this.ctx.canvas.height,A);const n=s.size;const r=i.size;const a=t.cachedCanvases.getCanvas("pattern-workaround",n,r);const d=a.context;const u=w?Math.floor(f/o):0;const g=_?Math.floor(p/l):0;for(let t=0;t<=u;t++){for(let s=0;s<=g;s++){d.drawImage(e,n*t,r*s,n,r,0,0,n,r)}}return{canvas:a.canvas,scaleX:s.scale,scaleY:i.scale,offsetX:h,offsetY:c}}return{canvas:P.canvas,scaleX:T.scale,scaleY:M.scale,offsetX:h,offsetY:c}}getSizeAndScale(t,e,s){const i=Math.max(eI.MAX_PATTERN_SIZE,e);let n=Math.ceil(t*s);if(n>=i){n=i}else{s=n/t}return{scale:s,size:n}}clipBbox(t,e,s,i,n){const r=i-e;const a=n-s;t.ctx.rect(e,s,r,a);t.current.updateRectMinMax(tH(t.ctx),[e,s,i,n]);t.clip();t.endPath()}setFillAndStrokeStyleToContext(t,e,s){const i=t.ctx,n=t.current;switch(e){case eP.COLORED:const r=this.ctx;i.fillStyle=r.fillStyle;i.strokeStyle=r.strokeStyle;n.fillColor=r.fillStyle;n.strokeColor=r.strokeStyle;break;case eP.UNCOLORED:const a=ta.makeHexColor(s[0],s[1],s[2]);i.fillStyle=a;i.strokeStyle=a;n.fillColor=a;n.strokeColor=a;break;default:throw new X(`Unsupported paint type: ${e}`)}}getPattern(t,e,s,i){let n=s;if(i!==ey.SHADING){n=ta.transform(n,e.baseTransform);if(this.matrix){n=ta.transform(n,this.matrix)}}const r=this.createPatternCanvas(e);let a=new DOMMatrix(n);a=a.translate(r.offsetX,r.offsetY);a=a.scale(1/r.scaleX,1/r.scaleY);const o=t.createPattern(r.canvas,"repeat");o.setTransform(a);return o}};function eR(t){switch(t.kind){case ImageKind.GRAYSCALE_1BPP:return ek(t);case ImageKind.RGB_24BPP:return eD(t)}return null}function ek({src:t,srcPos:e=0,dest:s,width:i,height:n,nonBlackColor:r=0xffffffff,inverseDecode:a=false}){const o=tn.isLittleEndian?0xff000000:255;const[l,h]=a?[r,o]:[o,r];const c=i>>3;const d=i&7;const u=t.length;s=new Uint32Array(s.buffer);let f=0;for(let i=0;i<n;i++){for(const i=e+c;e<i;e++){const i=e<u?t[e]:255;s[f++]=i&128?h:l;s[f++]=i&64?h:l;s[f++]=i&32?h:l;s[f++]=i&16?h:l;s[f++]=i&8?h:l;s[f++]=i&4?h:l;s[f++]=i&2?h:l;s[f++]=i&1?h:l}if(d===0){continue}const i=e<u?t[e++]:255;for(let t=0;t<d;t++){s[f++]=i&1<<7-t?h:l}}return{srcPos:e,destPos:f}}function eD({src:t,srcPos:e=0,dest:s,destPos:i=0,width:n,height:r}){let a=0;const o=n*r*3;const l=o>>2;const h=new Uint32Array(t.buffer,e,l);if(FeatureTest.isLittleEndian){for(;a<l-2;a+=3,i+=4){const t=h[a];const e=h[a+1];const n=h[a+2];s[i]=t|0xff000000;s[i+1]=t>>>24|e<<8|0xff000000;s[i+2]=e>>>16|n<<16|0xff000000;s[i+3]=n>>>8|0xff000000}for(let n=a*4,r=e+o;n<r;n+=3){s[i++]=t[n]|t[n+1]<<8|t[n+2]<<16|0xff000000}}else{for(;a<l-2;a+=3,i+=4){const t=h[a];const e=h[a+1];const n=h[a+2];s[i]=t|255;s[i+1]=t<<24|e>>>8|255;s[i+2]=e<<16|n>>>16|255;s[i+3]=n<<8|255}for(let n=a*4,r=e+o;n<r;n+=3){s[i++]=t[n]<<24|t[n+1]<<16|t[n+2]<<8|255}}return{srcPos:e+o,destPos:i}}function eL(t,e){if(FeatureTest.isLittleEndian){for(let s=0,i=t.length;s<i;s++){e[s]=t[s]*65793|0xff000000}}else{for(let s=0,i=t.length;s<i;s++){e[s]=t[s]*0x1010100|255}}};const eF=16;const eO=100;const eN=15;const eB=10;const eH=1e3;const ez=16;function eU(t,e){if(t._removeMirroring){throw new Error("Context is already forwarding operations.")}t.__originalSave=t.save;t.__originalRestore=t.restore;t.__originalRotate=t.rotate;t.__originalScale=t.scale;t.__originalTranslate=t.translate;t.__originalTransform=t.transform;t.__originalSetTransform=t.setTransform;t.__originalResetTransform=t.resetTransform;t.__originalClip=t.clip;t.__originalMoveTo=t.moveTo;t.__originalLineTo=t.lineTo;t.__originalBezierCurveTo=t.bezierCurveTo;t.__originalRect=t.rect;t.__originalClosePath=t.closePath;t.__originalBeginPath=t.beginPath;t._removeMirroring=()=>{t.save=t.__originalSave;t.restore=t.__originalRestore;t.rotate=t.__originalRotate;t.scale=t.__originalScale;t.translate=t.__originalTranslate;t.transform=t.__originalTransform;t.setTransform=t.__originalSetTransform;t.resetTransform=t.__originalResetTransform;t.clip=t.__originalClip;t.moveTo=t.__originalMoveTo;t.lineTo=t.__originalLineTo;t.bezierCurveTo=t.__originalBezierCurveTo;t.rect=t.__originalRect;t.closePath=t.__originalClosePath;t.beginPath=t.__originalBeginPath;delete t._removeMirroring};t.save=function t(){e.save();this.__originalSave()};t.restore=function t(){e.restore();this.__originalRestore()};t.translate=function t(t,s){e.translate(t,s);this.__originalTranslate(t,s)};t.scale=function t(t,s){e.scale(t,s);this.__originalScale(t,s)};t.transform=function t(t,s,i,n,r,a){e.transform(t,s,i,n,r,a);this.__originalTransform(t,s,i,n,r,a)};t.setTransform=function t(t,s,i,n,r,a){e.setTransform(t,s,i,n,r,a);this.__originalSetTransform(t,s,i,n,r,a)};t.resetTransform=function t(){e.resetTransform();this.__originalResetTransform()};t.rotate=function t(t){e.rotate(t);this.__originalRotate(t)};t.clip=function t(t){e.clip(t);this.__originalClip(t)};t.moveTo=function(t,s){e.moveTo(t,s);this.__originalMoveTo(t,s)};t.lineTo=function(t,s){e.lineTo(t,s);this.__originalLineTo(t,s)};t.bezierCurveTo=function(t,s,i,n,r,a){e.bezierCurveTo(t,s,i,n,r,a);this.__originalBezierCurveTo(t,s,i,n,r,a)};t.rect=function(t,s,i,n){e.rect(t,s,i,n);this.__originalRect(t,s,i,n)};t.closePath=function(){e.closePath();this.__originalClosePath()};t.beginPath=function(){e.beginPath();this.__originalBeginPath()}}class e${constructor(t){this.canvasFactory=t;this.cache=Object.create(null)}getCanvas(t,e,s){let i;if(this.cache[t]!==undefined){i=this.cache[t];this.canvasFactory.reset(i,e,s)}else{i=this.canvasFactory.create(e,s);this.cache[t]=i}return i}delete(t){delete this.cache[t]}clear(){for(const t in this.cache){const e=this.cache[t];this.canvasFactory.destroy(e);delete this.cache[t]}}}function eG(t,e,s,i,n,r,a,o,l,h){const[c,d,u,f,p,g]=tH(t);if(d===0&&u===0){const m=a*c+p;const b=Math.round(m);const A=o*f+g;const v=Math.round(A);const y=(a+l)*c+p;const w=Math.abs(Math.round(y)-b)||1;const _=(o+h)*f+g;const x=Math.abs(Math.round(_)-v)||1;t.setTransform(Math.sign(c),0,0,Math.sign(f),b,v);t.drawImage(e,s,i,n,r,0,0,w,x);t.setTransform(c,d,u,f,p,g);return[w,x]}if(c===0&&f===0){const m=o*u+p;const b=Math.round(m);const A=a*d+g;const v=Math.round(A);const y=(o+h)*u+p;const w=Math.abs(Math.round(y)-b)||1;const _=(a+l)*d+g;const x=Math.abs(Math.round(_)-v)||1;t.setTransform(0,Math.sign(d),Math.sign(u),0,b,v);t.drawImage(e,s,i,n,r,0,0,x,w);t.setTransform(c,d,u,f,p,g);return[x,w]}t.drawImage(e,s,i,n,r,a,o,l,h);const m=Math.hypot(c,d);const b=Math.hypot(u,f);return[m*l,b*h]}function ej(t){const{width:e,height:s}=t;if(e>eH||s>eH){return null}const i=1e3;const n=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]);const r=e+1;let a=new Uint8Array(r*(s+1));let o,l,h;const c=e+7&~7;let d=new Uint8Array(c*s),u=0;for(const e of t.data){let t=128;while(t>0){d[u++]=e&t?0:255;t>>=1}}let f=0;u=0;if(d[u]!==0){a[0]=1;++f}for(l=1;l<e;l++){if(d[u]!==d[u+1]){a[l]=d[u]?2:1;++f}u++}if(d[u]!==0){a[l]=2;++f}for(o=1;o<s;o++){u=o*c;h=o*r;if(d[u-c]!==d[u]){a[h]=d[u]?1:8;++f}let t=(d[u]?4:0)+(d[u-c]?8:0);for(l=1;l<e;l++){t=(t>>2)+(d[u+1]?4:0)+(d[u-c+1]?8:0);if(n[t]){a[h+l]=n[t];++f}u++}if(d[u-c]!==d[u]){a[h+l]=d[u]?2:4;++f}if(f>i){return null}}u=c*(s-1);h=o*r;if(d[u]!==0){a[h]=8;++f}for(l=1;l<e;l++){if(d[u]!==d[u+1]){a[h+l]=d[u]?4:8;++f}u++}if(d[u]!==0){a[h+l]=4;++f}if(f>i){return null}const p=new Int32Array([0,r,-1,0,-r,0,0,0,1]);const g=new Path2D;for(o=0;f&&o<=s;o++){let t=o*r;const s=t+e;while(t<s&&!a[t]){t++}if(t===s){continue}g.moveTo(t%r,o);const i=t;let n=a[t];do{const e=p[n];do{t+=e}while(!a[t]);const s=a[t];if(s!==5&&s!==10){n=s;a[t]=0}else{n=s&51*n>>4;a[t]&=n>>2|n<<2}g.lineTo(t%r,t/r|0);if(!a[t]){--f}}while(i!==t);--o}d=null;a=null;const m=function(t){t.save();t.scale(1/e,-1/s);t.translate(0,-s);t.fill(g);t.beginPath();t.restore()};return m}class eV{constructor(t,e){this.alphaIsShape=false;this.fontSize=0;this.fontSizeScale=1;this.textMatrix=l;this.textMatrixScale=1;this.fontMatrix=h;this.leading=0;this.x=0;this.y=0;this.lineX=0;this.lineY=0;this.charSpacing=0;this.wordSpacing=0;this.textHScale=1;this.textRenderingMode=y.FILL;this.textRise=0;this.fillColor="#000000";this.strokeColor="#000000";this.patternFill=false;this.patternStroke=false;this.fillAlpha=1;this.strokeAlpha=1;this.lineWidth=1;this.activeSMask=null;this.transferMaps="none";this.startNewPathAndClipBox([0,0,t,e])}clone(){const t=Object.create(this);t.clipBox=this.clipBox.slice();return t}setCurrentPoint(t,e){this.x=t;this.y=e}updatePathMinMax(t,e,s){[e,s]=ta.applyTransform([e,s],t);this.minX=Math.min(this.minX,e);this.minY=Math.min(this.minY,s);this.maxX=Math.max(this.maxX,e);this.maxY=Math.max(this.maxY,s)}updateRectMinMax(t,e){const s=ta.applyTransform(e,t);const i=ta.applyTransform(e.slice(2),t);const n=ta.applyTransform([e[0],e[3]],t);const r=ta.applyTransform([e[2],e[1]],t);this.minX=Math.min(this.minX,s[0],i[0],n[0],r[0]);this.minY=Math.min(this.minY,s[1],i[1],n[1],r[1]);this.maxX=Math.max(this.maxX,s[0],i[0],n[0],r[0]);this.maxY=Math.max(this.maxY,s[1],i[1],n[1],r[1])}updateScalingPathMinMax(t,e){ta.scaleMinMax(t,e);this.minX=Math.min(this.minX,e[0]);this.minY=Math.min(this.minY,e[1]);this.maxX=Math.max(this.maxX,e[2]);this.maxY=Math.max(this.maxY,e[3])}updateCurvePathMinMax(t,e,s,i,n,r,a,o,l,h){const c=ta.bezierBoundingBox(e,s,i,n,r,a,o,l,h);if(h){return}this.updateRectMinMax(t,c)}getPathBoundingBox(t=ey.FILL,e=null){const s=[this.minX,this.minY,this.maxX,this.maxY];if(t===ey.STROKE){if(!e){B("Stroke bounding box must include transform.")}const t=ta.singularValueDecompose2dScale(e);const i=t[0]*this.lineWidth/2;const n=t[1]*this.lineWidth/2;s[0]-=i;s[1]-=n;s[2]+=i;s[3]+=n}return s}updateClipFromPath(){const t=ta.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minX===Infinity}startNewPathAndClipBox(t){this.clipBox=t;this.minX=Infinity;this.minY=Infinity;this.maxX=0;this.maxY=0}getClippedPathBoundingBox(t=ey.FILL,e=null){return ta.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}function eW(t,e){if(e instanceof ImageData){t.putImageData(e,0,0);return}const s=e.height,i=e.width;const n=s%ez;const r=(s-n)/ez;const a=n===0?r:r+1;const o=t.createImageData(i,ez);let l=0,h;const c=e.data;const d=o.data;let u,f,p,g;if(e.kind===w.GRAYSCALE_1BPP){const e=c.byteLength;const s=new Uint32Array(d.buffer,0,d.byteLength>>2);const g=s.length;const m=i+7>>3;const b=0xffffffff;const A=tn.isLittleEndian?0xff000000:255;for(u=0;u<a;u++){p=u<r?ez:n;h=0;for(f=0;f<p;f++){const t=e-l;let n=0;const r=t>m?i:t*8-7;const a=r&~7;let o=0;let d=0;for(;n<a;n+=8){d=c[l++];s[h++]=d&128?b:A;s[h++]=d&64?b:A;s[h++]=d&32?b:A;s[h++]=d&16?b:A;s[h++]=d&8?b:A;s[h++]=d&4?b:A;s[h++]=d&2?b:A;s[h++]=d&1?b:A}for(;n<r;n++){if(o===0){d=c[l++];o=128}s[h++]=d&o?b:A;o>>=1}}while(h<g){s[h++]=0}t.putImageData(o,0,u*ez)}}else if(e.kind===w.RGBA_32BPP){f=0;g=i*ez*4;for(u=0;u<r;u++){d.set(c.subarray(l,l+g));l+=g;t.putImageData(o,0,f);f+=ez}if(u<a){g=i*n*4;d.set(c.subarray(l,l+g));t.putImageData(o,0,f)}}else if(e.kind===w.RGB_24BPP){p=ez;g=i*p;for(u=0;u<a;u++){if(u>=r){p=n;g=i*p}h=0;for(f=g;f--;){d[h++]=c[l++];d[h++]=c[l++];d[h++]=c[l++];d[h++]=255}t.putImageData(o,0,u*ez)}}else{throw new Error(`bad image kind: ${e.kind}`)}}function eq(t,e){if(e.bitmap){t.drawImage(e.bitmap,0,0);return}const s=e.height,i=e.width;const n=s%ez;const r=(s-n)/ez;const a=n===0?r:r+1;const o=t.createImageData(i,ez);let l=0;const h=e.data;const c=o.data;for(let e=0;e<a;e++){const s=e<r?ez:n;({srcPos:l}=ek({src:h,srcPos:l,dest:c,width:i,height:s,nonBlackColor:0}));t.putImageData(o,0,e*ez)}}function eK(t,e){const s=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const i of s){if(t[i]!==undefined){e[i]=t[i]}}if(t.setLineDash!==undefined){e.setLineDash(t.getLineDash());e.lineDashOffset=t.lineDashOffset}}function eX(t){t.strokeStyle=t.fillStyle="#000000";t.fillRule="nonzero";t.globalAlpha=1;t.lineWidth=1;t.lineCap="butt";t.lineJoin="miter";t.miterLimit=10;t.globalCompositeOperation="source-over";t.font="10px sans-serif";if(t.setLineDash!==undefined){t.setLineDash([]);t.lineDashOffset=0}if(!o){const{filter:e}=t;if(e!=="none"&&e!==""){t.filter="none"}}}function eY(t,e){if(e){return true}const s=ta.singularValueDecompose2dScale(t);s[0]=Math.fround(s[0]);s[1]=Math.fround(s[1]);const i=Math.fround((globalThis.devicePixelRatio||1)*t_.PDF_TO_CSS_UNITS);return s[0]<=i&&s[1]<=i}const eQ=["butt","round","square"];const eJ=["miter","round","bevel"];const eZ={};const e0={};class e1{constructor(t,e,s,i,n,{optionalContentConfig:r,markedContentStack:a=null},o,l){this.ctx=t;this.current=new eV(this.ctx.canvas.width,this.ctx.canvas.height);this.stateStack=[];this.pendingClip=null;this.pendingEOFill=false;this.res=null;this.xobjs=null;this.commonObjs=e;this.objs=s;this.canvasFactory=i;this.filterFactory=n;this.groupStack=[];this.processingType3=null;this.baseTransform=null;this.baseTransformStack=[];this.groupLevel=0;this.smaskStack=[];this.smaskCounter=0;this.tempSMask=null;this.suspendedCtx=null;this.contentVisible=true;this.markedContentStack=a||[];this.optionalContentConfig=r;this.cachedCanvases=new e$(this.canvasFactory);this.cachedPatterns=new Map;this.annotationCanvasMap=o;this.viewportScale=1;this.outputScaleX=1;this.outputScaleY=1;this.pageColors=l;this._cachedScaleForStroking=[-1,0];this._cachedGetSinglePixelWidth=null;this._cachedBitmapsMap=new Map}getObject(t,e=null){if(typeof t==="string"){return t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t)}return e}beginDrawing({transform:t,viewport:e,transparency:s=false,background:i=null}){const n=this.ctx.canvas.width;const r=this.ctx.canvas.height;const a=this.ctx.fillStyle;this.ctx.fillStyle=i||"#ffffff";this.ctx.fillRect(0,0,n,r);this.ctx.fillStyle=a;if(s){const t=this.cachedCanvases.getCanvas("transparent",n,r);this.compositeCtx=this.ctx;this.transparentCanvas=t.canvas;this.ctx=t.context;this.ctx.save();this.ctx.transform(...tH(this.compositeCtx))}this.ctx.save();eX(this.ctx);if(t){this.ctx.transform(...t);this.outputScaleX=t[0];this.outputScaleY=t[0]}this.ctx.transform(...e.transform);this.viewportScale=e.scale;this.baseTransform=tH(this.ctx)}executeOperatorList(t,e,s,i){const n=t.argsArray;const r=t.fnArray;let a=e||0;const o=n.length;if(o===a){return a}const l=o-a>eB&&typeof s==="function";const h=l?Date.now()+eN:0;let c=0;const d=this.commonObjs;const u=this.objs;let f;while(true){if(i!==undefined&&a===i.nextBreakPoint){i.breakIt(a,s);return a}f=r[a];if(f!==R.dependency){this[f].apply(this,n[a])}else{for(const t of n[a]){const e=t.startsWith("g_")?d:u;if(!e.has(t)){e.get(t,s);return a}}}a++;if(a===o){return a}if(l&&++c>eB){if(Date.now()>h){s();return a}c=0}}}#sa(){while(this.stateStack.length||this.inSMaskMode){this.restore()}this.current.activeSMask=null;this.ctx.restore();if(this.transparentCanvas){this.ctx=this.compositeCtx;this.ctx.save();this.ctx.setTransform(1,0,0,1,0,0);this.ctx.drawImage(this.transparentCanvas,0,0);this.ctx.restore();this.transparentCanvas=null}}endDrawing(){this.#sa();this.cachedCanvases.clear();this.cachedPatterns.clear();for(const t of this._cachedBitmapsMap.values()){for(const e of t.values()){if(typeof HTMLCanvasElement!=="undefined"&&e instanceof HTMLCanvasElement){e.width=e.height=0}}t.clear()}this._cachedBitmapsMap.clear();this.#so()}#so(){if(this.pageColors){const t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(t!=="none"){const e=this.ctx.filter;this.ctx.filter=t;this.ctx.drawImage(this.ctx.canvas,0,0);this.ctx.filter=e}}}_scaleImage(t,e){const s=t.width??t.displayWidth;const i=t.height??t.displayHeight;let n=Math.max(Math.hypot(e[0],e[1]),1);let r=Math.max(Math.hypot(e[2],e[3]),1);let a=s,o=i;let l="prescale1";let h,c;while(n>2&&a>1||r>2&&o>1){let e=a,s=o;if(n>2&&a>1){e=a>=16384?Math.floor(a/2)-1||1:Math.ceil(a/2);n/=a/e}if(r>2&&o>1){s=o>=16384?Math.floor(o/2)-1||1:Math.ceil(o)/2;r/=o/s}h=this.cachedCanvases.getCanvas(l,e,s);c=h.context;c.clearRect(0,0,e,s);c.drawImage(t,0,0,a,o,0,0,e,s);t=h.canvas;a=e;o=s;l=l==="prescale1"?"prescale2":"prescale1"}return{img:t,paintWidth:a,paintHeight:o}}_createMaskCanvas(t){const e=this.ctx;const{width:s,height:i}=t;const n=this.current.fillColor;const r=this.current.patternFill;const a=tH(e);let o,l,h,c;if((t.bitmap||t.data)&&t.count>1){const e=t.bitmap||t.data.buffer;l=JSON.stringify(r?a:[a.slice(0,4),n]);o=this._cachedBitmapsMap.get(e);if(!o){o=new Map;this._cachedBitmapsMap.set(e,o)}const s=o.get(l);if(s&&!r){const t=Math.round(Math.min(a[0],a[2])+a[4]);const e=Math.round(Math.min(a[1],a[3])+a[5]);return{canvas:s,offsetX:t,offsetY:e}}h=s}if(!h){c=this.cachedCanvases.getCanvas("maskCanvas",s,i);eq(c.context,t)}let d=ta.transform(a,[1/s,0,0,-1/i,0,0]);d=ta.transform(d,[1,0,0,1,0,-i]);const[u,f,p,g]=ta.getAxialAlignedBoundingBox([0,0,s,i],d);const m=Math.round(p-u)||1;const b=Math.round(g-f)||1;const A=this.cachedCanvases.getCanvas("fillCanvas",m,b);const v=A.context;const y=u;const w=f;v.translate(-y,-w);v.transform(...d);if(!h){h=this._scaleImage(c.canvas,tz(v));h=h.img;if(o&&r){o.set(l,h)}}v.imageSmoothingEnabled=eY(tH(v),t.interpolate);eG(v,h,0,0,h.width,h.height,0,0,s,i);v.globalCompositeOperation="source-in";const _=ta.transform(tz(v),[1,0,0,1,-y,-w]);v.fillStyle=r?n.getPattern(e,this,_,ey.FILL):n;v.fillRect(0,0,s,i);if(o&&!r){this.cachedCanvases.delete("fillCanvas");o.set(l,A.canvas)}return{canvas:A.canvas,offsetX:Math.round(y),offsetY:Math.round(w)}}setLineWidth(t){if(t!==this.current.lineWidth){this._cachedScaleForStroking[0]=-1}this.current.lineWidth=t;this.ctx.lineWidth=t}setLineCap(t){this.ctx.lineCap=eQ[t]}setLineJoin(t){this.ctx.lineJoin=eJ[t]}setMiterLimit(t){this.ctx.miterLimit=t}setDash(t,e){const s=this.ctx;if(s.setLineDash!==undefined){s.setLineDash(t);s.lineDashOffset=e}}setRenderingIntent(t){}setFlatness(t){}setGState(t){for(const[e,s]of t){switch(e){case"LW":this.setLineWidth(s);break;case"LC":this.setLineCap(s);break;case"LJ":this.setLineJoin(s);break;case"ML":this.setMiterLimit(s);break;case"D":this.setDash(s[0],s[1]);break;case"RI":this.setRenderingIntent(s);break;case"FL":this.setFlatness(s);break;case"Font":this.setFont(s[0],s[1]);break;case"CA":this.current.strokeAlpha=s;break;case"ca":this.current.fillAlpha=s;this.ctx.globalAlpha=s;break;case"BM":this.ctx.globalCompositeOperation=s;break;case"SMask":this.current.activeSMask=s?this.tempSMask:null;this.tempSMask=null;this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(s);break}}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const t=this.inSMaskMode;if(this.current.activeSMask&&!t){this.beginSMaskMode()}else if(!this.current.activeSMask&&t){this.endSMaskMode()}}beginSMaskMode(){if(this.inSMaskMode){throw new Error("beginSMaskMode called while already in smask mode")}const t=this.ctx.canvas.width;const e=this.ctx.canvas.height;const s="smaskGroupAt"+this.groupLevel;const i=this.cachedCanvases.getCanvas(s,t,e);this.suspendedCtx=this.ctx;this.ctx=i.context;const n=this.ctx;n.setTransform(...tH(this.suspendedCtx));eK(this.suspendedCtx,n);eU(n,this.suspendedCtx);this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode){throw new Error("endSMaskMode called while not in smask mode")}this.ctx._removeMirroring();eK(this.ctx,this.suspendedCtx);this.ctx=this.suspendedCtx;this.suspendedCtx=null}compose(t){if(!this.current.activeSMask){return}if(!t){t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height]}else{t[0]=Math.floor(t[0]);t[1]=Math.floor(t[1]);t[2]=Math.ceil(t[2]);t[3]=Math.ceil(t[3])}const e=this.current.activeSMask;const s=this.suspendedCtx;this.composeSMask(s,e,this.ctx,t);this.ctx.save();this.ctx.setTransform(1,0,0,1,0,0);this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height);this.ctx.restore()}composeSMask(t,e,s,i){const n=i[0];const r=i[1];const a=i[2]-n;const o=i[3]-r;if(a===0||o===0){return}this.genericComposeSMask(e.context,s,a,o,e.subtype,e.backdrop,e.transferMap,n,r,e.offsetX,e.offsetY);t.save();t.globalAlpha=1;t.globalCompositeOperation="source-over";t.setTransform(1,0,0,1,0,0);t.drawImage(s.canvas,0,0);t.restore()}genericComposeSMask(t,e,s,i,n,r,a,o,l,h,c){let d=t.canvas;let u=o-h;let f=l-c;if(r){const e=ta.makeHexColor(...r);if(u<0||f<0||u+s>d.width||f+i>d.height){const t=this.cachedCanvases.getCanvas("maskExtension",s,i);const n=t.context;n.drawImage(d,-u,-f);n.globalCompositeOperation="destination-atop";n.fillStyle=e;n.fillRect(0,0,s,i);n.globalCompositeOperation="source-over";d=t.canvas;u=f=0}else{t.save();t.globalAlpha=1;t.setTransform(1,0,0,1,0,0);const n=new Path2D;n.rect(u,f,s,i);t.clip(n);t.globalCompositeOperation="destination-atop";t.fillStyle=e;t.fillRect(u,f,s,i);t.restore()}}e.save();e.globalAlpha=1;e.setTransform(1,0,0,1,0,0);if(n==="Alpha"&&a){e.filter=this.filterFactory.addAlphaFilter(a)}else if(n==="Luminosity"){e.filter=this.filterFactory.addLuminosityFilter(a)}const p=new Path2D;p.rect(o,l,s,i);e.clip(p);e.globalCompositeOperation="destination-in";e.drawImage(d,u,f,s,i,o,l,s,i);e.restore()}save(){if(this.inSMaskMode){eK(this.ctx,this.suspendedCtx);this.suspendedCtx.save()}else{this.ctx.save()}const t=this.current;this.stateStack.push(t);this.current=t.clone()}restore(){if(this.stateStack.length===0&&this.inSMaskMode){this.endSMaskMode()}if(this.stateStack.length!==0){this.current=this.stateStack.pop();if(this.inSMaskMode){this.suspendedCtx.restore();eK(this.suspendedCtx,this.ctx)}else{this.ctx.restore()}this.checkSMaskState();this.pendingClip=null;this._cachedScaleForStroking[0]=-1;this._cachedGetSinglePixelWidth=null}}transform(t,e,s,i,n,r){this.ctx.transform(t,e,s,i,n,r);this._cachedScaleForStroking[0]=-1;this._cachedGetSinglePixelWidth=null}constructPath(t,e,s){const i=this.ctx;const n=this.current;let r=n.x,a=n.y;let o,l;const h=tH(i);const c=h[0]===0&&h[3]===0||h[1]===0&&h[2]===0;const d=c?s.slice(0):null;for(let s=0,u=0,f=t.length;s<f;s++){switch(t[s]|0){case R.rectangle:r=e[u++];a=e[u++];const f=e[u++];const p=e[u++];const g=r+f;const m=a+p;i.moveTo(r,a);if(f===0||p===0){i.lineTo(g,m)}else{i.lineTo(g,a);i.lineTo(g,m);i.lineTo(r,m)}if(!c){n.updateRectMinMax(h,[r,a,g,m])}i.closePath();break;case R.moveTo:r=e[u++];a=e[u++];i.moveTo(r,a);if(!c){n.updatePathMinMax(h,r,a)}break;case R.lineTo:r=e[u++];a=e[u++];i.lineTo(r,a);if(!c){n.updatePathMinMax(h,r,a)}break;case R.curveTo:o=r;l=a;r=e[u+4];a=e[u+5];i.bezierCurveTo(e[u],e[u+1],e[u+2],e[u+3],r,a);n.updateCurvePathMinMax(h,o,l,e[u],e[u+1],e[u+2],e[u+3],r,a,d);u+=6;break;case R.curveTo2:o=r;l=a;i.bezierCurveTo(r,a,e[u],e[u+1],e[u+2],e[u+3]);n.updateCurvePathMinMax(h,o,l,r,a,e[u],e[u+1],e[u+2],e[u+3],d);r=e[u+2];a=e[u+3];u+=4;break;case R.curveTo3:o=r;l=a;r=e[u+2];a=e[u+3];i.bezierCurveTo(e[u],e[u+1],r,a,r,a);n.updateCurvePathMinMax(h,o,l,e[u],e[u+1],r,a,r,a,d);u+=4;break;case R.closePath:i.closePath();break}}if(c){n.updateScalingPathMinMax(h,d)}n.setCurrentPoint(r,a)}closePath(){this.ctx.closePath()}stroke(t=true){const e=this.ctx;const s=this.current.strokeColor;e.globalAlpha=this.current.strokeAlpha;if(this.contentVisible){if(typeof s==="object"&&s?.getPattern){e.save();e.strokeStyle=s.getPattern(e,this,tz(e),ey.STROKE);this.rescaleAndStroke(false);e.restore()}else{this.rescaleAndStroke(true)}}if(t){this.consumePath(this.current.getClippedPathBoundingBox())}e.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath();this.stroke()}fill(t=true){const e=this.ctx;const s=this.current.fillColor;const i=this.current.patternFill;let n=false;if(i){e.save();e.fillStyle=s.getPattern(e,this,tz(e),ey.FILL);n=true}const r=this.current.getClippedPathBoundingBox();if(this.contentVisible&&r!==null){if(this.pendingEOFill){e.fill("evenodd");this.pendingEOFill=false}else{e.fill()}}if(n){e.restore()}if(t){this.consumePath(r)}}eoFill(){this.pendingEOFill=true;this.fill()}fillStroke(){this.fill(false);this.stroke(false);this.consumePath()}eoFillStroke(){this.pendingEOFill=true;this.fillStroke()}closeFillStroke(){this.closePath();this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=true;this.closePath();this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=eZ}eoClip(){this.pendingClip=e0}beginText(){this.current.textMatrix=l;this.current.textMatrixScale=1;this.current.x=this.current.lineX=0;this.current.y=this.current.lineY=0}endText(){const t=this.pendingTextPaths;const e=this.ctx;if(t===undefined){e.beginPath();return}const s=new Path2D;const i=e.getTransform().invertSelf();for(const{transform:e,x:n,y:r,fontSize:a,path:o}of t){s.addPath(o,new DOMMatrix(e).preMultiplySelf(i).translate(n,r).scale(a,-a))}e.clip(s);e.beginPath();delete this.pendingTextPaths}setCharSpacing(t){this.current.charSpacing=t}setWordSpacing(t){this.current.wordSpacing=t}setHScale(t){this.current.textHScale=t/100}setLeading(t){this.current.leading=-t}setFont(t,e){const s=this.commonObjs.get(t);const i=this.current;if(!s){throw new Error(`Can't find font for ${t}`)}i.fontMatrix=s.fontMatrix||h;if(i.fontMatrix[0]===0||i.fontMatrix[3]===0){N("Invalid font matrix for font "+t)}if(e<0){e=-e;i.fontDirection=-1}else{i.fontDirection=1}this.current.font=s;this.current.fontSize=e;if(s.isType3Font){return}const n=s.loadedName||"sans-serif";const r=s.systemFontInfo?.css||`"${n}", ${s.fallbackName}`;let a="normal";if(s.black){a="900"}else if(s.bold){a="bold"}const o=s.italic?"italic":"normal";let l=e;if(e<eF){l=eF}else if(e>eO){l=eO}this.current.fontSizeScale=e/l;this.ctx.font=`${o} ${a} ${l}px ${r}`}setTextRenderingMode(t){this.current.textRenderingMode=t}setTextRise(t){this.current.textRise=t}moveText(t,e){this.current.x=this.current.lineX+=t;this.current.y=this.current.lineY+=e}setLeadingMoveText(t,e){this.setLeading(-e);this.moveText(t,e)}setTextMatrix(t,e,s,i,n,r){this.current.textMatrix=[t,e,s,i,n,r];this.current.textMatrixScale=Math.hypot(t,e);this.current.x=this.current.lineX=0;this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}#sl(t,e,s){const i=new Path2D;i.addPath(t,new DOMMatrix(s).invertSelf().multiplySelf(e));return i}paintChar(t,e,s,i,n){const r=this.ctx;const a=this.current;const o=a.font;const l=a.textRenderingMode;const h=a.fontSize/a.fontSizeScale;const c=l&y.FILL_STROKE_MASK;const d=!!(l&y.ADD_TO_PATH_FLAG);const u=a.patternFill&&!o.missingFile;const f=a.patternStroke&&!o.missingFile;let p;if(o.disableFontFace||d||u||f){p=o.getPathGenerator(this.commonObjs,t)}if(o.disableFontFace||u||f){r.save();r.translate(e,s);r.scale(h,-h);if(c===y.FILL||c===y.FILL_STROKE){if(i){const t=r.getTransform();r.setTransform(...i);r.fill(this.#sl(p,t,i))}else{r.fill(p)}}if(c===y.STROKE||c===y.FILL_STROKE){if(n){const t=r.getTransform();r.setTransform(...n);r.stroke(this.#sl(p,t,n))}else{r.lineWidth/=h;r.stroke(p)}}r.restore()}else{if(c===y.FILL||c===y.FILL_STROKE){r.fillText(t,e,s)}if(c===y.STROKE||c===y.FILL_STROKE){r.strokeText(t,e,s)}}if(d){const t=this.pendingTextPaths||=[];t.push({transform:tH(r),x:e,y:s,fontSize:h,path:p})}}get isFontSubpixelAAEnabled(){const{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1);t.fillText("I",0,10);const e=t.getImageData(0,0,10,10).data;let s=false;for(let t=3;t<e.length;t+=4){if(e[t]>0&&e[t]<255){s=true;break}}return $(this,"isFontSubpixelAAEnabled",s)}showText(t){const e=this.current;const s=e.font;if(s.isType3Font){return this.showType3Text(t)}const i=e.fontSize;if(i===0){return undefined}const n=this.ctx;const r=e.fontSizeScale;const a=e.charSpacing;const o=e.wordSpacing;const l=e.fontDirection;const h=e.textHScale*l;const c=t.length;const d=s.vertical;const u=d?1:-1;const f=s.defaultVMetrics;const p=i*e.fontMatrix[0];const g=e.textRenderingMode===y.FILL&&!s.disableFontFace&&!e.patternFill;n.save();n.transform(...e.textMatrix);n.translate(e.x,e.y+e.textRise);if(l>0){n.scale(h,-1)}else{n.scale(h,1)}let m,b;if(e.patternFill){n.save();const t=e.fillColor.getPattern(n,this,tz(n),ey.FILL);m=tH(n);n.restore();n.fillStyle=t}if(e.patternStroke){n.save();const t=e.strokeColor.getPattern(n,this,tz(n),ey.STROKE);b=tH(n);n.restore();n.strokeStyle=t}let A=e.lineWidth;const v=e.textMatrixScale;if(v===0||A===0){const t=e.textRenderingMode&y.FILL_STROKE_MASK;if(t===y.STROKE||t===y.FILL_STROKE){A=this.getSinglePixelWidth()}}else{A/=v}if(r!==1){n.scale(r,r);A/=r}n.lineWidth=A;if(s.isInvalidPDFjsFont){const s=[];let i=0;for(const e of t){s.push(e.unicode);i+=e.width}n.fillText(s.join(""),0,0);e.x+=i*p*h;n.restore();this.compose();return undefined}let w=0,_;for(_=0;_<c;++_){const e=t[_];if(typeof e==="number"){w+=u*e*i/1e3;continue}let h=false;const c=(e.isSpace?o:0)+a;const A=e.fontChar;const v=e.accent;let y,x;let E=e.width;if(d){const t=e.vmetric||f;const s=-(e.vmetric?t[1]:E*.5)*p;const i=t[2]*p;E=t?-t[0]:E;y=s/r;x=(w+i)/r}else{y=w/r;x=0}if(s.remeasure&&E>0){const t=n.measureText(A).width*1e3/i*r;if(E<t&&this.isFontSubpixelAAEnabled){const e=E/t;h=true;n.save();n.scale(e,1);y/=e}else if(E!==t){y+=(E-t)/2e3*i/r}}if(this.contentVisible&&(e.isInFont||s.missingFile)){if(g&&!v){n.fillText(A,y,x)}else{this.paintChar(A,y,x,m,b);if(v){const t=y+i*v.offset.x/r;const e=x-i*v.offset.y/r;this.paintChar(v.fontChar,t,e,m,b)}}}const S=d?E*p-c*l:E*p+c*l;w+=S;if(h){n.restore()}}if(d){e.y-=w}else{e.x+=w*h}n.restore();this.compose();return undefined}showType3Text(t){const e=this.ctx;const s=this.current;const i=s.font;const n=s.fontSize;const r=s.fontDirection;const a=i.vertical?1:-1;const o=s.charSpacing;const l=s.wordSpacing;const c=s.textHScale*r;const d=s.fontMatrix||h;const u=t.length;const f=s.textRenderingMode===y.INVISIBLE;let p,g,m,b;if(f||n===0){return}this._cachedScaleForStroking[0]=-1;this._cachedGetSinglePixelWidth=null;e.save();e.transform(...s.textMatrix);e.translate(s.x,s.y);e.scale(c,r);for(p=0;p<u;++p){g=t[p];if(typeof g==="number"){b=a*g*n/1e3;this.ctx.translate(b,0);s.x+=b*c;continue}const r=(g.isSpace?l:0)+o;const h=i.charProcOperatorList[g.operatorListId];if(!h){N(`Type3 character "${g.operatorListId}" is not available.`);continue}if(this.contentVisible){this.processingType3=g;this.save();e.scale(n,n);e.transform(...d);this.executeOperatorList(h);this.restore()}const u=ta.applyTransform([g.width,0],d);m=u[0]*n+r;e.translate(m,0);s.x+=m*c}e.restore();this.processingType3=null}setCharWidth(t,e){}setCharWidthAndBounds(t,e,s,i,n,r){this.ctx.rect(s,i,n-s,r-i);this.ctx.clip();this.endPath()}getColorN_Pattern(t){let e;if(t[0]==="TilingPattern"){const s=t[1];const i=this.baseTransform||tH(this.ctx);const n={createCanvasGraphics:t=>new e1(t,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};e=new eI(t,s,this.ctx,n,i)}else{e=this._getPattern(t[1],t[2])}return e}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments);this.current.patternStroke=true}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments);this.current.patternFill=true}setStrokeRGBColor(t,e,s){this.ctx.strokeStyle=this.current.strokeColor=ta.makeHexColor(t,e,s);this.current.patternStroke=false}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent";this.current.patternStroke=false}setFillRGBColor(t,e,s){this.ctx.fillStyle=this.current.fillColor=ta.makeHexColor(t,e,s);this.current.patternFill=false}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent";this.current.patternFill=false}_getPattern(t,e=null){let s;if(this.cachedPatterns.has(t)){s=this.cachedPatterns.get(t)}else{s=eM(this.getObject(t));this.cachedPatterns.set(t,s)}if(e){s.matrix=e}return s}shadingFill(t){if(!this.contentVisible){return}const e=this.ctx;this.save();const s=this._getPattern(t);e.fillStyle=s.getPattern(e,this,tz(e),ey.SHADING);const i=tz(e);if(i){const{width:t,height:s}=e.canvas;const[n,r,a,o]=ta.getAxialAlignedBoundingBox([0,0,t,s],i);this.ctx.fillRect(n,r,a-n,o-r)}else{this.ctx.fillRect(-1e10,-1e10,2e10,2e10)}this.compose(this.current.getClippedPathBoundingBox());this.restore()}beginInlineImage(){B("Should not call beginInlineImage")}beginImageData(){B("Should not call beginImageData")}paintFormXObjectBegin(t,e){if(!this.contentVisible){return}this.save();this.baseTransformStack.push(this.baseTransform);if(t){this.transform(...t)}this.baseTransform=tH(this.ctx);if(e){const t=e[2]-e[0];const s=e[3]-e[1];this.ctx.rect(e[0],e[1],t,s);this.current.updateRectMinMax(tH(this.ctx),e);this.clip();this.endPath()}}paintFormXObjectEnd(){if(!this.contentVisible){return}this.restore();this.baseTransform=this.baseTransformStack.pop()}beginGroup(t){if(!this.contentVisible){return}this.save();if(this.inSMaskMode){this.endSMaskMode();this.current.activeSMask=null}const e=this.ctx;if(!t.isolated){O("TODO: Support non-isolated groups.")}if(t.knockout){N("Knockout groups not supported.")}const s=tH(e);if(t.matrix){e.transform(...t.matrix)}if(!t.bbox){throw new Error("Bounding box is required.")}let i=ta.getAxialAlignedBoundingBox(t.bbox,tH(e));const n=[0,0,e.canvas.width,e.canvas.height];i=ta.intersect(i,n)||[0,0,0,0];const r=Math.floor(i[0]);const a=Math.floor(i[1]);const o=Math.max(Math.ceil(i[2])-r,1);const l=Math.max(Math.ceil(i[3])-a,1);this.current.startNewPathAndClipBox([0,0,o,l]);let h="groupAt"+this.groupLevel;if(t.smask){h+="_smask_"+this.smaskCounter++%2}const c=this.cachedCanvases.getCanvas(h,o,l);const d=c.context;d.translate(-r,-a);d.transform(...s);if(t.smask){this.smaskStack.push({canvas:c.canvas,context:d,offsetX:r,offsetY:a,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null})}else{e.setTransform(1,0,0,1,0,0);e.translate(r,a);e.save()}eK(e,d);this.ctx=d;this.setGState([["BM","source-over"],["ca",1],["CA",1]]);this.groupStack.push(e);this.groupLevel++}endGroup(t){if(!this.contentVisible){return}this.groupLevel--;const e=this.ctx;const s=this.groupStack.pop();this.ctx=s;this.ctx.imageSmoothingEnabled=false;if(t.smask){this.tempSMask=this.smaskStack.pop();this.restore()}else{this.ctx.restore();const t=tH(this.ctx);this.restore();this.ctx.save();this.ctx.setTransform(...t);const s=ta.getAxialAlignedBoundingBox([0,0,e.canvas.width,e.canvas.height],t);this.ctx.drawImage(e.canvas,0,0);this.ctx.restore();this.compose(s)}}beginAnnotation(t,e,s,i,n){this.#sa();eX(this.ctx);this.ctx.save();this.save();if(this.baseTransform){this.ctx.setTransform(...this.baseTransform)}if(e){const i=e[2]-e[0];const r=e[3]-e[1];if(n&&this.annotationCanvasMap){s=s.slice();s[4]-=e[0];s[5]-=e[1];e=e.slice();e[0]=e[1]=0;e[2]=i;e[3]=r;const[n,a]=ta.singularValueDecompose2dScale(tH(this.ctx));const{viewportScale:o}=this;const l=Math.ceil(i*this.outputScaleX*o);const h=Math.ceil(r*this.outputScaleY*o);this.annotationCanvas=this.canvasFactory.create(l,h);const{canvas:c,context:d}=this.annotationCanvas;this.annotationCanvasMap.set(t,c);this.annotationCanvas.savedCtx=this.ctx;this.ctx=d;this.ctx.save();this.ctx.setTransform(n,0,0,-a,0,r*a);eX(this.ctx)}else{eX(this.ctx);this.endPath();this.ctx.rect(e[0],e[1],i,r);this.ctx.clip();this.ctx.beginPath()}}this.current=new eV(this.ctx.canvas.width,this.ctx.canvas.height);this.transform(...s);this.transform(...i)}endAnnotation(){if(this.annotationCanvas){this.ctx.restore();this.#so();this.ctx=this.annotationCanvas.savedCtx;delete this.annotationCanvas.savedCtx;delete this.annotationCanvas}}paintImageMaskXObject(t){if(!this.contentVisible){return}const e=t.count;t=this.getObject(t.data,t);t.count=e;const s=this.ctx;const i=this.processingType3;if(i){if(i.compiled===undefined){i.compiled=ej(t)}if(i.compiled){i.compiled(s);return}}const n=this._createMaskCanvas(t);const r=n.canvas;s.save();s.setTransform(1,0,0,1,0,0);s.drawImage(r,n.offsetX,n.offsetY);s.restore();this.compose()}paintImageMaskXObjectRepeat(t,e,s=0,i=0,n,r){if(!this.contentVisible){return}t=this.getObject(t.data,t);const a=this.ctx;a.save();const o=tH(a);a.transform(e,s,i,n,0,0);const l=this._createMaskCanvas(t);a.setTransform(1,0,0,1,l.offsetX-o[4],l.offsetY-o[5]);for(let t=0,h=r.length;t<h;t+=2){const h=ta.transform(o,[e,s,i,n,r[t],r[t+1]]);const[c,d]=ta.applyTransform([0,0],h);a.drawImage(l.canvas,c,d)}a.restore();this.compose()}paintImageMaskXObjectGroup(t){if(!this.contentVisible){return}const e=this.ctx;const s=this.current.fillColor;const i=this.current.patternFill;for(const n of t){const{data:t,width:r,height:a,transform:o}=n;const l=this.cachedCanvases.getCanvas("maskCanvas",r,a);const h=l.context;h.save();const c=this.getObject(t,n);eq(h,c);h.globalCompositeOperation="source-in";h.fillStyle=i?s.getPattern(h,this,tz(e),ey.FILL):s;h.fillRect(0,0,r,a);h.restore();e.save();e.transform(...o);e.scale(1,-1);eG(e,l.canvas,0,0,r,a,0,-1,1,1);e.restore()}this.compose()}paintImageXObject(t){if(!this.contentVisible){return}const e=this.getObject(t);if(!e){N("Dependent image isn't ready yet");return}this.paintInlineImageXObject(e)}paintImageXObjectRepeat(t,e,s,i){if(!this.contentVisible){return}const n=this.getObject(t);if(!n){N("Dependent image isn't ready yet");return}const r=n.width;const a=n.height;const o=[];for(let t=0,n=i.length;t<n;t+=2){o.push({transform:[e,0,0,s,i[t],i[t+1]],x:0,y:0,w:r,h:a})}this.paintInlineImageXObjectGroup(n,o)}applyTransferMapsToCanvas(t){if(this.current.transferMaps!=="none"){t.filter=this.current.transferMaps;t.drawImage(t.canvas,0,0);t.filter="none"}return t.canvas}applyTransferMapsToBitmap(t){if(this.current.transferMaps==="none"){return t.bitmap}const{bitmap:e,width:s,height:i}=t;const n=this.cachedCanvases.getCanvas("inlineImage",s,i);const r=n.context;r.filter=this.current.transferMaps;r.drawImage(e,0,0);r.filter="none";return n.canvas}paintInlineImageXObject(t){if(!this.contentVisible){return}const e=t.width;const s=t.height;const i=this.ctx;this.save();if(!o){const{filter:t}=i;if(t!=="none"&&t!==""){i.filter="none"}}i.scale(1/e,-1/s);let n;if(t.bitmap){n=this.applyTransferMapsToBitmap(t)}else if(typeof HTMLElement==="function"&&t instanceof HTMLElement||!t.data){n=t}else{const i=this.cachedCanvases.getCanvas("inlineImage",e,s);const r=i.context;eW(r,t);n=this.applyTransferMapsToCanvas(r)}const r=this._scaleImage(n,tz(i));i.imageSmoothingEnabled=eY(tH(i),t.interpolate);eG(i,r.img,0,0,r.paintWidth,r.paintHeight,0,-s,e,s);this.compose();this.restore()}paintInlineImageXObjectGroup(t,e){if(!this.contentVisible){return}const s=this.ctx;let i;if(t.bitmap){i=t.bitmap}else{const e=t.width;const s=t.height;const n=this.cachedCanvases.getCanvas("inlineImage",e,s);const r=n.context;eW(r,t);i=this.applyTransferMapsToCanvas(r)}for(const t of e){s.save();s.transform(...t.transform);s.scale(1,-1);eG(s,i,t.x,t.y,t.w,t.h,0,-1,1,1);s.restore()}this.compose()}paintSolidColorImageMask(){if(!this.contentVisible){return}this.ctx.fillRect(0,0,1,1);this.compose()}markPoint(t){}markPointProps(t,e){}beginMarkedContent(t){this.markedContentStack.push({visible:true})}beginMarkedContentProps(t,e){if(t==="OC"){this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(e)})}else{this.markedContentStack.push({visible:true})}this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop();this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(t){const e=this.current.isEmptyClip();if(this.pendingClip){this.current.updateClipFromPath()}if(!this.pendingClip){this.compose(t)}const s=this.ctx;if(this.pendingClip){if(!e){if(this.pendingClip===e0){s.clip("evenodd")}else{s.clip()}}this.pendingClip=null}this.current.startNewPathAndClipBox(this.current.clipBox);s.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const t=tH(this.ctx);if(t[1]===0&&t[2]===0){this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]))}else{const e=Math.abs(t[0]*t[3]-t[2]*t[1]);const s=Math.hypot(t[0],t[2]);const i=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(s,i)/e}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:t}=this.current;const{a:e,b:s,c:i,d:n}=this.ctx.getTransform();let r,a;if(s===0&&i===0){const s=Math.abs(e);const i=Math.abs(n);if(s===i){if(t===0){r=a=1/s}else{const e=s*t;r=a=e<1?1/e:1}}else if(t===0){r=1/s;a=1/i}else{const e=s*t;const n=i*t;r=e<1?1/e:1;a=n<1?1/n:1}}else{const o=Math.abs(e*n-s*i);const l=Math.hypot(e,s);const h=Math.hypot(i,n);if(t===0){r=h/o;a=l/o}else{const e=t*o;r=h>e?h/e:1;a=l>e?l/e:1}}this._cachedScaleForStroking[0]=r;this._cachedScaleForStroking[1]=a}return this._cachedScaleForStroking}rescaleAndStroke(t){const{ctx:e}=this;const{lineWidth:s}=this.current;const[i,n]=this.getScaleForStroking();e.lineWidth=s||1;if(i===1&&n===1){e.stroke();return}const r=e.getLineDash();if(t){e.save()}e.scale(i,n);if(r.length>0){const t=Math.max(i,n);e.setLineDash(r.map(e=>e/t));e.lineDashOffset/=t}e.stroke();if(t){e.restore()}}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--){if(!this.markedContentStack[t].visible){return false}}return true}}for(const t in R){if(e1.prototype[t]!==undefined){e1.prototype[R[t]]=e1.prototype[t]}};class e2{static #sh=null;static #sc="";static get workerPort(){return this.#sh}static set workerPort(t){if(!(typeof Worker!=="undefined"&&t instanceof Worker)&&t!==null){throw new Error("Invalid `workerPort` type.")}this.#sh=t}static get workerSrc(){return this.#sc}static set workerSrc(t){if(typeof t!=="string"){throw new Error("Invalid `workerSrc` type.")}this.#sc=t}};class e3{#sd;#su;constructor({parsedData:t,rawData:e}){this.#sd=t;this.#su=e}getRaw(){return this.#su}get(t){return this.#sd.get(t)??null}getAll(){return te(this.#sd)}has(t){return this.#sd.has(t)}};const e5=Symbol("INTERNAL");class e6{#sf=false;#sp=false;#sg=false;#sm=true;constructor(t,{name:e,intent:s,usage:i,rbGroups:n}){this.#sf=!!(t&p.DISPLAY);this.#sp=!!(t&p.PRINT);this.name=e;this.intent=s;this.usage=i;this.rbGroups=n}get visible(){if(this.#sg){return this.#sm}if(!this.#sm){return false}const{print:t,view:e}=this.usage;if(this.#sf){return e?.viewState!=="OFF"}else if(this.#sp){return t?.printState!=="OFF"}return true}_setVisible(t,e,s=false){if(t!==e5){B("Internal method `_setVisible` called.")}this.#sg=s;this.#sm=e}}class e4{#sb=null;#sA=new Map;#sv=null;#sy=null;constructor(t,e=p.DISPLAY){this.renderingIntent=e;this.name=null;this.creator=null;if(t===null){return}this.name=t.name;this.creator=t.creator;this.#sy=t.order;for(const s of t.groups){this.#sA.set(s.id,new e6(e,s))}if(t.baseState==="OFF"){for(const t of this.#sA.values()){t._setVisible(e5,false)}}for(const e of t.on){this.#sA.get(e)._setVisible(e5,true)}for(const e of t.off){this.#sA.get(e)._setVisible(e5,false)}this.#sv=this.getHash()}#sw(t){const e=t.length;if(e<2){return true}const s=t[0];for(let i=1;i<e;i++){const e=t[i];let n;if(Array.isArray(e)){n=this.#sw(e)}else if(this.#sA.has(e)){n=this.#sA.get(e).visible}else{N(`Optional content group not found: ${e}`);return true}switch(s){case"And":if(!n){return false}break;case"Or":if(n){return true}break;case"Not":return!n;default:return true}}return s==="And"}isVisible(t){if(this.#sA.size===0){return true}if(!t){O("Optional content group not defined.");return true}if(t.type==="OCG"){if(!this.#sA.has(t.id)){N(`Optional content group not found: ${t.id}`);return true}return this.#sA.get(t.id).visible}else if(t.type==="OCMD"){if(t.expression){return this.#sw(t.expression)}if(!t.policy||t.policy==="AnyOn"){for(const e of t.ids){if(!this.#sA.has(e)){N(`Optional content group not found: ${e}`);return true}if(this.#sA.get(e).visible){return true}}return false}else if(t.policy==="AllOn"){for(const e of t.ids){if(!this.#sA.has(e)){N(`Optional content group not found: ${e}`);return true}if(!this.#sA.get(e).visible){return false}}return true}else if(t.policy==="AnyOff"){for(const e of t.ids){if(!this.#sA.has(e)){N(`Optional content group not found: ${e}`);return true}if(!this.#sA.get(e).visible){return true}}return false}else if(t.policy==="AllOff"){for(const e of t.ids){if(!this.#sA.has(e)){N(`Optional content group not found: ${e}`);return true}if(this.#sA.get(e).visible){return false}}return true}N(`Unknown optional content policy ${t.policy}.`);return true}N(`Unknown group type ${t.type}.`);return true}setVisibility(t,e=true,s=true){const i=this.#sA.get(t);if(!i){N(`Optional content group not found: ${t}`);return}if(s&&e&&i.rbGroups.length){for(const e of i.rbGroups){for(const s of e){if(s!==t){this.#sA.get(s)?._setVisible(e5,false,true)}}}}i._setVisible(e5,!!e,true);this.#sb=null}setOCGState({state:t,preserveRB:e}){let s;for(const i of t){switch(i){case"ON":case"OFF":case"Toggle":s=i;continue}const t=this.#sA.get(i);if(!t){continue}switch(s){case"ON":this.setVisibility(i,true,e);break;case"OFF":this.setVisibility(i,false,e);break;case"Toggle":this.setVisibility(i,!t.visible,e);break}}this.#sb=null}get hasInitialVisibility(){return this.#sv===null||this.getHash()===this.#sv}getOrder(){if(!this.#sA.size){return null}if(this.#sy){return this.#sy.slice()}return[...this.#sA.keys()]}getGroups(){return this.#sA.size>0?te(this.#sA):null}getGroup(t){return this.#sA.get(t)||null}getHash(){if(this.#sb!==null){return this.#sb}const t=new t4;for(const[e,s]of this.#sA){t.update(`${e}:${s.visible}`)}return this.#sb=t.hexdigest()}};class e8{constructor(t,{disableRange:e=false,disableStream:s=false}){H(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:i,initialData:n,progressiveDone:r,contentDispositionFilename:a}=t;this._queuedChunks=[];this._progressiveDone=r;this._contentDispositionFilename=a;if(n?.length>0){const t=n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer;this._queuedChunks.push(t)}this._pdfDataRangeTransport=t;this._isStreamingSupported=!s;this._isRangeSupported=!e;this._contentLength=i;this._fullRequestReader=null;this._rangeReaders=[];t.addRangeListener((t,e)=>{this._onReceiveData({begin:t,chunk:e})});t.addProgressListener((t,e)=>{this._onProgress({loaded:t,total:e})});t.addProgressiveReadListener(t=>{this._onReceiveData({chunk:t})});t.addProgressiveDoneListener(()=>{this._onProgressiveDone()});t.transportReady()}_onReceiveData({begin:t,chunk:e}){const s=e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer;if(t===undefined){if(this._fullRequestReader){this._fullRequestReader._enqueue(s)}else{this._queuedChunks.push(s)}}else{const e=this._rangeReaders.some(function(e){if(e._begin!==t){return false}e._enqueue(s);return true});H(e,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(t){if(t.total===undefined){this._rangeReaders[0]?.onProgress?.({loaded:t.loaded})}else{this._fullRequestReader?.onProgress?.({loaded:t.loaded,total:t.total})}}_onProgressiveDone(){this._fullRequestReader?.progressiveDone();this._progressiveDone=true}_removeRangeReader(t){const e=this._rangeReaders.indexOf(t);if(e>=0){this._rangeReaders.splice(e,1)}}getFullReader(){H(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const t=this._queuedChunks;this._queuedChunks=null;return new e7(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){if(e<=this._progressiveDataLength){return null}const s=new e9(this,t,e);this._pdfDataRangeTransport.requestDataRange(t,e);this._rangeReaders.push(s);return s}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeReaders.slice(0)){e.cancel(t)}this._pdfDataRangeTransport.abort()}}class e7{constructor(t,e,s=false,i=null){this._stream=t;this._done=s||false;this._filename=tT(i)?i:null;this._queuedChunks=e||[];this._loaded=0;for(const t of this._queuedChunks){this._loaded+=t.byteLength}this._requests=[];this._headersReady=Promise.resolve();t._fullRequestReader=this;this.onProgress=null}_enqueue(t){if(this._done){return}if(this._requests.length>0){const e=this._requests.shift();e.resolve({value:t,done:false})}else{this._queuedChunks.push(t)}this._loaded+=t.byteLength}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0){const t=this._queuedChunks.shift();return{value:t,done:false}}if(this._done){return{value:undefined,done:true}}const t=Promise.withResolvers();this._requests.push(t);return t.promise}cancel(t){this._done=true;for(const t of this._requests){t.resolve({value:undefined,done:true})}this._requests.length=0}progressiveDone(){if(this._done){return}this._done=true}}class e9{constructor(t,e,s){this._stream=t;this._begin=e;this._end=s;this._queuedChunk=null;this._requests=[];this._done=false;this.onProgress=null}_enqueue(t){if(this._done){return}if(this._requests.length===0){this._queuedChunk=t}else{const e=this._requests.shift();e.resolve({value:t,done:false});for(const t of this._requests){t.resolve({value:undefined,done:true})}this._requests.length=0}this._done=true;this._stream._removeRangeReader(this)}get isStreamingSupported(){return false}async read(){if(this._queuedChunk){const t=this._queuedChunk;this._queuedChunk=null;return{value:t,done:false}}if(this._done){return{value:undefined,done:true}}const t=Promise.withResolvers();this._requests.push(t);return t.promise}cancel(t){this._done=true;for(const t of this._requests){t.resolve({value:undefined,done:true})}this._requests.length=0;this._stream._removeRangeReader(this)}};function st(t){let e=true;let s=i("filename\\*","i").exec(t);if(s){s=s[1];let t=o(s);t=unescape(t);t=l(t);t=h(t);return r(t)}s=a(t);if(s){const t=h(s);return r(t)}s=i("filename","i").exec(t);if(s){s=s[1];let t=o(s);t=h(t);return r(t)}function i(t,e){return new RegExp("(?:^|;)\\s*"+t+"\\s*=\\s*"+"("+'[^";\\s][^;\\s]*'+"|"+'"(?:[^"\\\\]|\\\\"?)+"?'+")",e)}function n(t,s){if(t){if(!/^[\x00-\xFF]+$/.test(s)){return s}try{const i=new TextDecoder(t,{fatal:true});const n=J(s);s=i.decode(n);e=false}catch{}}return s}function r(t){if(e&&/[\x80-\xff]/.test(t)){t=n("utf-8",t);if(e){t=n("iso-8859-1",t)}}return t}function a(t){const e=[];let s;const n=i("filename\\*((?!0\\d)\\d+)(\\*?)","ig");while((s=n.exec(t))!==null){let[,t,i,n]=s;t=parseInt(t,10);if(t in e){if(t===0){break}continue}e[t]=[i,n]}const r=[];for(let t=0;t<e.length;++t){if(!(t in e)){break}let[s,i]=e[t];i=o(i);if(s){i=unescape(i);if(t===0){i=l(i)}}r.push(i)}return r.join("")}function o(t){if(t.startsWith('"')){const e=t.slice(1).split('\\"');for(let t=0;t<e.length;++t){const s=e[t].indexOf('"');if(s!==-1){e[t]=e[t].slice(0,s);e.length=t+1}e[t]=e[t].replaceAll(/\\(.)/g,"$1")}t=e.join('"')}return t}function l(t){const e=t.indexOf("'");if(e===-1){return t}const s=t.slice(0,e);const i=t.slice(e+1);const r=i.replace(/^[^']*'/,"");return n(s,r)}function h(t){if(!t.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(t)){return t}return t.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(t,e,s,i){if(s==="q"||s==="Q"){i=i.replaceAll("_"," ");i=i.replaceAll(/=([0-9a-fA-F]{2})/g,function(t,e){return String.fromCharCode(parseInt(e,16))});return n(e,i)}try{i=atob(i)}catch{}return n(e,i)})}return""};function se(t,e){const s=new Headers;if(!t||!e||typeof e!=="object"){return s}for(const t in e){const i=e[t];if(i!==undefined){s.append(t,i)}}return s}function ss(t){try{return new URL(t).origin}catch{}return null}function si({responseHeaders:t,isHttp:e,rangeChunkSize:s,disableRange:i}){const n={allowRangeRequests:false,suggestedLength:undefined};const r=parseInt(t.get("Content-Length"),10);if(!Number.isInteger(r)){return n}n.suggestedLength=r;if(r<=2*s){return n}if(i||!e){return n}if(t.get("Accept-Ranges")!=="bytes"){return n}const a=t.get("Content-Encoding")||"identity";if(a!=="identity"){return n}n.allowRangeRequests=true;return n}function sn(t){const e=t.get("Content-Disposition");if(e){let t=st(e);if(t.includes("%")){try{t=decodeURIComponent(t)}catch{}}if(tT(t)){return t}}return null}function sr(t,e){if(t===404||t===0&&e.startsWith("file:")){return new q('Missing PDF "'+e+'".')}return new K(`Unexpected server response (${t}) while retrieving PDF "${e}".`,t)}function sa(t){return t===200||t===206};function so(t,e,s){return{method:"GET",headers:t,signal:s.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function sl(t){if(t instanceof Uint8Array){return t.buffer}if(t instanceof ArrayBuffer){return t}N(`getArrayBuffer - unexpected data format: ${t}`);return new Uint8Array(t).buffer}class sh{_responseOrigin=null;constructor(t){this.source=t;this.isHttp=/^https?:/i.test(t.url);this.headers=se(this.isHttp,t.httpHeaders);this._fullRequestReader=null;this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){H(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once.");this._fullRequestReader=new sc(this);return this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength){return null}const s=new sd(this,t,e);this._rangeRequestReaders.push(s);return s}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0)){e.cancel(t)}}}class sc{constructor(t){this._stream=t;this._reader=null;this._loaded=0;this._filename=null;const e=t.source;this._withCredentials=e.withCredentials||false;this._contentLength=e.length;this._headersCapability=Promise.withResolvers();this._disableRange=e.disableRange||false;this._rangeChunkSize=e.rangeChunkSize;if(!this._rangeChunkSize&&!this._disableRange){this._disableRange=true}this._abortController=new AbortController;this._isStreamingSupported=!e.disableStream;this._isRangeSupported=!e.disableRange;const s=new Headers(t.headers);const i=e.url;fetch(i,so(s,this._withCredentials,this._abortController)).then(e=>{t._responseOrigin=ss(e.url);if(!sa(e.status)){throw sr(e.status,i)}this._reader=e.body.getReader();this._headersCapability.resolve();const s=e.headers;const{allowRangeRequests:n,suggestedLength:r}=si({responseHeaders:s,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=n;this._contentLength=r||this._contentLength;this._filename=sn(s);if(!this._isStreamingSupported&&this._isRangeSupported){this.cancel(new Y("Streaming is disabled."))}}).catch(this._headersCapability.reject);this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:t,done:e}=await this._reader.read();if(e){return{value:t,done:e}}this._loaded+=t.byteLength;this.onProgress?.({loaded:this._loaded,total:this._contentLength});return{value:sl(t),done:false}}cancel(t){this._reader?.cancel(t);this._abortController.abort()}}class sd{constructor(t,e,s){this._stream=t;this._reader=null;this._loaded=0;const i=t.source;this._withCredentials=i.withCredentials||false;this._readCapability=Promise.withResolvers();this._isStreamingSupported=!i.disableStream;this._abortController=new AbortController;const n=new Headers(t.headers);n.append("Range",`bytes=${e}-${s-1}`);const r=i.url;fetch(r,so(n,this._withCredentials,this._abortController)).then(e=>{const s=ss(e.url);if(s!==t._responseOrigin){throw new Error(`Expected range response-origin "${s}" to match "${t._responseOrigin}".`)}if(!sa(e.status)){throw sr(e.status,r)}this._readCapability.resolve();this._reader=e.body.getReader()}).catch(this._readCapability.reject);this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:t,done:e}=await this._reader.read();if(e){return{value:t,done:e}}this._loaded+=t.byteLength;this.onProgress?.({loaded:this._loaded});return{value:sl(t),done:false}}cancel(t){this._reader?.cancel(t);this._abortController.abort()}};const su=200;const sf=206;function sp(t){const e=t.response;if(typeof e!=="string"){return e}return J(e).buffer}class sg{_responseOrigin=null;constructor({url:t,httpHeaders:e,withCredentials:s}){this.url=t;this.isHttp=/^https?:/i.test(t);this.headers=se(this.isHttp,e);this.withCredentials=s||false;this.currXhrId=0;this.pendingRequests=Object.create(null)}request(t){const e=new XMLHttpRequest;const s=this.currXhrId++;const i=this.pendingRequests[s]={xhr:e};e.open("GET",this.url);e.withCredentials=this.withCredentials;for(const[t,s]of this.headers){e.setRequestHeader(t,s)}if(this.isHttp&&"begin"in t&&"end"in t){e.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`);i.expectedStatus=sf}else{i.expectedStatus=su}e.responseType="arraybuffer";H(t.onError,"Expected `onError` callback to be provided.");e.onerror=()=>{t.onError(e.status)};e.onreadystatechange=this.onStateChange.bind(this,s);e.onprogress=this.onProgress.bind(this,s);i.onHeadersReceived=t.onHeadersReceived;i.onDone=t.onDone;i.onError=t.onError;i.onProgress=t.onProgress;e.send(null);return s}onProgress(t,e){const s=this.pendingRequests[t];if(!s){return}s.onProgress?.(e)}onStateChange(t,e){const s=this.pendingRequests[t];if(!s){return}const i=s.xhr;if(i.readyState>=2&&s.onHeadersReceived){s.onHeadersReceived();delete s.onHeadersReceived}if(i.readyState!==4){return}if(!(t in this.pendingRequests)){return}delete this.pendingRequests[t];if(i.status===0&&this.isHttp){s.onError(i.status);return}const n=i.status||su;const r=n===su&&s.expectedStatus===sf;if(!r&&n!==s.expectedStatus){s.onError(i.status);return}const a=sp(i);if(n===sf){const t=i.getResponseHeader("Content-Range");const e=/bytes (\d+)-(\d+)\/(\d+)/.exec(t);if(e){s.onDone({begin:parseInt(e[1],10),chunk:a})}else{N(`Missing or invalid "Content-Range" header.`);s.onError(0)}}else if(a){s.onDone({begin:0,chunk:a})}else{s.onError(i.status)}}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){const e=this.pendingRequests[t].xhr;delete this.pendingRequests[t];e.abort()}}class sm{constructor(t){this._source=t;this._manager=new sg(t);this._rangeChunkSize=t.rangeChunkSize;this._fullRequestReader=null;this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){const e=this._rangeRequestReaders.indexOf(t);if(e>=0){this._rangeRequestReaders.splice(e,1)}}getFullReader(){H(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once.");this._fullRequestReader=new sb(this._manager,this._source);return this._fullRequestReader}getRangeReader(t,e){const s=new sA(this._manager,t,e);s.onClosed=this._onRangeRequestReaderClosed.bind(this);this._rangeRequestReaders.push(s);return s}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0)){e.cancel(t)}}}class sb{constructor(t,e){this._manager=t;this._url=e.url;this._fullRequestId=t.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)});this._headersCapability=Promise.withResolvers();this._disableRange=e.disableRange||false;this._contentLength=e.length;this._rangeChunkSize=e.rangeChunkSize;if(!this._rangeChunkSize&&!this._disableRange){this._disableRange=true}this._isStreamingSupported=false;this._isRangeSupported=false;this._cachedChunks=[];this._requests=[];this._done=false;this._storedError=undefined;this._filename=null;this.onProgress=null}_onHeadersReceived(){const t=this._fullRequestId;const e=this._manager.getRequestXhr(t);this._manager._responseOrigin=ss(e.responseURL);const s=e.getAllResponseHeaders();const i=new Headers(s?s.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(t=>{const[e,...s]=t.split(": ");return[e,s.join(": ")]}):[]);const{allowRangeRequests:n,suggestedLength:r}=si({responseHeaders:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});if(n){this._isRangeSupported=true}this._contentLength=r||this._contentLength;this._filename=sn(i);if(this._isRangeSupported){this._manager.abortRequest(t)}this._headersCapability.resolve()}_onDone(t){if(t){if(this._requests.length>0){const e=this._requests.shift();e.resolve({value:t.chunk,done:false})}else{this._cachedChunks.push(t.chunk)}}this._done=true;if(this._cachedChunks.length>0){return}for(const t of this._requests){t.resolve({value:undefined,done:true})}this._requests.length=0}_onError(t){this._storedError=sr(t,this._url);this._headersCapability.reject(this._storedError);for(const t of this._requests){t.reject(this._storedError)}this._requests.length=0;this._cachedChunks.length=0}_onProgress(t){this.onProgress?.({loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){await this._headersCapability.promise;if(this._storedError){throw this._storedError}if(this._cachedChunks.length>0){const t=this._cachedChunks.shift();return{value:t,done:false}}if(this._done){return{value:undefined,done:true}}const t=Promise.withResolvers();this._requests.push(t);return t.promise}cancel(t){this._done=true;this._headersCapability.reject(t);for(const t of this._requests){t.resolve({value:undefined,done:true})}this._requests.length=0;if(this._manager.isPendingRequest(this._fullRequestId)){this._manager.abortRequest(this._fullRequestId)}this._fullRequestReader=null}}class sA{constructor(t,e,s){this._manager=t;this._url=t.url;this._requestId=t.request({begin:e,end:s,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)});this._requests=[];this._queuedChunk=null;this._done=false;this._storedError=undefined;this.onProgress=null;this.onClosed=null}_onHeadersReceived(){const t=ss(this._manager.getRequestXhr(this._requestId)?.responseURL);if(t!==this._manager._responseOrigin){this._storedError=new Error(`Expected range response-origin "${t}" to match "${this._manager._responseOrigin}".`);this._onError(0)}}_close(){this.onClosed?.(this)}_onDone(t){const e=t.chunk;if(this._requests.length>0){const t=this._requests.shift();t.resolve({value:e,done:false})}else{this._queuedChunk=e}this._done=true;for(const t of this._requests){t.resolve({value:undefined,done:true})}this._requests.length=0;this._close()}_onError(t){this._storedError??=sr(t,this._url);for(const t of this._requests){t.reject(this._storedError)}this._requests.length=0;this._queuedChunk=null}_onProgress(t){if(!this.isStreamingSupported){this.onProgress?.({loaded:t.loaded})}}get isStreamingSupported(){return false}async read(){if(this._storedError){throw this._storedError}if(this._queuedChunk!==null){const t=this._queuedChunk;this._queuedChunk=null;return{value:t,done:false}}if(this._done){return{value:undefined,done:true}}const t=Promise.withResolvers();this._requests.push(t);return t.promise}cancel(t){this._done=true;for(const t of this._requests){t.resolve({value:undefined,done:true})}this._requests.length=0;if(this._manager.isPendingRequest(this._requestId)){this._manager.abortRequest(this._requestId)}this._close()}};const sv=/^[a-z][a-z0-9\-+.]+:/i;function sy(t){if(sv.test(t)){return new URL(t)}const e=i.getBuiltinModule("url");return new URL(e.pathToFileURL(t))}class sw{constructor(t){this.source=t;this.url=sy(t.url);H(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs.");this._fullRequestReader=null;this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){H(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once.");this._fullRequestReader=new s_(this);return this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength){return null}const s=new sx(this,t,e);this._rangeRequestReaders.push(s);return s}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0)){e.cancel(t)}}}class s_{constructor(t){this._url=t.url;this._done=false;this._storedError=null;this.onProgress=null;const e=t.source;this._contentLength=e.length;this._loaded=0;this._filename=null;this._disableRange=e.disableRange||false;this._rangeChunkSize=e.rangeChunkSize;if(!this._rangeChunkSize&&!this._disableRange){this._disableRange=true}this._isStreamingSupported=!e.disableStream;this._isRangeSupported=!e.disableRange;this._readableStream=null;this._readCapability=Promise.withResolvers();this._headersCapability=Promise.withResolvers();const s=i.getBuiltinModule("fs");s.promises.lstat(this._url).then(t=>{this._contentLength=t.size;this._setReadableStream(s.createReadStream(this._url));this._headersCapability.resolve()},t=>{if(t.code==="ENOENT"){t=new q(`Missing PDF "${this._url}".`)}this._storedError=t;this._headersCapability.reject(t)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;if(this._done){return{value:undefined,done:true}}if(this._storedError){throw this._storedError}const t=this._readableStream.read();if(t===null){this._readCapability=Promise.withResolvers();return this.read()}this._loaded+=t.length;this.onProgress?.({loaded:this._loaded,total:this._contentLength});const e=new Uint8Array(t).buffer;return{value:e,done:false}}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t;this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t;t.on("readable",()=>{this._readCapability.resolve()});t.on("end",()=>{t.destroy();this._done=true;this._readCapability.resolve()});t.on("error",t=>{this._error(t)});if(!this._isStreamingSupported&&this._isRangeSupported){this._error(new Y("streaming is disabled"))}if(this._storedError){this._readableStream.destroy(this._storedError)}}}class sx{constructor(t,e,s){this._url=t.url;this._done=false;this._storedError=null;this.onProgress=null;this._loaded=0;this._readableStream=null;this._readCapability=Promise.withResolvers();const n=t.source;this._isStreamingSupported=!n.disableStream;const r=i.getBuiltinModule("fs");this._setReadableStream(r.createReadStream(this._url,{start:e,end:s-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;if(this._done){return{value:undefined,done:true}}if(this._storedError){throw this._storedError}const t=this._readableStream.read();if(t===null){this._readCapability=Promise.withResolvers();return this.read()}this._loaded+=t.length;this.onProgress?.({loaded:this._loaded});const e=new Uint8Array(t).buffer;return{value:e,done:false}}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t;this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t;t.on("readable",()=>{this._readCapability.resolve()});t.on("end",()=>{t.destroy();this._done=true;this._readCapability.resolve()});t.on("error",t=>{this._error(t)});if(this._storedError){this._readableStream.destroy(this._storedError)}}};const sE=1e5;const sS=30;const sC=.8;class sT{#s_=Promise.withResolvers();#tf=null;#sx=false;#sE=!!globalThis.FontInspector?.enabled;#sS=null;#sC=null;#sT=0;#sM=0;#sP=null;#sI=null;#sR=0;#sk=0;#sD=Object.create(null);#sL=[];#sF=null;#sO=[];#sN=new WeakMap;#sB=null;static #sH=new Map;static #sz=new Map;static #sU=new WeakMap;static #s$=null;static #sG=new Set;constructor({textContentSource:t,container:e,viewport:s}){if(t instanceof ReadableStream){this.#sF=t}else if(typeof t==="object"){this.#sF=new ReadableStream({start(e){e.enqueue(t);e.close()}})}else{throw new Error('No "textContentSource" parameter specified.')}this.#tf=this.#sI=e;this.#sk=s.scale*(globalThis.devicePixelRatio||1);this.#sR=s.rotation;this.#sC={div:null,properties:null,ctx:null};const{pageWidth:i,pageHeight:n,pageX:r,pageY:a}=s.rawDims;this.#sB=[1,0,0,-1,-r,a+n];this.#sM=i;this.#sT=n;sT.#sj();tU(e,s);this.#s_.promise.finally(()=>{sT.#sG.delete(this);this.#sC=null;this.#sD=null}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:t,isFirefox:e}=tn.platform;return $(this,"fontFamilyMap",new Map([["sans-serif",`${t&&e?"Calibri, ":""}sans-serif`],["monospace",`${t&&e?"Lucida Console, ":""}monospace`]]))}render(){const t=()=>{this.#sP.read().then(({value:e,done:s})=>{if(s){this.#s_.resolve();return}this.#sS??=e.lang;Object.assign(this.#sD,e.styles);this.#sV(e.items);t()},this.#s_.reject)};this.#sP=this.#sF.getReader();sT.#sG.add(this);t();return this.#s_.promise}update({viewport:t,onBefore:e=null}){const s=t.scale*(globalThis.devicePixelRatio||1);const i=t.rotation;if(i!==this.#sR){e?.();this.#sR=i;tU(this.#sI,{rotation:i})}if(s!==this.#sk){e?.();this.#sk=s;const t={div:null,properties:null,ctx:sT.#sW(this.#sS)};for(const e of this.#sO){t.properties=this.#sN.get(e);t.div=e;this.#sq(t)}}}cancel(){const t=new Y("TextLayer task cancelled.");this.#sP?.cancel(t).catch(()=>{});this.#sP=null;this.#s_.reject(t)}get textDivs(){return this.#sO}get textContentItemsStr(){return this.#sL}#sV(t){if(this.#sx){return}this.#sC.ctx??=sT.#sW(this.#sS);const e=this.#sO,s=this.#sL;for(const i of t){if(e.length>sE){N("Ignoring additional textDivs for performance reasons.");this.#sx=true;return}if(i.str===undefined){if(i.type==="beginMarkedContentProps"||i.type==="beginMarkedContent"){const t=this.#tf;this.#tf=document.createElement("span");this.#tf.classList.add("markedContent");if(i.id!==null){this.#tf.setAttribute("id",`${i.id}`)}t.append(this.#tf)}else if(i.type==="endMarkedContent"){this.#tf=this.#tf.parentNode}continue}s.push(i.str);this.#sK(i)}}#sK(t){const e=document.createElement("span");const s={angle:0,canvasWidth:0,hasText:t.str!=="",hasEOL:t.hasEOL,fontSize:0};this.#sO.push(e);const i=ta.transform(this.#sB,t.transform);let n=Math.atan2(i[1],i[0]);const r=this.#sD[t.fontName];if(r.vertical){n+=Math.PI/2}let a=this.#sE&&r.fontSubstitution||r.fontFamily;a=sT.fontFamilyMap.get(a)||a;const o=Math.hypot(i[2],i[3]);const l=o*sT.#sX(a,this.#sS);let h,c;if(n===0){h=i[4];c=i[5]-l}else{h=i[4]+l*Math.sin(n);c=i[5]-l*Math.cos(n)}const d="calc(var(--scale-factor)*";const u=e.style;if(this.#tf===this.#sI){u.left=`${(100*h/this.#sM).toFixed(2)}%`;u.top=`${(100*c/this.#sT).toFixed(2)}%`}else{u.left=`${d}${h.toFixed(2)}px)`;u.top=`${d}${c.toFixed(2)}px)`}u.fontSize=`${d}${(sT.#s$*o).toFixed(2)}px)`;u.fontFamily=a;s.fontSize=o;e.setAttribute("role","presentation");e.textContent=t.str;e.dir=t.dir;if(this.#sE){e.dataset.fontName=r.fontSubstitutionLoadedName||t.fontName}if(n!==0){s.angle=n*(180/Math.PI)}let f=false;if(t.str.length>1){f=true}else if(t.str!==" "&&t.transform[0]!==t.transform[3]){const e=Math.abs(t.transform[0]),s=Math.abs(t.transform[3]);if(e!==s&&Math.max(e,s)/Math.min(e,s)>1.5){f=true}}if(f){s.canvasWidth=r.vertical?t.height:t.width}this.#sN.set(e,s);this.#sC.div=e;this.#sC.properties=s;this.#sq(this.#sC);if(s.hasText){this.#tf.append(e)}if(s.hasEOL){const t=document.createElement("br");t.setAttribute("role","presentation");this.#tf.append(t)}}#sq(t){const{div:e,properties:s,ctx:i}=t;const{style:n}=e;let r="";if(sT.#s$>1){r=`scale(${1/sT.#s$})`}if(s.canvasWidth!==0&&s.hasText){const{fontFamily:t}=n;const{canvasWidth:a,fontSize:o}=s;sT.#sY(i,o*this.#sk,t);const{width:l}=i.measureText(e.textContent);if(l>0){r=`scaleX(${a*this.#sk/l}) ${r}`}}if(s.angle!==0){r=`rotate(${s.angle}deg) ${r}`}if(r.length>0){n.transform=r}}static cleanup(){if(this.#sG.size>0){return}this.#sH.clear();for(const{canvas:t}of this.#sz.values()){t.remove()}this.#sz.clear()}static #sW(t=null){let e=this.#sz.get(t||="");if(!e){const s=document.createElement("canvas");s.className="hiddenCanvasElement";s.lang=t;document.body.append(s);e=s.getContext("2d",{alpha:false,willReadFrequently:true});this.#sz.set(t,e);this.#sU.set(e,{size:0,family:""})}return e}static #sY(t,e,s){const i=this.#sU.get(t);if(e===i.size&&s===i.family){return}t.font=`${e}px ${s}`;i.size=e;i.family=s}static #sj(){if(this.#s$!==null){return}const t=document.createElement("div");t.style.opacity=0;t.style.lineHeight=1;t.style.fontSize="1px";t.style.position="absolute";t.textContent="X";document.body.append(t);this.#s$=t.getBoundingClientRect().height;t.remove()}static #sX(t,e){const s=this.#sH.get(t);if(s){return s}const i=this.#sW(e);i.canvas.width=i.canvas.height=sS;this.#sY(i,sS,t);const n=i.measureText("");let r=n.fontBoundingBoxAscent;let a=Math.abs(n.fontBoundingBoxDescent);if(r){const e=r/(r+a);this.#sH.set(t,e);i.canvas.width=i.canvas.height=0;return e}i.strokeStyle="red";i.clearRect(0,0,sS,sS);i.strokeText("g",0,0);let o=i.getImageData(0,0,sS,sS).data;a=0;for(let t=o.length-1-3;t>=0;t-=4){if(o[t]>0){a=Math.ceil(t/4/sS);break}}i.clearRect(0,0,sS,sS);i.strokeText("A",0,sS);o=i.getImageData(0,0,sS,sS).data;r=0;for(let t=0,e=o.length;t<e;t+=4){if(o[t]>0){r=sS-Math.floor(t/4/sS);break}}i.canvas.width=i.canvas.height=0;const l=r?r/(r+a):sC;this.#sH.set(t,l);return l}};class sM{static textContent(t){const e=[];const s={items:e,styles:Object.create(null)};function i(t){if(!t){return}let s=null;const n=t.name;if(n==="#text"){s=t.value}else if(!sM.shouldBuildText(n)){return}else if(t?.attributes?.textContent){s=t.attributes.textContent}else if(t.value){s=t.value}if(s!==null){e.push({str:s})}if(!t.children){return}for(const e of t.children){i(e)}}i(t);return s}static shouldBuildText(t){return!(t==="textarea"||t==="input"||t==="option"||t==="select")}};const sP=65536;const sI=100;const sR=5e3;const sk=o?eb:el;const sD=o?eA:ec;const sL=o?em:eu;const sF=o?ev:ep;function sO(t={}){if(typeof t==="string"||t instanceof URL){t={url:t}}else if(t instanceof ArrayBuffer||ArrayBuffer.isView(t)){t={data:t}}const e=new sz;const{docId:s}=e;const i=t.url?sN(t.url):null;const n=t.data?sB(t.data):null;const r=t.httpHeaders||null;const a=t.withCredentials===true;const l=t.password??null;const h=t.range instanceof sU?t.range:null;const c=Number.isInteger(t.rangeChunkSize)&&t.rangeChunkSize>0?t.rangeChunkSize:sP;let d=t.worker instanceof sV?t.worker:null;const u=t.verbosity;const f=typeof t.docBaseUrl==="string"&&!tC(t.docBaseUrl)?t.docBaseUrl:null;const p=typeof t.cMapUrl==="string"?t.cMapUrl:null;const g=t.cMapPacked!==false;const m=t.CMapReaderFactory||sD;const b=typeof t.standardFontDataUrl==="string"?t.standardFontDataUrl:null;const A=t.StandardFontDataFactory||sF;const v=t.stopAtErrors!==true;const y=Number.isInteger(t.maxImageSize)&&t.maxImageSize>-1?t.maxImageSize:-1;const w=t.isEvalSupported!==false;const _=typeof t.isOffscreenCanvasSupported==="boolean"?t.isOffscreenCanvasSupported:!o;const x=typeof t.isImageDecoderSupported==="boolean"?t.isImageDecoderSupported:!o&&(tn.platform.isFirefox||!globalThis.chrome);const E=Number.isInteger(t.canvasMaxAreaInBytes)?t.canvasMaxAreaInBytes:-1;const S=typeof t.disableFontFace==="boolean"?t.disableFontFace:o;const C=t.fontExtraProperties===true;const T=t.enableXfa===true;const M=t.ownerDocument||globalThis.document;const P=t.disableRange===true;const I=t.disableStream===true;const R=t.disableAutoFetch===true;const k=t.pdfBug===true;const D=t.CanvasFactory||sk;const F=t.FilterFactory||sL;const O=t.enableHWA===true;const N=h?h.length:t.length??NaN;const B=typeof t.useSystemFonts==="boolean"?t.useSystemFonts:!o&&!S;const H=typeof t.useWorkerFetch==="boolean"?t.useWorkerFetch:m===ec&&A===ep&&p&&b&&tR(p,document.baseURI)&&tR(b,document.baseURI);const z=null;L(u);const U={canvasFactory:new D({ownerDocument:M,enableHWA:O}),filterFactory:new F({docId:s,ownerDocument:M}),cMapReaderFactory:H?null:new m({baseUrl:p,isCompressed:g}),standardFontDataFactory:H?null:new A({baseUrl:b})};if(!d){const t={verbosity:u,port:e2.workerPort};d=t.port?sV.fromPort(t):new sV(t);e._worker=d}const $={docId:s,apiVersion:"4.10.38",data:n,password:l,disableAutoFetch:R,rangeChunkSize:c,length:N,docBaseUrl:f,enableXfa:T,evaluatorOptions:{maxImageSize:y,disableFontFace:S,ignoreErrors:v,isEvalSupported:w,isOffscreenCanvasSupported:_,isImageDecoderSupported:x,canvasMaxAreaInBytes:E,fontExtraProperties:C,useSystemFonts:B,cMapUrl:H?p:null,standardFontDataUrl:H?b:null}};const G={disableFontFace:S,fontExtraProperties:C,ownerDocument:M,pdfBug:k,styleElement:z,loadingParams:{disableAutoFetch:R,enableXfa:T}};d.promise.then(function(){if(e.destroyed){throw new Error("Loading aborted")}if(d.destroyed){throw new Error("Worker was destroyed")}const t=d.messageHandler.sendWithPromise("GetDocRequest",$,n?[n.buffer]:null);let l;if(h){l=new e8(h,{disableRange:P,disableStream:I})}else if(!n){if(!i){throw new Error("getDocument - no `url` parameter provided.")}let t;if(o){if(tR(i)){if(typeof fetch==="undefined"||typeof Response==="undefined"||!("body"in Response.prototype)){throw new Error("getDocument - the Fetch API was disabled in Node.js, see `--no-experimental-fetch`.")}t=sh}else{t=sw}}else{t=tR(i)?sh:sm}l=new t({url:i,length:N,httpHeaders:r,withCredentials:a,rangeChunkSize:c,disableRange:P,disableStream:I})}return t.then(t=>{if(e.destroyed){throw new Error("Loading aborted")}if(d.destroyed){throw new Error("Worker was destroyed")}const i=new ea(s,t,d.port);const n=new sW(i,e,l,G,U);e._transport=n;i.send("Ready",null)})}).catch(e._capability.reject);return e}function sN(t){if(t instanceof URL){return t.href}try{return new URL(t,window.location).href}catch{if(o&&typeof t==="string"){return t}}throw new Error("Invalid PDF url data: "+"either string or URL-object is expected in the url property.")}function sB(t){if(o&&typeof n!=="undefined"&&t instanceof n){throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.")}if(t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength){return t}if(typeof t==="string"){return J(t)}if(t instanceof ArrayBuffer||ArrayBuffer.isView(t)||typeof t==="object"&&!isNaN(t?.length)){return new Uint8Array(t)}throw new Error("Invalid PDF binary data: either TypedArray, "+"string, or array-like object is expected in the data property.")}function sH(t){return typeof t==="object"&&Number.isInteger(t?.num)&&t.num>=0&&Number.isInteger(t?.gen)&&t.gen>=0}class sz{static #e2=0;constructor(){this._capability=Promise.withResolvers();this._transport=null;this._worker=null;this.docId=`d${sz.#e2++}`;this.destroyed=false;this.onPassword=null;this.onProgress=null}get promise(){return this._capability.promise}async destroy(){this.destroyed=true;try{if(this._worker?.port){this._worker._pendingDestroy=true}await this._transport?.destroy()}catch(t){if(this._worker?.port){delete this._worker._pendingDestroy}throw t}this._transport=null;this._worker?.destroy();this._worker=null}}class sU{constructor(t,e,s=false,i=null){this.length=t;this.initialData=e;this.progressiveDone=s;this.contentDispositionFilename=i;this._rangeListeners=[];this._progressListeners=[];this._progressiveReadListeners=[];this._progressiveDoneListeners=[];this._readyCapability=Promise.withResolvers()}addRangeListener(t){this._rangeListeners.push(t)}addProgressListener(t){this._progressListeners.push(t)}addProgressiveReadListener(t){this._progressiveReadListeners.push(t)}addProgressiveDoneListener(t){this._progressiveDoneListeners.push(t)}onDataRange(t,e){for(const s of this._rangeListeners){s(t,e)}}onDataProgress(t,e){this._readyCapability.promise.then(()=>{for(const s of this._progressListeners){s(t,e)}})}onDataProgressiveRead(t){this._readyCapability.promise.then(()=>{for(const e of this._progressiveReadListeners){e(t)}})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const t of this._progressiveDoneListeners){t()}})}transportReady(){this._readyCapability.resolve()}requestDataRange(t,e){B("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class s${constructor(t,e){this._pdfInfo=t;this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return $(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(e)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=false){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class sG{#sQ=null;#sJ=false;constructor(t,e,s,i=false){this._pageIndex=t;this._pageInfo=e;this._transport=s;this._stats=i?new tI:null;this._pdfBug=i;this.commonObjs=s.commonObjs;this.objs=new sK;this._maybeCleanupAfterRender=false;this._intentStates=new Map;this.destroyed=false}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:e=this.rotate,offsetX:s=0,offsetY:i=0,dontFlip:n=false}={}){return new tE({viewBox:this.view,userUnit:this.userUnit,scale:t,rotation:e,offsetX:s,offsetY:i,dontFlip:n})}getAnnotations({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,e)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return $(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:t,viewport:e,intent:s="display",annotationMode:i=g.ENABLE,transform:n=null,background:r=null,optionalContentConfigPromise:a=null,annotationCanvasMap:o=null,pageColors:l=null,printAnnotationStorage:h=null,isEditing:c=false}){this._stats?.time("Overall");const d=this._transport.getRenderingIntent(s,i,h,c);const{renderingIntent:u,cacheKey:f}=d;this.#sJ=false;this.#sZ();a||=this._transport.getOptionalContentConfig(u);let m=this._intentStates.get(f);if(!m){m=Object.create(null);this._intentStates.set(f,m)}if(m.streamReaderCancelTimeout){clearTimeout(m.streamReaderCancelTimeout);m.streamReaderCancelTimeout=null}const b=!!(u&p.PRINT);if(!m.displayReadyCapability){m.displayReadyCapability=Promise.withResolvers();m.operatorList={fnArray:[],argsArray:[],lastChunk:false,separateAnnots:null};this._stats?.time("Page Request");this._pumpOperatorList(d)}const A=t=>{m.renderTasks.delete(v);if(this._maybeCleanupAfterRender||b){this.#sJ=true}this.#s0(!b);if(t){v.capability.reject(t);this._abortOperatorList({intentState:m,reason:t instanceof Error?t:new Error(t)})}else{v.capability.resolve()}if(this._stats){this._stats.timeEnd("Rendering");this._stats.timeEnd("Overall");if(globalThis.Stats?.enabled){globalThis.Stats.add(this.pageNumber,this._stats)}}};const v=new sY({callback:A,params:{canvasContext:t,viewport:e,transform:n,background:r},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:o,operatorList:m.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!b,pdfBug:this._pdfBug,pageColors:l});(m.renderTasks||=new Set).add(v);const y=v.task;Promise.all([m.displayReadyCapability.promise,a]).then(([t,e])=>{if(this.destroyed){A();return}this._stats?.time("Rendering");if(!(e.renderingIntent&u)){throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` "+"and `PDFDocumentProxy.getOptionalContentConfig` methods.")}v.initializeGraphics({transparency:t,optionalContentConfig:e});v.operatorListChanged()}).catch(A);return y}getOperatorList({intent:t="display",annotationMode:e=g.ENABLE,printAnnotationStorage:s=null,isEditing:i=false}={}){function n(){if(a.operatorList.lastChunk){a.opListReadCapability.resolve(a.operatorList);a.renderTasks.delete(o)}}const r=this._transport.getRenderingIntent(t,e,s,i,true);let a=this._intentStates.get(r.cacheKey);if(!a){a=Object.create(null);this._intentStates.set(r.cacheKey,a)}let o;if(!a.opListReadCapability){o=Object.create(null);o.operatorListChanged=n;a.opListReadCapability=Promise.withResolvers();(a.renderTasks||=new Set).add(o);a.operatorList={fnArray:[],argsArray:[],lastChunk:false,separateAnnots:null};this._stats?.time("Page Request");this._pumpOperatorList(r)}return a.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=false,disableNormalization:e=false}={}){const s=100;return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:t===true,disableNormalization:e===true},{highWaterMark:s,size(t){return t.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa){return this.getXfa().then(t=>sM.textContent(t))}const e=this.streamTextContent(t);return new Promise(function(t,s){function i(){n.read().then(function({value:e,done:s}){if(s){t(r);return}r.lang??=e.lang;Object.assign(r.styles,e.styles);r.items.push(...e.items);i()},s)}const n=e.getReader();const r={items:[],styles:Object.create(null),lang:null};i()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=true;const t=[];for(const e of this._intentStates.values()){this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:true});if(e.opListReadCapability){continue}for(const s of e.renderTasks){t.push(s.completed);s.cancel()}}this.objs.clear();this.#sJ=false;this.#sZ();return Promise.all(t)}cleanup(t=false){this.#sJ=true;const e=this.#s0(false);if(t&&e){this._stats&&=new tI}return e}#s0(t=false){this.#sZ();if(!this.#sJ||this.destroyed){return false}if(t){this.#sQ=setTimeout(()=>{this.#sQ=null;this.#s0(false)},sR);return false}for(const{renderTasks:t,operatorList:e}of this._intentStates.values()){if(t.size>0||!e.lastChunk){return false}}this._intentStates.clear();this.objs.clear();this.#sJ=false;return true}#sZ(){if(this.#sQ){clearTimeout(this.#sQ);this.#sQ=null}}_startRenderPage(t,e){const s=this._intentStates.get(e);if(!s){return}this._stats?.timeEnd("Page Request");s.displayReadyCapability?.resolve(t)}_renderPageChunk(t,e){for(let s=0,i=t.length;s<i;s++){e.operatorList.fnArray.push(t.fnArray[s]);e.operatorList.argsArray.push(t.argsArray[s])}e.operatorList.lastChunk=t.lastChunk;e.operatorList.separateAnnots=t.separateAnnots;for(const t of e.renderTasks){t.operatorListChanged()}if(t.lastChunk){this.#s0(true)}}_pumpOperatorList({renderingIntent:t,cacheKey:e,annotationStorageSerializable:s,modifiedIds:i}){const{map:n,transfer:r}=s;const a=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:e,annotationStorage:n,modifiedIds:i},r);const o=a.getReader();const l=this._intentStates.get(e);l.streamReader=o;const h=()=>{o.read().then(({value:t,done:e})=>{if(e){l.streamReader=null;return}if(this._transport.destroyed){return}this._renderPageChunk(t,l);h()},t=>{l.streamReader=null;if(this._transport.destroyed){return}if(l.operatorList){l.operatorList.lastChunk=true;for(const t of l.renderTasks){t.operatorListChanged()}this.#s0(true)}if(l.displayReadyCapability){l.displayReadyCapability.reject(t)}else if(l.opListReadCapability){l.opListReadCapability.reject(t)}else{throw t}})};h()}_abortOperatorList({intentState:t,reason:e,force:s=false}){if(!t.streamReader){return}if(t.streamReaderCancelTimeout){clearTimeout(t.streamReaderCancelTimeout);t.streamReaderCancelTimeout=null}if(!s){if(t.renderTasks.size>0){return}if(e instanceof tS){let s=sI;if(e.extraDelay>0&&e.extraDelay<1e3){s+=e.extraDelay}t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null;this._abortOperatorList({intentState:t,reason:e,force:true})},s);return}}t.streamReader.cancel(new Y(e.message)).catch(()=>{});t.streamReader=null;if(this._transport.destroyed){return}for(const[e,s]of this._intentStates){if(s===t){this._intentStates.delete(e);break}}this.cleanup()}get stats(){return this._stats}}class sj{#s1=new Map;#s2=Promise.resolve();postMessage(t,e){const s={data:structuredClone(t,e?{transfer:e}:null)};this.#s2.then(()=>{for(const[t]of this.#s1){t.call(this,s)}})}addEventListener(t,e,s=null){let i=null;if(s?.signal instanceof AbortSignal){const{signal:n}=s;if(n.aborted){N("LoopbackPort - cannot use an `aborted` signal.");return}const r=()=>this.removeEventListener(t,e);i=()=>n.removeEventListener("abort",r);n.addEventListener("abort",r)}this.#s1.set(e,i)}removeEventListener(t,e){const s=this.#s1.get(e);s?.();this.#s1.delete(e)}terminate(){for(const[,t]of this.#s1){t?.()}this.#s1.clear()}}class sV{static #s3=0;static #s5=false;static #s6;static{if(o){this.#s5=true;e2.workerSrc||="./pdf.worker.mjs"}this._isSameOrigin=(t,e)=>{let s;try{s=new URL(t);if(!s.origin||s.origin==="null"){return false}}catch{return false}const i=new URL(e,s);return s.origin===i.origin};this._createCDNWrapper=t=>{const e=`await import("${t}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}}constructor({name:t=null,port:e=null,verbosity:s=F()}={}){this.name=t;this.destroyed=false;this.verbosity=s;this._readyCapability=Promise.withResolvers();this._port=null;this._webWorker=null;this._messageHandler=null;if(e){if(sV.#s6?.has(e)){throw new Error("Cannot use more than one PDFWorker per port.")}(sV.#s6||=new WeakMap).set(e,this);this._initializeFromPort(e);return}this._initialize()}get promise(){return this._readyCapability.promise}#s4(){this._readyCapability.resolve();this._messageHandler.send("configure",{verbosity:this.verbosity})}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(t){this._port=t;this._messageHandler=new ea("main","worker",t);this._messageHandler.on("ready",function(){});this.#s4()}_initialize(){if(sV.#s5||sV.#s8){this._setupFakeWorker();return}let{workerSrc:t}=sV;try{if(!sV._isSameOrigin(window.location.href,t)){t=sV._createCDNWrapper(new URL(t,window.location).href)}const e=new Worker(t,{type:"module"});const s=new ea("main","worker",e);const i=()=>{n.abort();s.destroy();e.terminate();if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"))}else{this._setupFakeWorker()}};const n=new AbortController;e.addEventListener("error",()=>{if(!this._webWorker){i()}},{signal:n.signal});s.on("test",t=>{n.abort();if(this.destroyed||!t){i();return}this._messageHandler=s;this._port=e;this._webWorker=e;this.#s4()});s.on("ready",t=>{n.abort();if(this.destroyed){i();return}try{r()}catch{this._setupFakeWorker()}});const r=()=>{const t=new Uint8Array;s.send("test",t,[t.buffer])};r();return}catch{O("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){if(!sV.#s5){N("Setting up fake worker.");sV.#s5=true}sV._setupFakeWorkerGlobal.then(t=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const e=new sj;this._port=e;const s=`fake${sV.#s3++}`;const i=new ea(s+"_worker",s,e);t.setup(i,e);this._messageHandler=new ea(s,s+"_worker",e);this.#s4()}).catch(t=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${t.message}".`))})}destroy(){this.destroyed=true;this._webWorker?.terminate();this._webWorker=null;sV.#s6?.delete(this._port);this._port=null;this._messageHandler?.destroy();this._messageHandler=null}static fromPort(t){if(!t?.port){throw new Error("PDFWorker.fromPort - invalid method signature.")}const e=this.#s6?.get(t.port);if(e){if(e._pendingDestroy){throw new Error("PDFWorker.fromPort - the worker is being destroyed.\n"+"Please remember to await `PDFDocumentLoadingTask.destroy()`-calls.")}return e}return new sV(t)}static get workerSrc(){if(e2.workerSrc){return e2.workerSrc}throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get #s8(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){const t=async()=>{if(this.#s8){return this.#s8}const t=await import(this.workerSrc);return t.WorkerMessageHandler};return $(this,"_setupFakeWorkerGlobal",t())}}class sW{#s7=new Map;#s9=new Map;#it=new Map;#ie=new Map;#is=null;constructor(t,e,s,i,n){this.messageHandler=t;this.loadingTask=e;this.commonObjs=new sK;this.fontLoader=new et({ownerDocument:i.ownerDocument,styleElement:i.styleElement});this.loadingParams=i.loadingParams;this._params=i;this.canvasFactory=n.canvasFactory;this.filterFactory=n.filterFactory;this.cMapReaderFactory=n.cMapReaderFactory;this.standardFontDataFactory=n.standardFontDataFactory;this.destroyed=false;this.destroyCapability=null;this._networkStream=s;this._fullReader=null;this._lastProgress=null;this.downloadInfoCapability=Promise.withResolvers();this.setupMessageHandler()}#ii(t,e=null){const s=this.#s7.get(t);if(s){return s}const i=this.messageHandler.sendWithPromise(t,e);this.#s7.set(t,i);return i}get annotationStorage(){return $(this,"annotationStorage",new t7)}getRenderingIntent(t,e=g.ENABLE,s=null,i=false,n=false){let r=p.DISPLAY;let a=t8;switch(t){case"any":r=p.ANY;break;case"display":break;case"print":r=p.PRINT;break;default:N(`getRenderingIntent - invalid intent: ${t}`)}const o=r&p.PRINT&&s instanceof t9?s:this.annotationStorage;switch(e){case g.DISABLE:r+=p.ANNOTATIONS_DISABLE;break;case g.ENABLE:break;case g.ENABLE_FORMS:r+=p.ANNOTATIONS_FORMS;break;case g.ENABLE_STORAGE:r+=p.ANNOTATIONS_STORAGE;a=o.serializable;break;default:N(`getRenderingIntent - invalid annotationMode: ${e}`)}if(i){r+=p.IS_EDITING}if(n){r+=p.OPLIST}const{ids:l,hash:h}=o.modifiedIds;const c=[r,a.hash,h];return{renderingIntent:r,cacheKey:c.join("_"),annotationStorageSerializable:a,modifiedIds:l}}destroy(){if(this.destroyCapability){return this.destroyCapability.promise}this.destroyed=true;this.destroyCapability=Promise.withResolvers();this.#is?.reject(new Error("Worker was destroyed during onPassword callback"));const t=[];for(const e of this.#s9.values()){t.push(e._destroy())}this.#s9.clear();this.#it.clear();this.#ie.clear();if(this.hasOwnProperty("annotationStorage")){this.annotationStorage.resetModified()}const e=this.messageHandler.sendWithPromise("Terminate",null);t.push(e);Promise.all(t).then(()=>{this.commonObjs.clear();this.fontLoader.clear();this.#s7.clear();this.filterFactory.destroy();sT.cleanup();this._networkStream?.cancelAllRequests(new Y("Worker was terminated."));this.messageHandler?.destroy();this.messageHandler=null;this.destroyCapability.resolve()},this.destroyCapability.reject);return this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:e}=this;t.on("GetReader",(t,e)=>{H(this._networkStream,"GetReader - no `IPDFStream` instance available.");this._fullReader=this._networkStream.getFullReader();this._fullReader.onProgress=t=>{this._lastProgress={loaded:t.loaded,total:t.total}};e.onPull=()=>{this._fullReader.read().then(function({value:t,done:s}){if(s){e.close();return}H(t instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer.");e.enqueue(new Uint8Array(t),1,[t])}).catch(t=>{e.error(t)})};e.onCancel=t=>{this._fullReader.cancel(t);e.ready.catch(t=>{if(this.destroyed){return}throw t})}});t.on("ReaderHeadersReady",async t=>{await this._fullReader.headersReady;const{isStreamingSupported:s,isRangeSupported:i,contentLength:n}=this._fullReader;if(!s||!i){if(this._lastProgress){e.onProgress?.(this._lastProgress)}this._fullReader.onProgress=t=>{e.onProgress?.({loaded:t.loaded,total:t.total})}}return{isStreamingSupported:s,isRangeSupported:i,contentLength:n}});t.on("GetRangeReader",(t,e)=>{H(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const s=this._networkStream.getRangeReader(t.begin,t.end);if(!s){e.close();return}e.onPull=()=>{s.read().then(function({value:t,done:s}){if(s){e.close();return}H(t instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer.");e.enqueue(new Uint8Array(t),1,[t])}).catch(t=>{e.error(t)})};e.onCancel=t=>{s.cancel(t);e.ready.catch(t=>{if(this.destroyed){return}throw t})}});t.on("GetDoc",({pdfInfo:t})=>{this._numPages=t.numPages;this._htmlForXfa=t.htmlForXfa;delete t.htmlForXfa;e._capability.resolve(new s$(t,this))});t.on("DocException",t=>{e._capability.reject(er(t))});t.on("PasswordRequest",t=>{this.#is=Promise.withResolvers();try{if(!e.onPassword){throw er(t)}const s=t=>{if(t instanceof Error){this.#is.reject(t)}else{this.#is.resolve({password:t})}};e.onPassword(s,t.code)}catch(t){this.#is.reject(t)}return this.#is.promise});t.on("DataLoaded",t=>{e.onProgress?.({loaded:t.length,total:t.length});this.downloadInfoCapability.resolve(t)});t.on("StartRenderPage",t=>{if(this.destroyed){return}const e=this.#s9.get(t.pageIndex);e._startRenderPage(t.transparency,t.cacheKey)});t.on("commonobj",([e,s,i])=>{if(this.destroyed){return null}if(this.commonObjs.has(e)){return null}switch(s){case"Font":const{disableFontFace:n,fontExtraProperties:r,pdfBug:a}=this._params;if("error"in i){const t=i.error;N(`Error during font loading: ${t}`);this.commonObjs.resolve(e,t);break}const o=a&&globalThis.FontInspector?.enabled?(t,e)=>globalThis.FontInspector.fontAdded(t,e):null;const l=new ee(i,{disableFontFace:n,fontExtraProperties:r,inspectFont:o});this.fontLoader.bind(l).catch(()=>t.sendWithPromise("FontFallback",{id:e})).finally(()=>{if(!r&&l.data){l.data=null}this.commonObjs.resolve(e,l)});break;case"CopyLocalImage":const{imageRef:h}=i;H(h,"The imageRef must be defined.");for(const t of this.#s9.values()){for(const[,s]of t.objs){if(s?.ref!==h){continue}if(!s.dataLen){return null}this.commonObjs.resolve(e,structuredClone(s));return s.dataLen}}break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(e,i);break;default:throw new Error(`Got unknown common object type ${s}`)}return null});t.on("obj",([t,e,s,i])=>{if(this.destroyed){return}const n=this.#s9.get(e);if(n.objs.has(t)){return}if(n._intentStates.size===0){i?.bitmap?.close();return}switch(s){case"Image":n.objs.resolve(t,i);if(i?.dataLen>c){n._maybeCleanupAfterRender=true}break;case"Pattern":n.objs.resolve(t,i);break;default:throw new Error(`Got unknown object type ${s}`)}});t.on("DocProgress",t=>{if(this.destroyed){return}e.onProgress?.({loaded:t.loaded,total:t.total})});t.on("FetchBuiltInCMap",async t=>{if(this.destroyed){throw new Error("Worker was destroyed.")}if(!this.cMapReaderFactory){throw new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.")}return this.cMapReaderFactory.fetch(t)});t.on("FetchStandardFontData",async t=>{if(this.destroyed){throw new Error("Worker was destroyed.")}if(!this.standardFontDataFactory){throw new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")}return this.standardFontDataFactory.fetch(t)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){if(this.annotationStorage.size<=0){N("saveDocument called while `annotationStorage` is empty, "+"please use the getData-method instead.")}const{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:this._fullReader?.filename??null},e).finally(()=>{this.annotationStorage.resetModified()})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages){return Promise.reject(new Error("Invalid page request."))}const e=t-1,s=this.#it.get(e);if(s){return s}const i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then(s=>{if(this.destroyed){throw new Error("Transport destroyed")}if(s.refStr){this.#ie.set(s.refStr,t)}const i=new sG(e,s,this,this._params.pdfBug);this.#s9.set(e,i);return i});this.#it.set(e,i);return i}getPageIndex(t){if(!sH(t)){return Promise.reject(new Error("Invalid pageIndex request."))}return this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen})}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return this.#ii("GetFieldObjects")}hasJSActions(){return this.#ii("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){if(typeof t!=="string"){return Promise.reject(new Error("Invalid destination request."))}return this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return this.#ii("GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return this.#ii("GetOptionalContentConfig").then(e=>new e4(e,t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const t="GetMetadata",e=this.#s7.get(t);if(e){return e}const s=this.messageHandler.sendWithPromise(t,null).then(t=>({info:t[0],metadata:t[1]?new e3(t[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));this.#s7.set(t,s);return s}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=false){if(this.destroyed){return}await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of this.#s9.values()){const e=t.cleanup();if(!e){throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`)}}this.commonObjs.clear();if(!t){this.fontLoader.clear()}this.#s7.clear();this.filterFactory.destroy(true);sT.cleanup()}cachedPageNumber(t){if(!sH(t)){return null}const e=t.gen===0?`${t.num}R`:`${t.num}R${t.gen}`;return this.#ie.get(e)??null}}const sq=Symbol("INITIAL_DATA");class sK{#ir=Object.create(null);#ia(t){return this.#ir[t]||={...Promise.withResolvers(),data:sq}}get(t,e=null){if(e){const s=this.#ia(t);s.promise.then(()=>e(s.data));return null}const s=this.#ir[t];if(!s||s.data===sq){throw new Error(`Requesting object that isn't resolved yet ${t}.`)}return s.data}has(t){const e=this.#ir[t];return!!e&&e.data!==sq}delete(t){const e=this.#ir[t];if(!e||e.data===sq){return false}delete this.#ir[t];return true}resolve(t,e=null){const s=this.#ia(t);s.data=e;s.resolve()}clear(){for(const t in this.#ir){const{data:e}=this.#ir[t];e?.bitmap?.close()}this.#ir=Object.create(null)}*[Symbol.iterator](){for(const t in this.#ir){const{data:e}=this.#ir[t];if(e===sq){continue}yield[t,e]}}}class sX{#io=null;constructor(t){this.#io=t;this.onContinue=null}get promise(){return this.#io.capability.promise}cancel(t=0){this.#io.cancel(null,t)}get separateAnnots(){const{separateAnnots:t}=this.#io.operatorList;if(!t){return false}const{annotationCanvasMap:e}=this.#io;return t.form||t.canvas&&e?.size>0}}class sY{#il=null;static #ih=new WeakSet;constructor({callback:t,params:e,objs:s,commonObjs:i,annotationCanvasMap:n,operatorList:r,pageIndex:a,canvasFactory:o,filterFactory:l,useRequestAnimationFrame:h=false,pdfBug:c=false,pageColors:d=null}){this.callback=t;this.params=e;this.objs=s;this.commonObjs=i;this.annotationCanvasMap=n;this.operatorListIdx=null;this.operatorList=r;this._pageIndex=a;this.canvasFactory=o;this.filterFactory=l;this._pdfBug=c;this.pageColors=d;this.running=false;this.graphicsReadyCallback=null;this.graphicsReady=false;this._useRequestAnimationFrame=h===true&&typeof window!=="undefined";this.cancelled=false;this.capability=Promise.withResolvers();this.task=new sX(this);this._cancelBound=this.cancel.bind(this);this._continueBound=this._continue.bind(this);this._scheduleNextBound=this._scheduleNext.bind(this);this._nextBound=this._next.bind(this);this._canvas=e.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=false,optionalContentConfig:e}){if(this.cancelled){return}if(this._canvas){if(sY.#ih.has(this._canvas)){throw new Error("Cannot use the same canvas during multiple render() operations. "+"Use different canvas or ensure previous operations were "+"cancelled or completed.")}sY.#ih.add(this._canvas)}if(this._pdfBug&&globalThis.StepperManager?.enabled){this.stepper=globalThis.StepperManager.create(this._pageIndex);this.stepper.init(this.operatorList);this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint()}const{canvasContext:s,viewport:i,transform:n,background:r}=this.params;this.gfx=new e1(s,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:e},this.annotationCanvasMap,this.pageColors);this.gfx.beginDrawing({transform:n,viewport:i,transparency:t,background:r});this.operatorListIdx=0;this.graphicsReady=true;this.graphicsReadyCallback?.()}cancel(t=null,e=0){this.running=false;this.cancelled=true;this.gfx?.endDrawing();if(this.#il){window.cancelAnimationFrame(this.#il);this.#il=null}sY.#ih.delete(this._canvas);this.callback(t||new tS(`Rendering cancelled, page ${this._pageIndex+1}`,e))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.stepper?.updateOperatorList(this.operatorList);if(this.running){return}this._continue()}_continue(){this.running=true;if(this.cancelled){return}if(this.task.onContinue){this.task.onContinue(this._scheduleNextBound)}else{this._scheduleNext()}}_scheduleNext(){if(this._useRequestAnimationFrame){this.#il=window.requestAnimationFrame(()=>{this.#il=null;this._nextBound().catch(this._cancelBound)})}else{Promise.resolve().then(this._nextBound).catch(this._cancelBound)}}async _next(){if(this.cancelled){return}this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper);if(this.operatorListIdx===this.operatorList.argsArray.length){this.running=false;if(this.operatorList.lastChunk){this.gfx.endDrawing();sY.#ih.delete(this._canvas);this.callback()}}}}const sQ="4.10.38";const sJ="f9bea397f";function sZ(t){return Math.floor(Math.max(0,Math.min(1,t))*255).toString(16).padStart(2,"0")}function s0(t){return Math.max(0,Math.min(255,255*t))}class s1{static CMYK_G([t,e,s,i]){return["G",1-Math.min(1,.3*t+.59*s+.11*e+i)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){t=s0(t);return[t,t,t]}static G_HTML([t]){const e=sZ(t);return`#${e}${e}${e}`}static RGB_G([t,e,s]){return["G",.3*t+.59*e+.11*s]}static RGB_rgb(t){return t.map(s0)}static RGB_HTML(t){return`#${t.map(sZ).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,e,s,i]){return["RGB",1-Math.min(1,t+i),1-Math.min(1,s+i),1-Math.min(1,e+i)]}static CMYK_rgb([t,e,s,i]){return[s0(1-Math.min(1,t+i)),s0(1-Math.min(1,s+i)),s0(1-Math.min(1,e+i))]}static CMYK_HTML(t){const e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}static RGB_CMYK([t,e,s]){const i=1-t;const n=1-e;const r=1-s;const a=Math.min(i,n,r);return["CMYK",i,n,r,a]}};class s2{create(t,e,s=false){if(t<=0||e<=0){throw new Error("Invalid SVG dimensions")}const i=this._createSVG("svg:svg");i.setAttribute("version","1.1");if(!s){i.setAttribute("width",`${t}px`);i.setAttribute("height",`${e}px`)}i.setAttribute("preserveAspectRatio","none");i.setAttribute("viewBox",`0 0 ${t} ${e}`);return i}createElement(t){if(typeof t!=="string"){throw new Error("Invalid SVG element type")}return this._createSVG(t)}_createSVG(t){B("Abstract method `_createSVG` called.")}}class s3 extends s2{_createSVG(t){return document.createElementNS(tw,t)}};class s5{static setupStorage(t,e,s,i,n){const r=i.getValue(e,{value:null});switch(s.name){case"textarea":if(r.value!==null){t.textContent=r.value}if(n==="print"){break}t.addEventListener("input",t=>{i.setValue(e,{value:t.target.value})});break;case"input":if(s.attributes.type==="radio"||s.attributes.type==="checkbox"){if(r.value===s.attributes.xfaOn){t.setAttribute("checked",true)}else if(r.value===s.attributes.xfaOff){t.removeAttribute("checked")}if(n==="print"){break}t.addEventListener("change",t=>{i.setValue(e,{value:t.target.checked?t.target.getAttribute("xfaOn"):t.target.getAttribute("xfaOff")})})}else{if(r.value!==null){t.setAttribute("value",r.value)}if(n==="print"){break}t.addEventListener("input",t=>{i.setValue(e,{value:t.target.value})})}break;case"select":if(r.value!==null){t.setAttribute("value",r.value);for(const t of s.children){if(t.attributes.value===r.value){t.attributes.selected=true}else if(t.attributes.hasOwnProperty("selected")){delete t.attributes.selected}}}t.addEventListener("input",t=>{const s=t.target.options;const n=s.selectedIndex===-1?"":s[s.selectedIndex].value;i.setValue(e,{value:n})});break}}static setAttributes({html:t,element:e,storage:s=null,intent:i,linkService:n}){const{attributes:r}=e;const a=t instanceof HTMLAnchorElement;if(r.type==="radio"){r.name=`${r.name}-${i}`}for(const[e,s]of Object.entries(r)){if(s===null||s===undefined){continue}switch(e){case"class":if(s.length){t.setAttribute(e,s.join(" "))}break;case"dataId":break;case"id":t.setAttribute("data-element-id",s);break;case"style":Object.assign(t.style,s);break;case"textContent":t.textContent=s;break;default:if(!a||e!=="href"&&e!=="newWindow"){t.setAttribute(e,s)}}}if(a){n.addLinkAttributes(t,r.href,r.newWindow)}if(s&&r.dataId){this.setupStorage(t,r.dataId,e,s)}}static render(t){const e=t.annotationStorage;const s=t.linkService;const i=t.xfaHtml;const n=t.intent||"display";const r=document.createElement(i.name);if(i.attributes){this.setAttributes({html:r,element:i,intent:n,linkService:s})}const a=n!=="richText";const o=t.div;o.append(r);if(t.viewport){const e=`matrix(${t.viewport.transform.join(",")})`;o.style.transform=e}if(a){o.setAttribute("class","xfaLayer xfaFont")}const l=[];if(i.children.length===0){if(i.value){const t=document.createTextNode(i.value);r.append(t);if(a&&sM.shouldBuildText(i.name)){l.push(t)}}return{textDivs:l}}const h=[[i,-1,r]];while(h.length>0){const[t,i,r]=h.at(-1);if(i+1===t.children.length){h.pop();continue}const o=t.children[++h.at(-1)[1]];if(o===null){continue}const{name:c}=o;if(c==="#text"){const t=document.createTextNode(o.value);l.push(t);r.append(t);continue}const d=o?.attributes?.xmlns?document.createElementNS(o.attributes.xmlns,c):document.createElement(c);r.append(d);if(o.attributes){this.setAttributes({html:d,element:o,storage:e,intent:n,linkService:s})}if(o.children?.length>0){h.push([o,-1,d])}else if(o.value){const t=document.createTextNode(o.value);if(a&&sM.shouldBuildText(c)){l.push(t)}d.append(t)}}for(const t of o.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea")){t.setAttribute("readOnly",true)}return{textDivs:l}}static update(t){const e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e;t.div.hidden=false}};const s6=1e3;const s4=9;const s8=new WeakSet;function s7(t){return{width:t[2]-t[0],height:t[3]-t[1]}}class s9{static create(t){const e=t.data.annotationType;switch(e){case _.LINK:return new ie(t);case _.TEXT:return new is(t);case _.WIDGET:const s=t.data.fieldType;switch(s){case"Tx":return new ir(t);case"Btn":if(t.data.radioButton){return new il(t)}else if(t.data.checkBox){return new io(t)}return new ih(t);case"Ch":return new ic(t);case"Sig":return new ia(t)}return new ii(t);case _.POPUP:return new id(t);case _.FREETEXT:return new ip(t);case _.LINE:return new ig(t);case _.SQUARE:return new im(t);case _.CIRCLE:return new ib(t);case _.POLYLINE:return new iA(t);case _.CARET:return new iy(t);case _.INK:return new iw(t);case _.POLYGON:return new iv(t);case _.HIGHLIGHT:return new i_(t);case _.UNDERLINE:return new ix(t);case _.SQUIGGLY:return new iE(t);case _.STRIKEOUT:return new iS(t);case _.STAMP:return new iC(t);case _.FILEATTACHMENT:return new iT(t);default:return new it(t)}}}class it{#ic=null;#id=false;#iu=null;constructor(t,{isRenderable:e=false,ignoreBorder:s=false,createQuadrilaterals:i=false}={}){this.isRenderable=e;this.data=t.data;this.layer=t.layer;this.linkService=t.linkService;this.downloadManager=t.downloadManager;this.imageResourcesPath=t.imageResourcesPath;this.renderForms=t.renderForms;this.svgFactory=t.svgFactory;this.annotationStorage=t.annotationStorage;this.enableScripting=t.enableScripting;this.hasJSActions=t.hasJSActions;this._fieldObjects=t.fieldObjects;this.parent=t.parent;if(e){this.container=this._createContainer(s)}if(i){this._createQuadrilaterals()}}static _hasPopupData({titleObj:t,contentsObj:e,richText:s}){return!!(t?.str||e?.str||s?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return it._hasPopupData(this.data)}updateEdited(t){if(!this.container){return}this.#ic||={rect:this.data.rect.slice(0)};const{rect:e}=t;if(e){this.#ip(e)}this.#iu?.popup.updateEdited(t)}resetEdited(){if(!this.#ic){return}this.#ip(this.#ic.rect);this.#iu?.popup.resetEdited();this.#ic=null}#ip(t){const{container:{style:e},data:{rect:s,rotation:i},parent:{viewport:{rawDims:{pageWidth:n,pageHeight:r,pageX:a,pageY:o}}}}=this;s?.splice(0,4,...t);const{width:l,height:h}=s7(t);e.left=`${100*(t[0]-a)/n}%`;e.top=`${100*(r-t[3]+o)/r}%`;if(i===0){e.width=`${100*l/n}%`;e.height=`${100*h/r}%`}else{this.setRotation(i)}}_createContainer(t){const{data:e,parent:{page:s,viewport:i}}=this;const n=document.createElement("section");n.setAttribute("data-annotation-id",e.id);if(!(this instanceof ii)){n.tabIndex=s6}const{style:r}=n;r.zIndex=this.parent.zIndex++;if(e.alternativeText){n.title=e.alternativeText}if(e.noRotate){n.classList.add("norotate")}if(!e.rect||this instanceof id){const{rotation:t}=e;if(!e.hasOwnCanvas&&t!==0){this.setRotation(t,n)}return n}const{width:a,height:o}=s7(e.rect);if(!t&&e.borderStyle.width>0){r.borderWidth=`${e.borderStyle.width}px`;const t=e.borderStyle.horizontalCornerRadius;const s=e.borderStyle.verticalCornerRadius;if(t>0||s>0){const e=`calc(${t}px * var(--scale-factor)) / calc(${s}px * var(--scale-factor))`;r.borderRadius=e}else if(this instanceof il){const t=`calc(${a}px * var(--scale-factor)) / calc(${o}px * var(--scale-factor))`;r.borderRadius=t}switch(e.borderStyle.style){case C.SOLID:r.borderStyle="solid";break;case C.DASHED:r.borderStyle="dashed";break;case C.BEVELED:N("Unimplemented border style: beveled");break;case C.INSET:N("Unimplemented border style: inset");break;case C.UNDERLINE:r.borderBottomStyle="solid";break;default:break}const i=e.borderColor||null;if(i){this.#id=true;r.borderColor=ta.makeHexColor(i[0]|0,i[1]|0,i[2]|0)}else{r.borderWidth=0}}const l=ta.normalizeRect([e.rect[0],s.view[3]-e.rect[1]+s.view[1],e.rect[2],s.view[3]-e.rect[3]+s.view[1]]);const{pageWidth:h,pageHeight:c,pageX:d,pageY:u}=i.rawDims;r.left=`${100*(l[0]-d)/h}%`;r.top=`${100*(l[1]-u)/c}%`;const{rotation:f}=e;if(e.hasOwnCanvas||f===0){r.width=`${100*a/h}%`;r.height=`${100*o/c}%`}else{this.setRotation(f,n)}return n}setRotation(t,e=this.container){if(!this.data.rect){return}const{pageWidth:s,pageHeight:i}=this.parent.viewport.rawDims;const{width:n,height:r}=s7(this.data.rect);let a,o;if(t%180===0){a=100*n/s;o=100*r/i}else{a=100*r/s;o=100*n/i}e.style.width=`${a}%`;e.style.height=`${o}%`;e.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){const t=(t,e,s)=>{const i=s.detail[t];const n=i[0];const r=i.slice(1);s.target.style[e]=s1[`${n}_HTML`](r);this.annotationStorage.setValue(this.data.id,{[e]:s1[`${n}_rgb`](r)})};return $(this,"_commonActions",{display:t=>{const{display:e}=t.detail;const s=e%2===1;this.container.style.visibility=s?"hidden":"visible";this.annotationStorage.setValue(this.data.id,{noView:s,noPrint:e===1||e===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:e}=t.detail;this.container.style.visibility=e?"hidden":"visible";this.annotationStorage.setValue(this.data.id,{noPrint:e,noView:e})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:false}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:e=>{t("bgColor","backgroundColor",e)},fillColor:e=>{t("fillColor","backgroundColor",e)},fgColor:e=>{t("fgColor","color",e)},textColor:e=>{t("textColor","color",e)},borderColor:e=>{t("borderColor","borderColor",e)},strokeColor:e=>{t("strokeColor","borderColor",e)},rotation:t=>{const e=t.detail.rotation;this.setRotation(e);this.annotationStorage.setValue(this.data.id,{rotation:e})}})}_dispatchEventFromSandbox(t,e){const s=this._commonActions;for(const i of Object.keys(e.detail)){const n=t[i]||s[i];n?.(e)}}_setDefaultPropertiesFromJS(t){if(!this.enableScripting){return}const e=this.annotationStorage.getRawValue(this.data.id);if(!e){return}const s=this._commonActions;for(const[i,n]of Object.entries(e)){const r=s[i];if(r){const s={detail:{[i]:n},target:t};r(s);delete e[i]}}}_createQuadrilaterals(){if(!this.container){return}const{quadPoints:t}=this.data;if(!t){return}const[e,s,i,n]=this.data.rect.map(t=>Math.fround(t));if(t.length===8){const[r,a,o,l]=t.subarray(2,6);if(i===r&&n===a&&e===o&&s===l){return}}const{style:r}=this.container;let a;if(this.#id){const{borderColor:t,borderWidth:e}=r;r.borderWidth=0;a=["url('data:image/svg+xml;utf8,",`<svg xmlns="http://www.w3.org/2000/svg"`,` preserveAspectRatio="none" viewBox="0 0 1 1">`,`<g fill="transparent" stroke="${t}" stroke-width="${e}">`];this.container.classList.add("hasBorder")}const o=i-e;const l=n-s;const{svgFactory:h}=this;const c=h.createElement("svg");c.classList.add("quadrilateralsContainer");c.setAttribute("width",0);c.setAttribute("height",0);const d=h.createElement("defs");c.append(d);const u=h.createElement("clipPath");const f=`clippath_${this.data.id}`;u.setAttribute("id",f);u.setAttribute("clipPathUnits","objectBoundingBox");d.append(u);for(let s=2,i=t.length;s<i;s+=8){const i=t[s];const r=t[s+1];const c=t[s+2];const d=t[s+3];const f=h.createElement("rect");const p=(c-e)/o;const g=(n-r)/l;const m=(i-c)/o;const b=(r-d)/l;f.setAttribute("x",p);f.setAttribute("y",g);f.setAttribute("width",m);f.setAttribute("height",b);u.append(f);a?.push(`<rect vector-effect="non-scaling-stroke" x="${p}" y="${g}" width="${m}" height="${b}"/>`)}if(this.#id){a.push(`</g></svg>')`);r.backgroundImage=a.join("")}this.container.append(c);this.container.style.clipPath=`url(#${f})`}_createPopup(){const{data:t}=this;const e=this.#iu=new id({data:{color:t.color,titleObj:t.titleObj,modificationDate:t.modificationDate,contentsObj:t.contentsObj,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation},parent:this.parent,elements:[this]});this.parent.div.append(e.render())}render(){B("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,e=null){const s=[];if(this._fieldObjects){const i=this._fieldObjects[t];if(i){for(const{page:t,id:n,exportValues:r}of i){if(t===-1){continue}if(n===e){continue}const i=typeof r==="string"?r:null;const a=document.querySelector(`[data-element-id="${n}"]`);if(a&&!s8.has(a)){N(`_getElementsByName - element not allowed: ${n}`);continue}s.push({id:n,exportValue:i,domElement:a})}}return s}for(const i of document.getElementsByName(t)){const{exportValue:t}=i;const n=i.getAttribute("data-element-id");if(n===e){continue}if(!s8.has(i)){continue}s.push({id:n,exportValue:t,domElement:i})}return s}show(){if(this.container){this.container.hidden=false}this.popup?.maybeShow()}hide(){if(this.container){this.container.hidden=true}this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const t=this.getElementsToTriggerPopup();if(Array.isArray(t)){for(const e of t){e.classList.add("highlightArea")}}else{t.classList.add("highlightArea")}}_editOnDoubleClick(){if(!this._isEditable){return}const{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e})})}}class ie extends it{constructor(t,e=null){super(t,{isRenderable:true,ignoreBorder:!!e?.ignoreBorder,createQuadrilaterals:true});this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:e}=this;const s=document.createElement("a");s.setAttribute("data-element-id",t.id);let i=false;if(t.url){e.addLinkAttributes(s,t.url,t.newWindow);i=true}else if(t.action){this._bindNamedAction(s,t.action);i=true}else if(t.attachment){this.#ig(s,t.attachment,t.attachmentDest);i=true}else if(t.setOCGState){this.#im(s,t.setOCGState);i=true}else if(t.dest){this._bindLink(s,t.dest);i=true}else{if(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions){this._bindJSAction(s,t);i=true}if(t.resetForm){this._bindResetFormAction(s,t.resetForm);i=true}else if(this.isTooltipOnly&&!i){this._bindLink(s,"");i=true}}this.container.classList.add("linkAnnotation");if(i){this.container.append(s)}return this.container}#ib(){this.container.setAttribute("data-internal-link","")}_bindLink(t,e){t.href=this.linkService.getDestinationHash(e);t.onclick=()=>{if(e){this.linkService.goToDestination(e)}return false};if(e||e===""){this.#ib()}}_bindNamedAction(t,e){t.href=this.linkService.getAnchorUrl("");t.onclick=()=>{this.linkService.executeNamedAction(e);return false};this.#ib()}#ig(t,e,s=null){t.href=this.linkService.getAnchorUrl("");if(e.description){t.title=e.description}t.onclick=()=>{this.downloadManager?.openOrDownloadData(e.content,e.filename,s);return false};this.#ib()}#im(t,e){t.href=this.linkService.getAnchorUrl("");t.onclick=()=>{this.linkService.executeSetOCGState(e);return false};this.#ib()}_bindJSAction(t,e){t.href=this.linkService.getAnchorUrl("");const s=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const i of Object.keys(e.actions)){const n=s.get(i);if(!n){continue}t[n]=()=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e.id,name:i}});return false}}if(!t.onclick){t.onclick=()=>false}this.#ib()}_bindResetFormAction(t,e){const s=t.onclick;if(!s){t.href=this.linkService.getAnchorUrl("")}this.#ib();if(!this._fieldObjects){N(`_bindResetFormAction - "resetForm" action not supported, `+"ensure that the `fieldObjects` parameter is provided.");if(!s){t.onclick=()=>false}return}t.onclick=()=>{s?.();const{fields:t,refs:i,include:n}=e;const r=[];if(t.length!==0||i.length!==0){const e=new Set(i);for(const s of t){const t=this._fieldObjects[s]||[];for(const{id:s}of t){e.add(s)}}for(const t of Object.values(this._fieldObjects)){for(const s of t){if(e.has(s.id)===n){r.push(s)}}}}else{for(const t of Object.values(this._fieldObjects)){r.push(...t)}}const a=this.annotationStorage;const o=[];for(const t of r){const{id:e}=t;o.push(e);switch(t.type){case"text":{const s=t.defaultValue||"";a.setValue(e,{value:s});break}case"checkbox":case"radiobutton":{const s=t.defaultValue===t.exportValues;a.setValue(e,{value:s});break}case"combobox":case"listbox":{const s=t.defaultValue||"";a.setValue(e,{value:s});break}default:continue}const s=document.querySelector(`[data-element-id="${e}"]`);if(!s){continue}else if(!s8.has(s)){N(`_bindResetFormAction - element not allowed: ${e}`);continue}s.dispatchEvent(new Event("resetform"))}if(this.enableScripting){this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:o,name:"ResetForm"}})}return false}}}class is extends it{constructor(t){super(t,{isRenderable:true})}render(){this.container.classList.add("textAnnotation");const t=document.createElement("img");t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg";t.setAttribute("data-l10n-id","pdfjs-text-annotation-type");t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name}));if(!this.data.popupRef&&this.hasPopupData){this._createPopup()}this.container.append(t);return this.container}}class ii extends it{render(){return this.container}showElementAndHideCanvas(t){if(this.data.hasOwnCanvas){if(t.previousSibling?.nodeName==="CANVAS"){t.previousSibling.hidden=true}t.hidden=false}}_getKeyModifier(t){return tn.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,s,i,n){if(s.includes("mouse")){t.addEventListener(s,t=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:n(t),shift:t.shiftKey,modifier:this._getKeyModifier(t)}})})}else{t.addEventListener(s,t=>{if(s==="blur"){if(!e.focused||!t.relatedTarget){return}e.focused=false}else if(s==="focus"){if(e.focused){return}e.focused=true}if(!n){return}this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:n(t)}})})}}_setEventListeners(t,e,s,i){for(const[n,r]of s){if(r==="Action"||this.data.actions?.[r]){if(r==="Focus"||r==="Blur"){e||={focused:false}}this._setEventListener(t,e,n,r,i);if(r==="Focus"&&!this.data.actions?.Blur){this._setEventListener(t,e,"blur","Blur",null)}else if(r==="Blur"&&!this.data.actions?.Focus){this._setEventListener(t,e,"focus","Focus",null)}}}}_setBackgroundColor(t){const e=this.data.backgroundColor||null;t.style.backgroundColor=e===null?"transparent":ta.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){const e=["left","center","right"];const{fontColor:s}=this.data.defaultAppearanceData;const i=this.data.defaultAppearanceData.fontSize||s4;const n=t.style;let r;const a=2;const o=t=>Math.round(10*t)/10;if(this.data.multiLine){const t=Math.abs(this.data.rect[3]-this.data.rect[1]-a);const e=Math.round(t/(d*i))||1;const s=t/e;r=Math.min(i,o(s/d))}else{const t=Math.abs(this.data.rect[3]-this.data.rect[1]-a);r=Math.min(i,o(t/d))}n.fontSize=`calc(${r}px * var(--scale-factor))`;n.color=ta.makeHexColor(s[0],s[1],s[2]);if(this.data.textAlignment!==null){n.textAlign=e[this.data.textAlignment]}}_setRequired(t,e){if(e){t.setAttribute("required",true)}else{t.removeAttribute("required")}t.setAttribute("aria-required",e)}}class ir extends ii{constructor(t){const e=t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue;super(t,{isRenderable:e})}setPropertyOnSiblings(t,e,s,i){const n=this.annotationStorage;for(const r of this._getElementsByName(t.name,t.id)){if(r.domElement){r.domElement[e]=s}n.setValue(r.id,{[i]:s})}}render(){const t=this.annotationStorage;const e=this.data.id;this.container.classList.add("textWidgetAnnotation");let s=null;if(this.renderForms){const i=t.getValue(e,{value:this.data.fieldValue});let n=i.value||"";const r=t.getValue(e,{charLimit:this.data.maxLen}).charLimit;if(r&&n.length>r){n=n.slice(0,r)}let a=i.formattedValue||this.data.textContent?.join("\n")||null;if(a&&this.data.comb){a=a.replaceAll(/\s+/g,"")}const o={userValue:n,formattedValue:a,lastCommittedValue:null,commitKey:1,focused:false};if(this.data.multiLine){s=document.createElement("textarea");s.textContent=a??n;if(this.data.doNotScroll){s.style.overflowY="hidden"}}else{s=document.createElement("input");s.type="text";s.setAttribute("value",a??n);if(this.data.doNotScroll){s.style.overflowX="hidden"}}if(this.data.hasOwnCanvas){s.hidden=true}s8.add(s);s.setAttribute("data-element-id",e);s.disabled=this.data.readOnly;s.name=this.data.fieldName;s.tabIndex=s6;this._setRequired(s,this.data.required);if(r){s.maxLength=r}s.addEventListener("input",i=>{t.setValue(e,{value:i.target.value});this.setPropertyOnSiblings(s,"value",i.target.value,"value");o.formattedValue=null});s.addEventListener("resetform",t=>{const e=this.data.defaultFieldValue??"";s.value=o.userValue=e;o.formattedValue=null});let l=t=>{const{formattedValue:e}=o;if(e!==null&&e!==undefined){t.target.value=e}t.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){s.addEventListener("focus",t=>{if(o.focused){return}const{target:e}=t;if(o.userValue){e.value=o.userValue}o.lastCommittedValue=e.value;o.commitKey=1;if(!this.data.actions?.Focus){o.focused=true}});s.addEventListener("updatefromsandbox",s=>{this.showElementAndHideCanvas(s.target);const i={value(s){o.userValue=s.detail.value??"";t.setValue(e,{value:o.userValue.toString()});s.target.value=o.userValue},formattedValue(s){const{formattedValue:i}=s.detail;o.formattedValue=i;if(i!==null&&i!==undefined&&s.target!==document.activeElement){s.target.value=i}t.setValue(e,{formattedValue:i})},selRange(t){t.target.setSelectionRange(...t.detail.selRange)},charLimit:s=>{const{charLimit:i}=s.detail;const{target:n}=s;if(i===0){n.removeAttribute("maxLength");return}n.setAttribute("maxLength",i);let r=o.userValue;if(!r||r.length<=i){return}r=r.slice(0,i);n.value=o.userValue=r;t.setValue(e,{value:r});this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:r,willCommit:true,commitKey:1,selStart:n.selectionStart,selEnd:n.selectionEnd}})}};this._dispatchEventFromSandbox(i,s)});s.addEventListener("keydown",t=>{o.commitKey=1;let s=-1;if(t.key==="Escape"){s=0}else if(t.key==="Enter"&&!this.data.multiLine){s=2}else if(t.key==="Tab"){o.commitKey=3}if(s===-1){return}const{value:i}=t.target;if(o.lastCommittedValue===i){return}o.lastCommittedValue=i;o.userValue=i;this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:i,willCommit:true,commitKey:s,selStart:t.target.selectionStart,selEnd:t.target.selectionEnd}})});const i=l;l=null;s.addEventListener("blur",t=>{if(!o.focused||!t.relatedTarget){return}if(!this.data.actions?.Blur){o.focused=false}const{value:s}=t.target;o.userValue=s;if(o.lastCommittedValue!==s){this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:s,willCommit:true,commitKey:o.commitKey,selStart:t.target.selectionStart,selEnd:t.target.selectionEnd}})}i(t)});if(this.data.actions?.Keystroke){s.addEventListener("beforeinput",t=>{o.lastCommittedValue=null;const{data:s,target:i}=t;const{value:n,selectionStart:r,selectionEnd:a}=i;let l=r,h=a;switch(t.inputType){case"deleteWordBackward":{const t=n.substring(0,r).match(/\w*[^\w]*$/);if(t){l-=t[0].length}break}case"deleteWordForward":{const t=n.substring(r).match(/^[^\w]*\w*/);if(t){h+=t[0].length}break}case"deleteContentBackward":if(r===a){l-=1}break;case"deleteContentForward":if(r===a){h+=1}break}t.preventDefault();this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:n,change:s||"",willCommit:false,selStart:l,selEnd:h}})})}this._setEventListeners(s,o,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],t=>t.target.value)}if(l){s.addEventListener("blur",l)}if(this.data.comb){const t=this.data.rect[2]-this.data.rect[0];const e=t/r;s.classList.add("comb");s.style.letterSpacing=`calc(${e}px * var(--scale-factor) - 1ch)`}}else{s=document.createElement("div");s.textContent=this.data.fieldValue;s.style.verticalAlign="middle";s.style.display="table-cell";if(this.data.hasOwnCanvas){s.hidden=true}}this._setTextStyle(s);this._setBackgroundColor(s);this._setDefaultPropertiesFromJS(s);this.container.append(s);return this.container}}class ia extends ii{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}}class io extends ii{constructor(t){super(t,{isRenderable:t.renderForms})}render(){const t=this.annotationStorage;const e=this.data;const s=e.id;let i=t.getValue(s,{value:e.exportValue===e.fieldValue}).value;if(typeof i==="string"){i=i!=="Off";t.setValue(s,{value:i})}this.container.classList.add("buttonWidgetAnnotation","checkBox");const n=document.createElement("input");s8.add(n);n.setAttribute("data-element-id",s);n.disabled=e.readOnly;this._setRequired(n,this.data.required);n.type="checkbox";n.name=e.fieldName;if(i){n.setAttribute("checked",true)}n.setAttribute("exportValue",e.exportValue);n.tabIndex=s6;n.addEventListener("change",i=>{const{name:n,checked:r}=i.target;for(const i of this._getElementsByName(n,s)){const s=r&&i.exportValue===e.exportValue;if(i.domElement){i.domElement.checked=s}t.setValue(i.id,{value:s})}t.setValue(s,{value:r})});n.addEventListener("resetform",t=>{const s=e.defaultFieldValue||"Off";t.target.checked=s===e.exportValue});if(this.enableScripting&&this.hasJSActions){n.addEventListener("updatefromsandbox",e=>{const i={value(e){e.target.checked=e.detail.value!=="Off";t.setValue(s,{value:e.target.checked})}};this._dispatchEventFromSandbox(i,e)});this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],t=>t.target.checked)}this._setBackgroundColor(n);this._setDefaultPropertiesFromJS(n);this.container.append(n);return this.container}}class il extends ii{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const t=this.annotationStorage;const e=this.data;const s=e.id;let i=t.getValue(s,{value:e.fieldValue===e.buttonValue}).value;if(typeof i==="string"){i=i!==e.buttonValue;t.setValue(s,{value:i})}if(i){for(const i of this._getElementsByName(e.fieldName,s)){t.setValue(i.id,{value:false})}}const n=document.createElement("input");s8.add(n);n.setAttribute("data-element-id",s);n.disabled=e.readOnly;this._setRequired(n,this.data.required);n.type="radio";n.name=e.fieldName;if(i){n.setAttribute("checked",true)}n.tabIndex=s6;n.addEventListener("change",e=>{const{name:i,checked:n}=e.target;for(const e of this._getElementsByName(i,s)){t.setValue(e.id,{value:false})}t.setValue(s,{value:n})});n.addEventListener("resetform",t=>{const s=e.defaultFieldValue;t.target.checked=s!==null&&s!==undefined&&s===e.buttonValue});if(this.enableScripting&&this.hasJSActions){const i=e.buttonValue;n.addEventListener("updatefromsandbox",e=>{const n={value:e=>{const n=i===e.detail.value;for(const i of this._getElementsByName(e.target.name)){const e=n&&i.id===s;if(i.domElement){i.domElement.checked=e}t.setValue(i.id,{value:e})}}};this._dispatchEventFromSandbox(n,e)});this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],t=>t.target.checked)}this._setBackgroundColor(n);this._setDefaultPropertiesFromJS(n);this.container.append(n);return this.container}}class ih extends ie{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){const t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");const e=t.lastChild;if(this.enableScripting&&this.hasJSActions&&e){this._setDefaultPropertiesFromJS(e);e.addEventListener("updatefromsandbox",t=>{this._dispatchEventFromSandbox({},t)})}return t}}class ic extends ii{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const t=this.annotationStorage;const e=this.data.id;const s=t.getValue(e,{value:this.data.fieldValue});const i=document.createElement("select");s8.add(i);i.setAttribute("data-element-id",e);i.disabled=this.data.readOnly;this._setRequired(i,this.data.required);i.name=this.data.fieldName;i.tabIndex=s6;let n=this.data.combo&&this.data.options.length>0;if(!this.data.combo){i.size=this.data.options.length;if(this.data.multiSelect){i.multiple=true}}i.addEventListener("resetform",t=>{const e=this.data.defaultFieldValue;for(const t of i.options){t.selected=t.value===e}});for(const t of this.data.options){const e=document.createElement("option");e.textContent=t.displayValue;e.value=t.exportValue;if(s.value.includes(t.exportValue)){e.setAttribute("selected",true);n=false}i.append(e)}let r=null;if(n){const t=document.createElement("option");t.value=" ";t.setAttribute("hidden",true);t.setAttribute("selected",true);i.prepend(t);r=()=>{t.remove();i.removeEventListener("input",r);r=null};i.addEventListener("input",r)}const a=t=>{const e=t?"value":"textContent";const{options:s,multiple:n}=i;if(!n){return s.selectedIndex===-1?null:s[s.selectedIndex][e]}return Array.prototype.filter.call(s,t=>t.selected).map(t=>t[e])};let o=a(false);const l=t=>{const e=t.target.options;return Array.prototype.map.call(e,t=>({displayValue:t.textContent,exportValue:t.value}))};if(this.enableScripting&&this.hasJSActions){i.addEventListener("updatefromsandbox",s=>{const n={value(s){r?.();const n=s.detail.value;const l=new Set(Array.isArray(n)?n:[n]);for(const t of i.options){t.selected=l.has(t.value)}t.setValue(e,{value:a(true)});o=a(false)},multipleSelection(t){i.multiple=true},remove(s){const n=i.options;const r=s.detail.remove;n[r].selected=false;i.remove(r);if(n.length>0){const t=Array.prototype.findIndex.call(n,t=>t.selected);if(t===-1){n[0].selected=true}}t.setValue(e,{value:a(true),items:l(s)});o=a(false)},clear(s){while(i.length!==0){i.remove(0)}t.setValue(e,{value:null,items:[]});o=a(false)},insert(s){const{index:n,displayValue:r,exportValue:h}=s.detail.insert;const c=i.children[n];const d=document.createElement("option");d.textContent=r;d.value=h;if(c){c.before(d)}else{i.append(d)}t.setValue(e,{value:a(true),items:l(s)});o=a(false)},items(s){const{items:n}=s.detail;while(i.length!==0){i.remove(0)}for(const t of n){const{displayValue:e,exportValue:s}=t;const n=document.createElement("option");n.textContent=e;n.value=s;i.append(n)}if(i.options.length>0){i.options[0].selected=true}t.setValue(e,{value:a(true),items:l(s)});o=a(false)},indices(s){const i=new Set(s.detail.indices);for(const t of s.target.options){t.selected=i.has(t.index)}t.setValue(e,{value:a(true)});o=a(false)},editable(t){t.target.disabled=!t.detail.editable}};this._dispatchEventFromSandbox(n,s)});i.addEventListener("input",s=>{const i=a(true);const n=a(false);t.setValue(e,{value:i});s.preventDefault();this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:o,change:n,changeEx:i,willCommit:false,commitKey:1,keyDown:false}})});this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],t=>t.target.value)}else{i.addEventListener("input",function(s){t.setValue(e,{value:a(true)})})}if(this.data.combo){this._setTextStyle(i)}else{}this._setBackgroundColor(i);this._setDefaultPropertiesFromJS(i);this.container.append(i);return this.container}}class id extends it{constructor(t){const{data:e,elements:s}=t;super(t,{isRenderable:it._hasPopupData(e)});this.elements=s;this.popup=null}render(){this.container.classList.add("popupAnnotation");const t=this.popup=new iu({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open});const e=[];for(const s of this.elements){s.popup=t;s.container.ariaHasPopup="dialog";e.push(s.data.id);s.addHighlightArea()}this.container.setAttribute("aria-controls",e.map(t=>`${tb}${t}`).join(","));return this.container}}class iu{#iA=this.#iv.bind(this);#iy=this.#iw.bind(this);#i_=this.#ix.bind(this);#iE=this.#iS.bind(this);#iC=null;#tf=null;#iT=null;#iM=null;#iP=null;#iI=null;#iR=null;#ik=false;#iD=null;#C=null;#iL=null;#iF=null;#iO=null;#ic=null;#iN=false;constructor({container:t,color:e,elements:s,titleObj:i,modificationDate:n,contentsObj:r,richText:a,parent:o,rect:l,parentRect:h,open:c}){this.#tf=t;this.#iO=i;this.#iT=r;this.#iF=a;this.#iI=o;this.#iC=e;this.#iL=l;this.#iR=h;this.#iP=s;this.#iM=tF.toDateObject(n);this.trigger=s.flatMap(t=>t.getElementsToTriggerPopup());for(const t of this.trigger){t.addEventListener("click",this.#iE);t.addEventListener("mouseenter",this.#i_);t.addEventListener("mouseleave",this.#iy);t.classList.add("popupTriggerArea")}for(const t of s){t.container?.addEventListener("keydown",this.#iA)}this.#tf.hidden=true;if(c){this.#iS()}}render(){if(this.#iD){return}const t=this.#iD=document.createElement("div");t.className="popup";if(this.#iC){const e=t.style.outlineColor=ta.makeHexColor(...this.#iC);if(CSS.supports("background-color","color-mix(in srgb, red 30%, white)")){t.style.backgroundColor=`color-mix(in srgb, ${e} 30%, white)`}else{const e=.7;t.style.backgroundColor=ta.makeHexColor(...this.#iC.map(t=>Math.floor(e*(255-t)+t)))}}const e=document.createElement("span");e.className="header";const s=document.createElement("h1");e.append(s);({dir:s.dir,str:s.textContent}=this.#iO);t.append(e);if(this.#iM){const t=document.createElement("span");t.classList.add("popupDate");t.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string");t.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#iM.valueOf()}));e.append(t)}const i=this.#iB;if(i){s5.render({xfaHtml:i,intent:"richText",div:t});t.lastChild.classList.add("richText","popupContent")}else{const e=this._formatContents(this.#iT);t.append(e)}this.#tf.append(t)}get #iB(){const t=this.#iF;const e=this.#iT;if(t?.str&&(!e?.str||e.str===t.str)){return this.#iF.html||null}return null}get #iH(){return this.#iB?.attributes?.style?.fontSize||0}get #iz(){return this.#iB?.attributes?.style?.color||null}#iU(t){const e=[];const s={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:e}]}};const i={style:{color:this.#iz,fontSize:this.#iH?`calc(${this.#iH}px * var(--scale-factor))`:""}};for(const s of t.split("\n")){e.push({name:"span",value:s,attributes:i})}return s}_formatContents({str:t,dir:e}){const s=document.createElement("p");s.classList.add("popupContent");s.dir=e;const i=t.split(/(?:\r\n?|\n)/);for(let t=0,e=i.length;t<e;++t){const n=i[t];s.append(document.createTextNode(n));if(t<e-1){s.append(document.createElement("br"))}}return s}#iv(t){if(t.altKey||t.shiftKey||t.ctrlKey||t.metaKey){return}if(t.key==="Enter"||t.key==="Escape"&&this.#ik){this.#iS()}}updateEdited({rect:t,popupContent:e}){this.#ic||={contentsObj:this.#iT,richText:this.#iF};if(t){this.#C=null}if(e){this.#iF=this.#iU(e);this.#iT=null}this.#iD?.remove();this.#iD=null}resetEdited(){if(!this.#ic){return}({contentsObj:this.#iT,richText:this.#iF}=this.#ic);this.#ic=null;this.#iD?.remove();this.#iD=null;this.#C=null}#i$(){if(this.#C!==null){return}const{page:{view:t},viewport:{rawDims:{pageWidth:e,pageHeight:s,pageX:i,pageY:n}}}=this.#iI;let r=!!this.#iR;let a=r?this.#iR:this.#iL;for(const t of this.#iP){if(!a||ta.intersect(t.data.rect,a)!==null){a=t.data.rect;r=true;break}}const o=ta.normalizeRect([a[0],t[3]-a[1]+t[1],a[2],t[3]-a[3]+t[1]]);const l=5;const h=r?a[2]-a[0]+l:0;const c=o[0]+h;const d=o[1];this.#C=[100*(c-i)/e,100*(d-n)/s];const{style:u}=this.#tf;u.left=`${this.#C[0]}%`;u.top=`${this.#C[1]}%`}#iS(){this.#ik=!this.#ik;if(this.#ik){this.#ix();this.#tf.addEventListener("click",this.#iE);this.#tf.addEventListener("keydown",this.#iA)}else{this.#iw();this.#tf.removeEventListener("click",this.#iE);this.#tf.removeEventListener("keydown",this.#iA)}}#ix(){if(!this.#iD){this.render()}if(!this.isVisible){this.#i$();this.#tf.hidden=false;this.#tf.style.zIndex=parseInt(this.#tf.style.zIndex)+1e3}else if(this.#ik){this.#tf.classList.add("focused")}}#iw(){this.#tf.classList.remove("focused");if(this.#ik||!this.isVisible){return}this.#tf.hidden=true;this.#tf.style.zIndex=parseInt(this.#tf.style.zIndex)-1e3}forceHide(){this.#iN=this.isVisible;if(!this.#iN){return}this.#tf.hidden=true}maybeShow(){if(!this.#iN){return}if(!this.#iD){this.#ix()}this.#iN=false;this.#tf.hidden=false}get isVisible(){return this.#tf.hidden===false}}class ip extends it{constructor(t){super(t,{isRenderable:true,ignoreBorder:true});this.textContent=t.data.textContent;this.textPosition=t.data.textPosition;this.annotationEditorType=b.FREETEXT}render(){this.container.classList.add("freeTextAnnotation");if(this.textContent){const t=document.createElement("div");t.classList.add("annotationTextContent");t.setAttribute("role","comment");for(const e of this.textContent){const s=document.createElement("span");s.textContent=e;t.append(s)}this.container.append(t)}if(!this.data.popupRef&&this.hasPopupData){this._createPopup()}this._editOnDoubleClick();return this.container}}class ig extends it{#iG=null;constructor(t){super(t,{isRenderable:true,ignoreBorder:true})}render(){this.container.classList.add("lineAnnotation");const t=this.data;const{width:e,height:s}=s7(t.rect);const i=this.svgFactory.create(e,s,true);const n=this.#iG=this.svgFactory.createElement("svg:line");n.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]);n.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]);n.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]);n.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]);n.setAttribute("stroke-width",t.borderStyle.width||1);n.setAttribute("stroke","transparent");n.setAttribute("fill","transparent");i.append(n);this.container.append(i);if(!t.popupRef&&this.hasPopupData){this._createPopup()}return this.container}getElementsToTriggerPopup(){return this.#iG}addHighlightArea(){this.container.classList.add("highlightArea")}}class im extends it{#ij=null;constructor(t){super(t,{isRenderable:true,ignoreBorder:true})}render(){this.container.classList.add("squareAnnotation");const t=this.data;const{width:e,height:s}=s7(t.rect);const i=this.svgFactory.create(e,s,true);const n=t.borderStyle.width;const r=this.#ij=this.svgFactory.createElement("svg:rect");r.setAttribute("x",n/2);r.setAttribute("y",n/2);r.setAttribute("width",e-n);r.setAttribute("height",s-n);r.setAttribute("stroke-width",n||1);r.setAttribute("stroke","transparent");r.setAttribute("fill","transparent");i.append(r);this.container.append(i);if(!t.popupRef&&this.hasPopupData){this._createPopup()}return this.container}getElementsToTriggerPopup(){return this.#ij}addHighlightArea(){this.container.classList.add("highlightArea")}}class ib extends it{#iV=null;constructor(t){super(t,{isRenderable:true,ignoreBorder:true})}render(){this.container.classList.add("circleAnnotation");const t=this.data;const{width:e,height:s}=s7(t.rect);const i=this.svgFactory.create(e,s,true);const n=t.borderStyle.width;const r=this.#iV=this.svgFactory.createElement("svg:ellipse");r.setAttribute("cx",e/2);r.setAttribute("cy",s/2);r.setAttribute("rx",e/2-n/2);r.setAttribute("ry",s/2-n/2);r.setAttribute("stroke-width",n||1);r.setAttribute("stroke","transparent");r.setAttribute("fill","transparent");i.append(r);this.container.append(i);if(!t.popupRef&&this.hasPopupData){this._createPopup()}return this.container}getElementsToTriggerPopup(){return this.#iV}addHighlightArea(){this.container.classList.add("highlightArea")}}class iA extends it{#iW=null;constructor(t){super(t,{isRenderable:true,ignoreBorder:true});this.containerClassName="polylineAnnotation";this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:e,borderStyle:s,popupRef:i}}=this;if(!e){return this.container}const{width:n,height:r}=s7(t);const a=this.svgFactory.create(n,r,true);let o=[];for(let s=0,i=e.length;s<i;s+=2){const i=e[s]-t[0];const n=t[3]-e[s+1];o.push(`${i},${n}`)}o=o.join(" ");const l=this.#iW=this.svgFactory.createElement(this.svgElementName);l.setAttribute("points",o);l.setAttribute("stroke-width",s.width||1);l.setAttribute("stroke","transparent");l.setAttribute("fill","transparent");a.append(l);this.container.append(a);if(!i&&this.hasPopupData){this._createPopup()}return this.container}getElementsToTriggerPopup(){return this.#iW}addHighlightArea(){this.container.classList.add("highlightArea")}}class iv extends iA{constructor(t){super(t);this.containerClassName="polygonAnnotation";this.svgElementName="svg:polygon"}}class iy extends it{constructor(t){super(t,{isRenderable:true,ignoreBorder:true})}render(){this.container.classList.add("caretAnnotation");if(!this.data.popupRef&&this.hasPopupData){this._createPopup()}return this.container}}class iw extends it{#iq=null;#iK=[];constructor(t){super(t,{isRenderable:true,ignoreBorder:true});this.containerClassName="inkAnnotation";this.svgElementName="svg:polyline";this.annotationEditorType=this.data.it==="InkHighlight"?b.HIGHLIGHT:b.INK}#iX(t,e){switch(t){case 90:return{transform:`rotate(90) translate(${-e[0]},${e[1]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};case 180:return{transform:`rotate(180) translate(${-e[2]},${e[1]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]};case 270:return{transform:`rotate(270) translate(${-e[2]},${e[3]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};default:return{transform:`translate(${-e[0]},${e[3]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]}}}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:e,inkLists:s,borderStyle:i,popupRef:n}}=this;const{transform:r,width:a,height:o}=this.#iX(e,t);const l=this.svgFactory.create(a,o,true);const h=this.#iq=this.svgFactory.createElement("svg:g");l.append(h);h.setAttribute("stroke-width",i.width||1);h.setAttribute("stroke-linecap","round");h.setAttribute("stroke-linejoin","round");h.setAttribute("stroke-miterlimit",10);h.setAttribute("stroke","transparent");h.setAttribute("fill","transparent");h.setAttribute("transform",r);for(let t=0,e=s.length;t<e;t++){const e=this.svgFactory.createElement(this.svgElementName);this.#iK.push(e);e.setAttribute("points",s[t].join(","));h.append(e)}if(!n&&this.hasPopupData){this._createPopup()}this.container.append(l);this._editOnDoubleClick();return this.container}updateEdited(t){super.updateEdited(t);const{thickness:e,points:s,rect:i}=t;const n=this.#iq;if(e>=0){n.setAttribute("stroke-width",e||1)}if(s){for(let t=0,e=this.#iK.length;t<e;t++){this.#iK[t].setAttribute("points",s[t].join(","))}}if(i){const{transform:t,width:e,height:s}=this.#iX(this.data.rotation,i);const r=n.parentElement;r.setAttribute("viewBox",`0 0 ${e} ${s}`);n.setAttribute("transform",t)}}getElementsToTriggerPopup(){return this.#iK}addHighlightArea(){this.container.classList.add("highlightArea")}}class i_ extends it{constructor(t){super(t,{isRenderable:true,ignoreBorder:true,createQuadrilaterals:true});this.annotationEditorType=b.HIGHLIGHT}render(){if(!this.data.popupRef&&this.hasPopupData){this._createPopup()}this.container.classList.add("highlightAnnotation");this._editOnDoubleClick();return this.container}}class ix extends it{constructor(t){super(t,{isRenderable:true,ignoreBorder:true,createQuadrilaterals:true})}render(){if(!this.data.popupRef&&this.hasPopupData){this._createPopup()}this.container.classList.add("underlineAnnotation");return this.container}}class iE extends it{constructor(t){super(t,{isRenderable:true,ignoreBorder:true,createQuadrilaterals:true})}render(){if(!this.data.popupRef&&this.hasPopupData){this._createPopup()}this.container.classList.add("squigglyAnnotation");return this.container}}class iS extends it{constructor(t){super(t,{isRenderable:true,ignoreBorder:true,createQuadrilaterals:true})}render(){if(!this.data.popupRef&&this.hasPopupData){this._createPopup()}this.container.classList.add("strikeoutAnnotation");return this.container}}class iC extends it{constructor(t){super(t,{isRenderable:true,ignoreBorder:true});this.annotationEditorType=b.STAMP}render(){this.container.classList.add("stampAnnotation");this.container.setAttribute("role","img");if(!this.data.popupRef&&this.hasPopupData){this._createPopup()}this._editOnDoubleClick();return this.container}}class iT extends it{#iY=null;constructor(t){super(t,{isRenderable:true});const{file:e}=this.data;this.filename=e.filename;this.content=e.content;this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...e})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:e}=this;let s;if(e.hasAppearance||e.fillAlpha===0){s=document.createElement("div")}else{s=document.createElement("img");s.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(e.name)?"paperclip":"pushpin"}.svg`;if(e.fillAlpha&&e.fillAlpha<1){s.style=`filter: opacity(${Math.round(e.fillAlpha*100)}%);`}}s.addEventListener("dblclick",this.#iQ.bind(this));this.#iY=s;const{isMac:i}=tn.platform;t.addEventListener("keydown",t=>{if(t.key==="Enter"&&(i?t.metaKey:t.ctrlKey)){this.#iQ()}});if(!e.popupRef&&this.hasPopupData){this._createPopup()}else{s.classList.add("popupTriggerArea")}t.append(s);return t}getElementsToTriggerPopup(){return this.#iY}addHighlightArea(){this.container.classList.add("highlightArea")}#iQ(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class iM{#iJ=null;#iZ=null;#i0=new Map;#i1=null;constructor({div:t,accessibilityManager:e,annotationCanvasMap:s,annotationEditorUIManager:i,page:n,viewport:r,structTreeLayer:a}){this.div=t;this.#iJ=e;this.#iZ=s;this.#i1=a||null;this.page=n;this.viewport=r;this.zIndex=0;this._annotationEditorUIManager=i}hasEditableAnnotations(){return this.#i0.size>0}async #i2(t,e){const s=t.firstChild||t;const i=s.id=`${tb}${e}`;const n=await this.#i1?.getAriaAttributes(i);if(n){for(const[t,e]of n){s.setAttribute(t,e)}}this.div.append(t);this.#iJ?.moveElementInDOM(this.div,t,s,false)}async render(t){const{annotations:e}=t;const s=this.div;tU(s,this.viewport);const i=new Map;const n={data:null,layer:s,linkService:t.linkService,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:t.renderForms!==false,svgFactory:new s3,annotationStorage:t.annotationStorage||new t7,enableScripting:t.enableScripting===true,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(const t of e){if(t.noHTML){continue}const e=t.annotationType===_.POPUP;if(!e){const{width:e,height:s}=s7(t.rect);if(e<=0||s<=0){continue}}else{const e=i.get(t.id);if(!e){continue}n.elements=e}n.data=t;const s=s9.create(n);if(!s.isRenderable){continue}if(!e&&t.popupRef){const e=i.get(t.popupRef);if(!e){i.set(t.popupRef,[s])}else{e.push(s)}}const r=s.render();if(t.hidden){r.style.visibility="hidden"}await this.#i2(r,t.id);if(s._isEditable){this.#i0.set(s.data.id,s);this._annotationEditorUIManager?.renderAnnotationElement(s)}}this.#i3()}update({viewport:t}){const e=this.div;this.viewport=t;tU(e,{rotation:t.rotation});this.#i3();e.hidden=false}#i3(){if(!this.#iZ){return}const t=this.div;for(const[e,s]of this.#iZ){const i=t.querySelector(`[data-annotation-id="${e}"]`);if(!i){continue}s.className="annotationContent";const{firstChild:n}=i;if(!n){i.append(s)}else if(n.nodeName==="CANVAS"){n.replaceWith(s)}else if(!n.classList.contains("annotationContent")){n.before(s)}else{n.after(s)}}this.#iZ.clear()}getEditableAnnotations(){return Array.from(this.#i0.values())}getEditableAnnotation(t){return this.#i0.get(t)}};const iP=/\r\n?|\n/g;class iI extends t1{#iC;#i5="";#i6=`${this.id}-editor`;#i4=null;#iH;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const t=iI.prototype;const e=t=>t.isEmpty();const s=tJ.TRANSLATE_SMALL;const i=tJ.TRANSLATE_BIG;return $(this,"_keyboardManager",new tY([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:true}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-s,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[s,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[i,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-s],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:e}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,s],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,i],checker:e}]]))}static _type="freetext";static _editorType=b.FREETEXT;constructor(t){super({...t,name:"freeTextEditor"});this.#iC=t.color||iI._defaultColor||t1._defaultLineColor;this.#iH=t.fontSize||iI._defaultFontSize}static initialize(t,e){t1.initialize(t,e);const s=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(s.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,e){switch(t){case A.FREETEXT_SIZE:iI._defaultFontSize=e;break;case A.FREETEXT_COLOR:iI._defaultColor=e;break}}updateParams(t,e){switch(t){case A.FREETEXT_SIZE:this.#i8(e);break;case A.FREETEXT_COLOR:this.#i7(e);break}}static get defaultPropertiesToUpdate(){return[[A.FREETEXT_SIZE,iI._defaultFontSize],[A.FREETEXT_COLOR,iI._defaultColor||t1._defaultLineColor]]}get propertiesToUpdate(){return[[A.FREETEXT_SIZE,this.#iH],[A.FREETEXT_COLOR,this.#iC]]}#i8(t){const e=t=>{this.editorDiv.style.fontSize=`calc(${t}px * var(--scale-factor))`;this.translate(0,-(t-this.#iH)*this.parentScale);this.#iH=t;this.#i9()};const s=this.#iH;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:true,type:A.FREETEXT_SIZE,overwriteIfSameType:true,keepUndo:true})}#i7(t){const e=t=>{this.#iC=this.editorDiv.style.color=t};const s=this.#iC;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:true,type:A.FREETEXT_COLOR,overwriteIfSameType:true,keepUndo:true})}_translateEmpty(t,e){this._uiManager.translateSelectedEditors(t,e,true)}getInitialTranslation(){const t=this.parentScale;return[-iI._internalPadding*t,-(iI._internalPadding+this.#iH)*t]}rebuild(){if(!this.parent){return}super.rebuild();if(this.div===null){return}if(!this.isAttachedToDOM){this.parent.add(this)}}enableEditMode(){if(this.isInEditMode()){return}this.parent.setEditingState(false);this.parent.updateToolbar(b.FREETEXT);super.enableEditMode();this.overlayDiv.classList.remove("enabled");this.editorDiv.contentEditable=true;this._isDraggable=false;this.div.removeAttribute("aria-activedescendant");this.#i4=new AbortController;const t=this._uiManager.combinedSignal(this.#i4);this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t});this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t});this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t});this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t});this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t})}disableEditMode(){if(!this.isInEditMode()){return}this.parent.setEditingState(true);super.disableEditMode();this.overlayDiv.classList.add("enabled");this.editorDiv.contentEditable=false;this.div.setAttribute("aria-activedescendant",this.#i6);this._isDraggable=true;this.#i4?.abort();this.#i4=null;this.div.focus({preventScroll:true});this.isEditing=false;this.parent.div.classList.add("freetextEditing")}focusin(t){if(!this._focusEventsAllowed){return}super.focusin(t);if(t.target!==this.editorDiv){this.editorDiv.focus()}}onceAdded(t){if(this.width){return}this.enableEditMode();if(t){this.editorDiv.focus()}if(this._initialOptions?.isCentered){this.center()}this._initialOptions=null}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=false;if(this.parent){this.parent.setEditingState(true);this.parent.div.classList.add("freetextEditing")}super.remove()}#nt(){const t=[];this.editorDiv.normalize();let e=null;for(const s of this.editorDiv.childNodes){if(e?.nodeType===Node.TEXT_NODE&&s.nodeName==="BR"){continue}t.push(iI.#ne(s));e=s}return t.join("\n")}#i9(){const[t,e]=this.parentDimensions;let s;if(this.isAttachedToDOM){s=this.div.getBoundingClientRect()}else{const{currentLayer:t,div:e}=this;const i=e.style.display;const n=e.classList.contains("hidden");e.classList.remove("hidden");e.style.display="hidden";t.div.append(this.div);s=e.getBoundingClientRect();e.remove();e.style.display=i;e.classList.toggle("hidden",n)}if(this.rotation%180===this.parentRotation%180){this.width=s.width/t;this.height=s.height/e}else{this.width=s.height/t;this.height=s.width/e}this.fixAndSetPosition()}commit(){if(!this.isInEditMode()){return}super.commit();this.disableEditMode();const t=this.#i5;const e=this.#i5=this.#nt().trimEnd();if(t===e){return}const s=t=>{this.#i5=t;if(!t){this.remove();return}this.#ns();this._uiManager.rebuild(this);this.#i9()};this.addCommands({cmd:()=>{s(e)},undo:()=>{s(t)},mustExec:false});this.#i9()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode();this.editorDiv.focus()}dblclick(t){this.enterInEditMode()}keydown(t){if(t.target===this.div&&t.key==="Enter"){this.enterInEditMode();t.preventDefault()}}editorDivKeydown(t){iI._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=true}editorDivBlur(t){this.isEditing=false}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment");this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox");this.editorDiv.setAttribute("aria-multiline",true)}render(){if(this.div){return this.div}let t,e;if(this.width){t=this.x;e=this.y}super.render();this.editorDiv=document.createElement("div");this.editorDiv.className="internal";this.editorDiv.setAttribute("id",this.#i6);this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2");this.editorDiv.setAttribute("data-l10n-attrs","default-content");this.enableEditing();this.editorDiv.contentEditable=true;const{style:s}=this.editorDiv;s.fontSize=`calc(${this.#iH}px * var(--scale-factor))`;s.color=this.#iC;this.div.append(this.editorDiv);this.overlayDiv=document.createElement("div");this.overlayDiv.classList.add("overlay","enabled");this.div.append(this.overlayDiv);tV(this,this.div,["dblclick","keydown"]);if(this.width){const[s,i]=this.parentDimensions;if(this.annotationElementId){const{position:n}=this._initialData;let[r,a]=this.getInitialTranslation();[r,a]=this.pageTranslationToScreen(r,a);const[o,l]=this.pageDimensions;const[h,c]=this.pageTranslation;let d,u;switch(this.rotation){case 0:d=t+(n[0]-h)/o;u=e+this.height-(n[1]-c)/l;break;case 90:d=t+(n[0]-h)/o;u=e-(n[1]-c)/l;[r,a]=[a,-r];break;case 180:d=t-this.width+(n[0]-h)/o;u=e-(n[1]-c)/l;[r,a]=[-r,-a];break;case 270:d=t+(n[0]-h-this.height*l)/o;u=e+(n[1]-c-this.width*o)/l;[r,a]=[-a,r];break}this.setAt(d*s,u*i,r,a)}else{this.setAt(t*s,e*i,this.width*s,this.height*i)}this.#ns();this._isDraggable=true;this.editorDiv.contentEditable=false}else{this._isDraggable=false;this.editorDiv.contentEditable=true}return this.div}static #ne(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(iP,"")}editorDivPaste(t){const e=t.clipboardData||window.clipboardData;const{types:s}=e;if(s.length===1&&s[0]==="text/plain"){return}t.preventDefault();const i=iI.#ni(e.getData("text")||"").replaceAll(iP,"\n");if(!i){return}const n=window.getSelection();if(!n.rangeCount){return}this.editorDiv.normalize();n.deleteFromDocument();const r=n.getRangeAt(0);if(!i.includes("\n")){r.insertNode(document.createTextNode(i));this.editorDiv.normalize();n.collapseToStart();return}const{startContainer:a,startOffset:o}=r;const l=[];const h=[];if(a.nodeType===Node.TEXT_NODE){const t=a.parentElement;h.push(a.nodeValue.slice(o).replaceAll(iP,""));if(t!==this.editorDiv){let e=l;for(const s of this.editorDiv.childNodes){if(s===t){e=h;continue}e.push(iI.#ne(s))}}l.push(a.nodeValue.slice(0,o).replaceAll(iP,""))}else if(a===this.editorDiv){let t=l;let e=0;for(const s of this.editorDiv.childNodes){if(e++===o){t=h}t.push(iI.#ne(s))}}this.#i5=`${l.join("\n")}${i}${h.join("\n")}`;this.#ns();const c=new Range;let d=l.reduce((t,e)=>t+e.length,0);for(const{firstChild:t}of this.editorDiv.childNodes){if(t.nodeType===Node.TEXT_NODE){const e=t.nodeValue.length;if(d<=e){c.setStart(t,d);c.setEnd(t,d);break}d-=e}}n.removeAllRanges();n.addRange(c)}#ns(){this.editorDiv.replaceChildren();if(!this.#i5){return}for(const t of this.#i5.split("\n")){const e=document.createElement("div");e.append(t?document.createTextNode(t):document.createElement("br"));this.editorDiv.append(e)}}#nn(){return this.#i5.replaceAll("\xa0"," ")}static #ni(t){return t.replaceAll(" ","\xa0")}get contentDiv(){return this.editorDiv}static async deserialize(t,e,s){let i=null;if(t instanceof ip){const{data:{defaultAppearanceData:{fontSize:e,fontColor:s},rect:n,rotation:r,id:a,popupRef:o},textContent:l,textPosition:h,parent:{page:{pageNumber:c}}}=t;if(!l||l.length===0){return null}i=t={annotationType:b.FREETEXT,color:Array.from(s),fontSize:e,value:l.join("\n"),position:h,pageIndex:c-1,rect:n.slice(0),rotation:r,id:a,deleted:false,popupRef:o}}const n=await super.deserialize(t,e,s);n.#iH=t.fontSize;n.#iC=ta.makeHexColor(...t.color);n.#i5=iI.#ni(t.value);n.annotationElementId=t.id||null;n._initialData=i;return n}serialize(t=false){if(this.isEmpty()){return null}if(this.deleted){return this.serializeDeleted()}const e=iI._internalPadding*this.parentScale;const s=this.getRect(e,e);const i=t1._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#iC);const n={annotationType:b.FREETEXT,color:i,fontSize:this.#iH,value:this.#nn(),pageIndex:this.pageIndex,rect:s,rotation:this.rotation,structTreeParentId:this._structTreeParentId};if(t){return n}if(this.annotationElementId&&!this.#nr(n)){return null}n.id=this.annotationElementId;return n}#nr(t){const{value:e,fontSize:s,color:i,pageIndex:n}=this._initialData;return this._hasBeenMoved||t.value!==e||t.fontSize!==s||t.color.some((t,e)=>t!==i[e])||t.pageIndex!==n}renderAnnotationElement(t){const e=super.renderAnnotationElement(t);if(this.deleted){return e}const{style:s}=e;s.fontSize=`calc(${this.#iH}px * var(--scale-factor))`;s.color=this.#iC;e.replaceChildren();for(const t of this.#i5.split("\n")){const s=document.createElement("div");s.append(t?document.createTextNode(t):document.createElement("br"));e.append(s)}const i=iI._internalPadding*this.parentScale;t.updateEdited({rect:this.getRect(i,i),popupContent:this.#i5});return e}resetAnnotationElement(t){super.resetAnnotationElement(t);t.resetEdited()}};class iR{static PRECISION=1e-4;toSVGPath(){B("Abstract method `toSVGPath` must be implemented.")}get box(){B("Abstract getter `box` must be implemented.")}serialize(t,e){B("Abstract method `serialize` must be implemented.")}static _rescale(t,e,s,i,n,r){r||=new Float32Array(t.length);for(let a=0,o=t.length;a<o;a+=2){r[a]=e+t[a]*i;r[a+1]=s+t[a+1]*n}return r}static _rescaleAndSwap(t,e,s,i,n,r){r||=new Float32Array(t.length);for(let a=0,o=t.length;a<o;a+=2){r[a]=e+t[a+1]*i;r[a+1]=s+t[a]*n}return r}static _translate(t,e,s,i){i||=new Float32Array(t.length);for(let n=0,r=t.length;n<r;n+=2){i[n]=e+t[n];i[n+1]=s+t[n+1]}return i}static svgRound(t){return Math.round(t*1e4)}static _normalizePoint(t,e,s,i,n){switch(n){case 90:return[1-e/s,t/i];case 180:return[1-t/s,1-e/i];case 270:return[e/s,1-t/i];default:return[t/s,e/i]}}static _normalizePagePoint(t,e,s){switch(s){case 90:return[1-e,t];case 180:return[1-t,1-e];case 270:return[e,1-t];default:return[t,e]}}static createBezierPoints(t,e,s,i,n,r){return[(t+5*s)/6,(e+5*i)/6,(5*s+n)/6,(5*i+r)/6,(s+n)/2,(i+r)/2]}};class ik{#na;#no=[];#nl;#nh;#nc=[];#nd=new Float32Array(18);#nu;#nf;#np;#ng;#nm;#nb;#nA=[];static #nv=8;static #ny=2;static #nw=ik.#nv+ik.#ny;constructor({x:t,y:e},s,i,n,r,a=0){this.#na=s;this.#nb=n*i;this.#nh=r;this.#nd.set([NaN,NaN,NaN,NaN,t,e],6);this.#nl=a;this.#ng=ik.#nv*i;this.#np=ik.#nw*i;this.#nm=i;this.#nA.push(t,e)}isEmpty(){return isNaN(this.#nd[8])}#n_(){const t=this.#nd.subarray(4,6);const e=this.#nd.subarray(16,18);const[s,i,n,r]=this.#na;return[(this.#nu+(t[0]-e[0])/2-s)/n,(this.#nf+(t[1]-e[1])/2-i)/r,(this.#nu+(e[0]-t[0])/2-s)/n,(this.#nf+(e[1]-t[1])/2-i)/r]}add({x:t,y:e}){this.#nu=t;this.#nf=e;const[s,i,n,r]=this.#na;let[a,o,l,h]=this.#nd.subarray(8,12);const c=t-l;const d=e-h;const u=Math.hypot(c,d);if(u<this.#np){return false}const f=u-this.#ng;const p=f/u;const g=p*c;const m=p*d;let b=a;let A=o;a=l;o=h;l+=g;h+=m;this.#nA?.push(t,e);const v=-m/f;const y=g/f;const w=v*this.#nb;const _=y*this.#nb;this.#nd.set(this.#nd.subarray(2,8),0);this.#nd.set([l+w,h+_],4);this.#nd.set(this.#nd.subarray(14,18),12);this.#nd.set([l-w,h-_],16);if(isNaN(this.#nd[6])){if(this.#nc.length===0){this.#nd.set([a+w,o+_],2);this.#nc.push(NaN,NaN,NaN,NaN,(a+w-s)/n,(o+_-i)/r);this.#nd.set([a-w,o-_],14);this.#no.push(NaN,NaN,NaN,NaN,(a-w-s)/n,(o-_-i)/r)}this.#nd.set([b,A,a,o,l,h],6);return!this.isEmpty()}this.#nd.set([b,A,a,o,l,h],6);const x=Math.abs(Math.atan2(A-o,b-a)-Math.atan2(m,g));if(x<Math.PI/2){[a,o,l,h]=this.#nd.subarray(2,6);this.#nc.push(NaN,NaN,NaN,NaN,((a+l)/2-s)/n,((o+h)/2-i)/r);[a,o,b,A]=this.#nd.subarray(14,18);this.#no.push(NaN,NaN,NaN,NaN,((b+a)/2-s)/n,((A+o)/2-i)/r);return true}[b,A,a,o,l,h]=this.#nd.subarray(0,6);this.#nc.push(((b+5*a)/6-s)/n,((A+5*o)/6-i)/r,((5*a+l)/6-s)/n,((5*o+h)/6-i)/r,((a+l)/2-s)/n,((o+h)/2-i)/r);[l,h,a,o,b,A]=this.#nd.subarray(12,18);this.#no.push(((b+5*a)/6-s)/n,((A+5*o)/6-i)/r,((5*a+l)/6-s)/n,((5*o+h)/6-i)/r,((a+l)/2-s)/n,((o+h)/2-i)/r);return true}toSVGPath(){if(this.isEmpty()){return""}const t=this.#nc;const e=this.#no;if(isNaN(this.#nd[6])&&!this.isEmpty()){return this.#nx()}const s=[];s.push(`M${t[4]} ${t[5]}`);for(let e=6;e<t.length;e+=6){if(isNaN(t[e])){s.push(`L${t[e+4]} ${t[e+5]}`)}else{s.push(`C${t[e]} ${t[e+1]} ${t[e+2]} ${t[e+3]} ${t[e+4]} ${t[e+5]}`)}}this.#nE(s);for(let t=e.length-6;t>=6;t-=6){if(isNaN(e[t])){s.push(`L${e[t+4]} ${e[t+5]}`)}else{s.push(`C${e[t]} ${e[t+1]} ${e[t+2]} ${e[t+3]} ${e[t+4]} ${e[t+5]}`)}}this.#nS(s);return s.join(" ")}#nx(){const[t,e,s,i]=this.#na;const[n,r,a,o]=this.#n_();return`M${(this.#nd[2]-t)/s} ${(this.#nd[3]-e)/i} L${(this.#nd[4]-t)/s} ${(this.#nd[5]-e)/i} L${n} ${r} L${a} ${o} L${(this.#nd[16]-t)/s} ${(this.#nd[17]-e)/i} L${(this.#nd[14]-t)/s} ${(this.#nd[15]-e)/i} Z`}#nS(t){const e=this.#no;t.push(`L${e[4]} ${e[5]} Z`)}#nE(t){const[e,s,i,n]=this.#na;const r=this.#nd.subarray(4,6);const a=this.#nd.subarray(16,18);const[o,l,h,c]=this.#n_();t.push(`L${(r[0]-e)/i} ${(r[1]-s)/n} L${o} ${l} L${h} ${c} L${(a[0]-e)/i} ${(a[1]-s)/n}`)}newFreeDrawOutline(t,e,s,i,n,r){return new iD(t,e,s,i,n,r)}getOutlines(){const t=this.#nc;const e=this.#no;const s=this.#nd;const[i,n,r,a]=this.#na;const o=new Float32Array((this.#nA?.length??0)+2);for(let t=0,e=o.length-2;t<e;t+=2){o[t]=(this.#nA[t]-i)/r;o[t+1]=(this.#nA[t+1]-n)/a}o[o.length-2]=(this.#nu-i)/r;o[o.length-1]=(this.#nf-n)/a;if(isNaN(s[6])&&!this.isEmpty()){return this.#nC(o)}const l=new Float32Array(this.#nc.length+24+this.#no.length);let h=t.length;for(let e=0;e<h;e+=2){if(isNaN(t[e])){l[e]=l[e+1]=NaN;continue}l[e]=t[e];l[e+1]=t[e+1]}h=this.#nT(l,h);for(let t=e.length-6;t>=6;t-=6){for(let s=0;s<6;s+=2){if(isNaN(e[t+s])){l[h]=l[h+1]=NaN;h+=2;continue}l[h]=e[t+s];l[h+1]=e[t+s+1];h+=2}}this.#nM(l,h);return this.newFreeDrawOutline(l,o,this.#na,this.#nm,this.#nl,this.#nh)}#nC(t){const e=this.#nd;const[s,i,n,r]=this.#na;const[a,o,l,h]=this.#n_();const c=new Float32Array(36);c.set([NaN,NaN,NaN,NaN,(e[2]-s)/n,(e[3]-i)/r,NaN,NaN,NaN,NaN,(e[4]-s)/n,(e[5]-i)/r,NaN,NaN,NaN,NaN,a,o,NaN,NaN,NaN,NaN,l,h,NaN,NaN,NaN,NaN,(e[16]-s)/n,(e[17]-i)/r,NaN,NaN,NaN,NaN,(e[14]-s)/n,(e[15]-i)/r],0);return this.newFreeDrawOutline(c,t,this.#na,this.#nm,this.#nl,this.#nh)}#nM(t,e){const s=this.#no;t.set([NaN,NaN,NaN,NaN,s[4],s[5]],e);return e+=6}#nT(t,e){const s=this.#nd.subarray(4,6);const i=this.#nd.subarray(16,18);const[n,r,a,o]=this.#na;const[l,h,c,d]=this.#n_();t.set([NaN,NaN,NaN,NaN,(s[0]-n)/a,(s[1]-r)/o,NaN,NaN,NaN,NaN,l,h,NaN,NaN,NaN,NaN,c,d,NaN,NaN,NaN,NaN,(i[0]-n)/a,(i[1]-r)/o],e);return e+=24}}class iD extends iR{#na;#nP=new Float32Array(4);#nl;#nh;#nA;#nm;#nI;constructor(t,e,s,i,n,r){super();this.#nI=t;this.#nA=e;this.#na=s;this.#nm=i;this.#nl=n;this.#nh=r;this.lastPoint=[NaN,NaN];this.#nR(r);const[a,o,l,h]=this.#nP;for(let e=0,s=t.length;e<s;e+=2){t[e]=(t[e]-a)/l;t[e+1]=(t[e+1]-o)/h}for(let t=0,s=e.length;t<s;t+=2){e[t]=(e[t]-a)/l;e[t+1]=(e[t+1]-o)/h}}toSVGPath(){const t=[`M${this.#nI[4]} ${this.#nI[5]}`];for(let e=6,s=this.#nI.length;e<s;e+=6){if(isNaN(this.#nI[e])){t.push(`L${this.#nI[e+4]} ${this.#nI[e+5]}`);continue}t.push(`C${this.#nI[e]} ${this.#nI[e+1]} ${this.#nI[e+2]} ${this.#nI[e+3]} ${this.#nI[e+4]} ${this.#nI[e+5]}`)}t.push("Z");return t.join(" ")}serialize([t,e,s,i],n){const r=s-t;const a=i-e;let o;let l;switch(n){case 0:o=iR._rescale(this.#nI,t,i,r,-a);l=iR._rescale(this.#nA,t,i,r,-a);break;case 90:o=iR._rescaleAndSwap(this.#nI,t,e,r,a);l=iR._rescaleAndSwap(this.#nA,t,e,r,a);break;case 180:o=iR._rescale(this.#nI,s,e,-r,a);l=iR._rescale(this.#nA,s,e,-r,a);break;case 270:o=iR._rescaleAndSwap(this.#nI,s,i,-r,-a);l=iR._rescaleAndSwap(this.#nA,s,i,-r,-a);break}return{outline:Array.from(o),points:[Array.from(l)]}}#nR(t){const e=this.#nI;let s=e[4];let i=e[5];let n=s;let r=i;let a=s;let o=i;let l=s;let h=i;const c=t?Math.max:Math.min;for(let t=6,d=e.length;t<d;t+=6){if(isNaN(e[t])){n=Math.min(n,e[t+4]);r=Math.min(r,e[t+5]);a=Math.max(a,e[t+4]);o=Math.max(o,e[t+5]);if(h<e[t+5]){l=e[t+4];h=e[t+5]}else if(h===e[t+5]){l=c(l,e[t+4])}}else{const d=ta.bezierBoundingBox(s,i,...e.slice(t,t+6));n=Math.min(n,d[0]);r=Math.min(r,d[1]);a=Math.max(a,d[2]);o=Math.max(o,d[3]);if(h<d[3]){l=d[2];h=d[3]}else if(h===d[3]){l=c(l,d[2])}}s=e[t+4];i=e[t+5]}const d=this.#nP;d[0]=n-this.#nl;d[1]=r-this.#nl;d[2]=a-n+2*this.#nl;d[3]=o-r+2*this.#nl;this.lastPoint=[l,h]}get box(){return this.#nP}newOutliner(t,e,s,i,n,r=0){return new ik(t,e,s,i,n,r)}getNewOutline(t,e){const[s,i,n,r]=this.#nP;const[a,o,l,h]=this.#na;const c=n*l;const d=r*h;const u=s*l+a;const f=i*h+o;const p=this.newOutliner({x:this.#nA[0]*c+u,y:this.#nA[1]*d+f},this.#na,this.#nm,t,this.#nh,e??this.#nl);for(let t=2;t<this.#nA.length;t+=2){p.add({x:this.#nA[t]*c+u,y:this.#nA[t+1]*d+f})}return p.getOutlines()}};class iL{#na;#nk;#nD=[];#nL=[];constructor(t,e=0,s=0,i=true){let n=Infinity;let r=-Infinity;let a=Infinity;let o=-Infinity;const l=4;const h=10**-l;for(const{x:s,y:i,width:l,height:c}of t){const t=Math.floor((s-e)/h)*h;const d=Math.ceil((s+l+e)/h)*h;const u=Math.floor((i-e)/h)*h;const f=Math.ceil((i+c+e)/h)*h;const p=[t,u,f,true];const g=[d,u,f,false];this.#nD.push(p,g);n=Math.min(n,t);r=Math.max(r,d);a=Math.min(a,u);o=Math.max(o,f)}const c=r-n+2*s;const d=o-a+2*s;const u=n-s;const f=a-s;const p=this.#nD.at(i?-1:-2);const g=[p[0],p[2]];for(const t of this.#nD){const[e,s,i]=t;t[0]=(e-u)/c;t[1]=(s-f)/d;t[2]=(i-f)/d}this.#na=new Float32Array([u,f,c,d]);this.#nk=g}getOutlines(){this.#nD.sort((t,e)=>t[0]-e[0]||t[1]-e[1]||t[2]-e[2]);const t=[];for(const e of this.#nD){if(e[3]){t.push(...this.#nF(e));this.#nO(e)}else{this.#nN(e);t.push(...this.#nF(e))}}return this.#nB(t)}#nB(t){const e=[];const s=new Set;for(const s of t){const[t,i,n]=s;e.push([t,i,s],[t,n,s])}e.sort((t,e)=>t[1]-e[1]||t[0]-e[0]);for(let t=0,i=e.length;t<i;t+=2){const i=e[t][2];const n=e[t+1][2];i.push(n);n.push(i);s.add(i);s.add(n)}const i=[];let n;while(s.size>0){const t=s.values().next().value;let[e,r,a,o,l]=t;s.delete(t);let h=e;let c=r;n=[e,a];i.push(n);while(true){let t;if(s.has(o)){t=o}else if(s.has(l)){t=l}else{break}s.delete(t);[e,r,a,o,l]=t;if(h!==e){n.push(h,c,e,c===r?r:a);h=e}c=c===r?a:r}n.push(h,c)}return new iF(i,this.#na,this.#nk)}#nH(t){const e=this.#nL;let s=0;let i=e.length-1;while(s<=i){const n=s+i>>1;const r=e[n][0];if(r===t){return n}if(r<t){s=n+1}else{i=n-1}}return i+1}#nO([,t,e]){const s=this.#nH(t);this.#nL.splice(s,0,[t,e])}#nN([,t,e]){const s=this.#nH(t);for(let i=s;i<this.#nL.length;i++){const[s,n]=this.#nL[i];if(s!==t){break}if(s===t&&n===e){this.#nL.splice(i,1);return}}for(let i=s-1;i>=0;i--){const[s,n]=this.#nL[i];if(s!==t){break}if(s===t&&n===e){this.#nL.splice(i,1);return}}}#nF(t){const[e,s,i]=t;const n=[[e,s,i]];const r=this.#nH(i);for(let t=0;t<r;t++){const[s,i]=this.#nL[t];for(let t=0,r=n.length;t<r;t++){const[,a,o]=n[t];if(i<=a||o<=s){continue}if(a>=s){if(o>i){n[t][1]=i}else{if(r===1){return[]}n.splice(t,1);t--;r--}continue}n[t][2]=s;if(o>i){n.push([e,i,o])}}}return n}}class iF extends iR{#na;#nz;constructor(t,e,s){super();this.#nz=t;this.#na=e;this.lastPoint=s}toSVGPath(){const t=[];for(const e of this.#nz){let[s,i]=e;t.push(`M${s} ${i}`);for(let n=2;n<e.length;n+=2){const r=e[n];const a=e[n+1];if(r===s){t.push(`V${a}`);i=a}else if(a===i){t.push(`H${r}`);s=r}}t.push("Z")}return t.join(" ")}serialize([t,e,s,i],n){const r=[];const a=s-t;const o=i-e;for(const e of this.#nz){const s=new Array(e.length);for(let n=0;n<e.length;n+=2){s[n]=t+e[n]*a;s[n+1]=i-e[n+1]*o}r.push(s)}return r}get box(){return this.#na}get classNamesForOutlining(){return["highlightOutline"]}}class iO extends ik{newFreeDrawOutline(t,e,s,i,n,r){return new iN(t,e,s,i,n,r)}}class iN extends iD{newOutliner(t,e,s,i,n,r=0){return new iO(t,e,s,i,n,r)}};class iB{#nU=null;#n$=null;#nG;#nj=null;#nV=false;#nW=false;#r=null;#nq;#nK=null;#g=null;#nX;static #nY=null;static get _keyboardManager(){return $(this,"_keyboardManager",new tY([[["Escape","mac+Escape"],iB.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],iB.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],iB.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],iB.prototype._moveToPrevious],[["Home","mac+Home"],iB.prototype._moveToBeginning],[["End","mac+End"],iB.prototype._moveToEnd]]))}constructor({editor:t=null,uiManager:e=null}){if(t){this.#nW=false;this.#nX=A.HIGHLIGHT_COLOR;this.#r=t}else{this.#nW=true;this.#nX=A.HIGHLIGHT_DEFAULT_COLOR}this.#g=t?._uiManager||e;this.#nq=this.#g._eventBus;this.#nG=t?.color||this.#g?.highlightColors.values().next().value||"#FFFF98";iB.#nY||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const t=this.#nU=document.createElement("button");t.className="colorPicker";t.tabIndex="0";t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button");t.setAttribute("aria-haspopup",true);const e=this.#g._signal;t.addEventListener("click",this.#nQ.bind(this),{signal:e});t.addEventListener("keydown",this.#iv.bind(this),{signal:e});const s=this.#n$=document.createElement("span");s.className="swatch";s.setAttribute("aria-hidden",true);s.style.backgroundColor=this.#nG;t.append(s);return t}renderMainDropdown(){const t=this.#nj=this.#nJ();t.setAttribute("aria-orientation","horizontal");t.setAttribute("aria-labelledby","highlightColorPickerLabel");return t}#nJ(){const t=document.createElement("div");const e=this.#g._signal;t.addEventListener("contextmenu",tk,{signal:e});t.className="dropdown";t.role="listbox";t.setAttribute("aria-multiselectable",false);t.setAttribute("aria-orientation","vertical");t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[s,i]of this.#g.highlightColors){const n=document.createElement("button");n.tabIndex="0";n.role="option";n.setAttribute("data-color",i);n.title=s;n.setAttribute("data-l10n-id",iB.#nY[s]);const r=document.createElement("span");n.append(r);r.className="swatch";r.style.backgroundColor=i;n.setAttribute("aria-selected",i===this.#nG);n.addEventListener("click",this.#nZ.bind(this,i),{signal:e});t.append(n)}t.addEventListener("keydown",this.#iv.bind(this),{signal:e});return t}#nZ(t,e){e.stopPropagation();this.#nq.dispatch("switchannotationeditorparams",{source:this,type:this.#nX,value:t})}_colorSelectFromKeyboard(t){if(t.target===this.#nU){this.#nQ(t);return}const e=t.target.getAttribute("data-color");if(!e){return}this.#nZ(e,t)}_moveToNext(t){if(!this.#n0){this.#nQ(t);return}if(t.target===this.#nU){this.#nj.firstChild?.focus();return}t.target.nextSibling?.focus()}_moveToPrevious(t){if(t.target===this.#nj?.firstChild||t.target===this.#nU){if(this.#n0){this._hideDropdownFromKeyboard()}return}if(!this.#n0){this.#nQ(t)}t.target.previousSibling?.focus()}_moveToBeginning(t){if(!this.#n0){this.#nQ(t);return}this.#nj.firstChild?.focus()}_moveToEnd(t){if(!this.#n0){this.#nQ(t);return}this.#nj.lastChild?.focus()}#iv(t){iB._keyboardManager.exec(this,t)}#nQ(t){if(this.#n0){this.hideDropdown();return}this.#nV=t.detail===0;if(!this.#nK){this.#nK=new AbortController;window.addEventListener("pointerdown",this.#h.bind(this),{signal:this.#g.combinedSignal(this.#nK)})}if(this.#nj){this.#nj.classList.remove("hidden");return}const e=this.#nj=this.#nJ();this.#nU.append(e)}#h(t){if(this.#nj?.contains(t.target)){return}this.hideDropdown()}hideDropdown(){this.#nj?.classList.add("hidden");this.#nK?.abort();this.#nK=null}get #n0(){return this.#nj&&!this.#nj.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(this.#nW){return}if(!this.#n0){this.#r?.unselect();return}this.hideDropdown();this.#nU.focus({preventScroll:true,focusVisible:this.#nV})}updateColor(t){if(this.#n$){this.#n$.style.backgroundColor=t}if(!this.#nj){return}const e=this.#g.highlightColors.values();for(const s of this.#nj.children){s.setAttribute("aria-selected",e.next().value===t)}}destroy(){this.#nU?.remove();this.#nU=null;this.#n$=null;this.#nj?.remove();this.#nj=null}};class iH extends t1{#n1=null;#n2=0;#n3;#n5=null;#n=null;#n6=null;#n4=null;#n8=0;#n7=null;#n9=null;#v=null;#rt=false;#nk=null;#re;#rs=null;#ri="";#nb;#rn="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=b.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const t=iH.prototype;return $(this,"_keyboardManager",new tY([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}constructor(t){super({...t,name:"highlightEditor"});this.color=t.color||iH._defaultColor;this.#nb=t.thickness||iH._defaultThickness;this.#re=t.opacity||iH._defaultOpacity;this.#n3=t.boxes||null;this.#rn=t.methodOfCreation||"";this.#ri=t.text||"";this._isDraggable=false;if(t.highlightId>-1){this.#rt=true;this.#rr(t);this.#ra()}else if(this.#n3){this.#n1=t.anchorNode;this.#n2=t.anchorOffset;this.#n4=t.focusNode;this.#n8=t.focusOffset;this.#ro();this.#ra();this.rotate(this.rotation)}}get telemetryInitialData(){return{action:"added",type:this.#rt?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:this.#nb,methodOfCreation:this.#rn}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}#ro(){const t=new iL(this.#n3,.001);this.#n9=t.getOutlines();[this.x,this.y,this.width,this.height]=this.#n9.box;const e=new iL(this.#n3,.0025,.001,this._uiManager.direction==="ltr");this.#n6=e.getOutlines();const{lastPoint:s}=this.#n6;this.#nk=[(s[0]-this.x)/this.width,(s[1]-this.y)/this.height]}#rr({highlightOutlines:t,highlightId:e,clipPathId:s}){this.#n9=t;const i=1.5;this.#n6=t.getNewOutline(this.#nb/2+i,.0025);if(e>=0){this.#v=e;this.#n5=s;this.parent.drawLayer.finalizeDraw(e,{bbox:t.box,path:{d:t.toSVGPath()}});this.#rs=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:true,free:true},bbox:this.#n6.box,path:{d:this.#n6.toSVGPath()}},true)}else if(this.parent){const e=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#v,{bbox:iH.#rl(this.#n9.box,(e-this.rotation+360)%360),path:{d:t.toSVGPath()}});this.parent.drawLayer.updateProperties(this.#rs,{bbox:iH.#rl(this.#n6.box,e),path:{d:this.#n6.toSVGPath()}})}const[n,r,a,o]=t.box;switch(this.rotation){case 0:this.x=n;this.y=r;this.width=a;this.height=o;break;case 90:{const[t,e]=this.parentDimensions;this.x=r;this.y=1-n;this.width=a*e/t;this.height=o*t/e;break}case 180:this.x=1-n;this.y=1-r;this.width=a;this.height=o;break;case 270:{const[t,e]=this.parentDimensions;this.x=1-r;this.y=n;this.width=a*e/t;this.height=o*t/e;break}}const{lastPoint:l}=this.#n6;this.#nk=[(l[0]-n)/a,(l[1]-r)/o]}static initialize(t,e){t1.initialize(t,e);iH._defaultColor||=e.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(t,e){switch(t){case A.HIGHLIGHT_DEFAULT_COLOR:iH._defaultColor=e;break;case A.HIGHLIGHT_THICKNESS:iH._defaultThickness=e;break}}translateInPage(t,e){}get toolbarPosition(){return this.#nk}updateParams(t,e){switch(t){case A.HIGHLIGHT_COLOR:this.#i7(e);break;case A.HIGHLIGHT_THICKNESS:this.#rh(e);break}}static get defaultPropertiesToUpdate(){return[[A.HIGHLIGHT_DEFAULT_COLOR,iH._defaultColor],[A.HIGHLIGHT_THICKNESS,iH._defaultThickness]]}get propertiesToUpdate(){return[[A.HIGHLIGHT_COLOR,this.color||iH._defaultColor],[A.HIGHLIGHT_THICKNESS,this.#nb||iH._defaultThickness],[A.HIGHLIGHT_FREE,this.#rt]]}#i7(t){const e=(t,e)=>{this.color=t;this.#re=e;this.parent?.drawLayer.updateProperties(this.#v,{root:{fill:t,"fill-opacity":e}});this.#n?.updateColor(t)};const s=this.color;const i=this.#re;this.addCommands({cmd:e.bind(this,t,iH._defaultOpacity),undo:e.bind(this,s,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:true,type:A.HIGHLIGHT_COLOR,overwriteIfSameType:true,keepUndo:true});this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},true)}#rh(t){const e=this.#nb;const s=t=>{this.#nb=t;this.#rc(t)};this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,e),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:true,type:A.INK_THICKNESS,overwriteIfSameType:true,keepUndo:true});this._reportTelemetry({action:"thickness_changed",thickness:t},true)}async addEditToolbar(){const t=await super.addEditToolbar();if(!t){return null}if(this._uiManager.highlightColors){this.#n=new iB({editor:this});t.addColorPicker(this.#n)}return t}disableEditing(){super.disableEditing();this.div.classList.toggle("disabled",true)}enableEditing(){super.enableEditing();this.div.classList.toggle("disabled",false)}fixAndSetPosition(){return super.fixAndSetPosition(this.#rd())}getBaseTranslation(){return[0,0]}getRect(t,e){return super.getRect(t,e,this.#rd())}onceAdded(t){if(!this.annotationElementId){this.parent.addUndoableEditor(this)}if(t){this.div.focus()}}remove(){this.#ru();this._reportTelemetry({action:"deleted"});super.remove()}rebuild(){if(!this.parent){return}super.rebuild();if(this.div===null){return}this.#ra();if(!this.isAttachedToDOM){this.parent.add(this)}}setParent(t){let e=false;if(this.parent&&!t){this.#ru()}else if(t){this.#ra(t);e=!this.parent&&this.div?.classList.contains("selectedEditor")}super.setParent(t);this.show(this._isVisible);if(e){this.select()}}#rc(t){if(!this.#rt){return}this.#rr({highlightOutlines:this.#n9.getNewOutline(t/2)});this.fixAndSetPosition();const[e,s]=this.parentDimensions;this.setDims(this.width*e,this.height*s)}#ru(){if(this.#v===null||!this.parent){return}this.parent.drawLayer.remove(this.#v);this.#v=null;this.parent.drawLayer.remove(this.#rs);this.#rs=null}#ra(t=this.parent){if(this.#v!==null){return}({id:this.#v,clipPathId:this.#n5}=t.drawLayer.draw({bbox:this.#n9.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.#re},rootClass:{highlight:true,free:this.#rt},path:{d:this.#n9.toSVGPath()}},false,true));this.#rs=t.drawLayer.drawOutline({rootClass:{highlightOutline:true,free:this.#rt},bbox:this.#n6.box,path:{d:this.#n6.toSVGPath()}},this.#rt);if(this.#n7){this.#n7.style.clipPath=this.#n5}}static #rl([t,e,s,i],n){switch(n){case 90:return[1-e-i,t,i,s];case 180:return[1-t-s,1-e-i,s,i];case 270:return[e,1-t-s,i,s]}return[t,e,s,i]}rotate(t){const{drawLayer:e}=this.parent;let s;if(this.#rt){t=(t-this.rotation+360)%360;s=iH.#rl(this.#n9.box,t)}else{s=iH.#rl([this.x,this.y,this.width,this.height],t)}e.updateProperties(this.#v,{bbox:s,root:{"data-main-rotation":t}});e.updateProperties(this.#rs,{bbox:iH.#rl(this.#n6.box,t),root:{"data-main-rotation":t}})}render(){if(this.div){return this.div}const t=super.render();if(this.#ri){t.setAttribute("aria-label",this.#ri);t.setAttribute("role","mark")}if(this.#rt){t.classList.add("free")}else{this.div.addEventListener("keydown",this.#rf.bind(this),{signal:this._uiManager._signal})}const e=this.#n7=document.createElement("div");t.append(e);e.setAttribute("aria-hidden","true");e.className="internal";e.style.clipPath=this.#n5;const[s,i]=this.parentDimensions;this.setDims(this.width*s,this.height*i);tV(this,this.#n7,["pointerover","pointerleave"]);this.enableEditing();return t}pointerover(){if(!this.isSelected){this.parent?.drawLayer.updateProperties(this.#rs,{rootClass:{hovered:true}})}}pointerleave(){if(!this.isSelected){this.parent?.drawLayer.updateProperties(this.#rs,{rootClass:{hovered:false}})}}#rf(t){iH._keyboardManager.exec(this,t)}_moveCaret(t){this.parent.unselect(this);switch(t){case 0:case 2:this.#rp(true);break;case 1:case 3:this.#rp(false);break}}#rp(t){if(!this.#n1){return}const e=window.getSelection();if(t){e.setPosition(this.#n1,this.#n2)}else{e.setPosition(this.#n4,this.#n8)}}select(){super.select();if(!this.#rs){return}this.parent?.drawLayer.updateProperties(this.#rs,{rootClass:{hovered:false,selected:true}})}unselect(){super.unselect();if(!this.#rs){return}this.parent?.drawLayer.updateProperties(this.#rs,{rootClass:{selected:false}});if(!this.#rt){this.#rp(false)}}get _mustFixPosition(){return!this.#rt}show(t=this._isVisible){super.show(t);if(this.parent){this.parent.drawLayer.updateProperties(this.#v,{rootClass:{hidden:!t}});this.parent.drawLayer.updateProperties(this.#rs,{rootClass:{hidden:!t}})}}#rd(){return this.#rt?this.rotation:0}#rg(){if(this.#rt){return null}const[t,e]=this.pageDimensions;const[s,i]=this.pageTranslation;const n=this.#n3;const r=new Float32Array(n.length*8);let a=0;for(const{x:o,y:l,width:h,height:c}of n){const n=o*t+s;const d=(1-l)*e+i;r[a]=r[a+4]=n;r[a+1]=r[a+3]=d;r[a+2]=r[a+6]=n+h*t;r[a+5]=r[a+7]=d-c*e;a+=8}return r}#rm(t){return this.#n9.serialize(t,this.#rd())}static startHighlighting(t,e,{target:s,x:i,y:n}){const{x:r,y:a,width:o,height:l}=s.getBoundingClientRect();const h=new AbortController;const c=t.combinedSignal(h);const d=e=>{h.abort();this.#rb(t,e)};window.addEventListener("blur",d,{signal:c});window.addEventListener("pointerup",d,{signal:c});window.addEventListener("pointerdown",tD,{capture:true,passive:false,signal:c});window.addEventListener("contextmenu",tk,{signal:c});s.addEventListener("pointermove",this.#rA.bind(this,t),{signal:c});this._freeHighlight=new iO({x:i,y:n},[r,a,o,l],t.scale,this._defaultThickness/2,e,.001);({id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:true,free:true},path:{d:this._freeHighlight.toSVGPath()}},true,true))}static #rA(t,e){if(this._freeHighlight.add(e)){t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}}static #rb(t,e){if(!this._freeHighlight.isEmpty()){t.createAndAddNewEditor(e,false,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"})}else{t.drawLayer.remove(this._freeHighlightId)}this._freeHighlightId=-1;this._freeHighlight=null;this._freeHighlightClipId=""}static async deserialize(t,e,s){let i=null;if(t instanceof i_){const{data:{quadPoints:e,rect:s,rotation:n,id:r,color:a,opacity:o,popupRef:l},parent:{page:{pageNumber:h}}}=t;i=t={annotationType:b.HIGHLIGHT,color:Array.from(a),opacity:o,quadPoints:e,boxes:null,pageIndex:h-1,rect:s.slice(0),rotation:n,id:r,deleted:false,popupRef:l}}else if(t instanceof iw){const{data:{inkLists:e,rect:s,rotation:n,id:r,color:a,borderStyle:{rawWidth:o},popupRef:l},parent:{page:{pageNumber:h}}}=t;i=t={annotationType:b.HIGHLIGHT,color:Array.from(a),thickness:o,inkLists:e,boxes:null,pageIndex:h-1,rect:s.slice(0),rotation:n,id:r,deleted:false,popupRef:l}}const{color:n,quadPoints:r,inkLists:a,opacity:o}=t;const l=await super.deserialize(t,e,s);l.color=ta.makeHexColor(...n);l.#re=o||1;if(a){l.#nb=t.thickness}l.annotationElementId=t.id||null;l._initialData=i;const[h,c]=l.pageDimensions;const[d,u]=l.pageTranslation;if(r){const t=l.#n3=[];for(let e=0;e<r.length;e+=8){t.push({x:(r[e]-d)/h,y:1-(r[e+1]-u)/c,width:(r[e+2]-r[e])/h,height:(r[e+1]-r[e+5])/c})}l.#ro();l.#ra();l.rotate(l.rotation)}else if(a){l.#rt=true;const t=a[0];const s={x:t[0]-d,y:c-(t[1]-u)};const i=new iO(s,[0,0,h,c],1,l.#nb/2,true,.001);for(let e=0,n=t.length;e<n;e+=2){s.x=t[e]-d;s.y=c-(t[e+1]-u);i.add(s)}const{id:n,clipPathId:r}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:l.color,"fill-opacity":l._defaultOpacity},rootClass:{highlight:true,free:true},path:{d:i.toSVGPath()}},true,true);l.#rr({highlightOutlines:i.getOutlines(),highlightId:n,clipPathId:r});l.#ra()}return l}serialize(t=false){if(this.isEmpty()||t){return null}if(this.deleted){return this.serializeDeleted()}const e=this.getRect(0,0);const s=t1._colorManager.convert(this.color);const i={annotationType:b.HIGHLIGHT,color:s,opacity:this.#re,thickness:this.#nb,quadPoints:this.#rg(),outlines:this.#rm(e),pageIndex:this.pageIndex,rect:e,rotation:this.#rd(),structTreeParentId:this._structTreeParentId};if(this.annotationElementId&&!this.#nr(i)){return null}i.id=this.annotationElementId;return i}#nr(t){const{color:e}=this._initialData;return t.color.some((t,s)=>t!==e[s])}renderAnnotationElement(t){t.updateEdited({rect:this.getRect(0,0)});return null}static canCreateNewEmptyEditor(){return false}};class iz{#rv=Object.create(null);updateProperty(t,e){this[t]=e;this.updateSVGProperty(t,e)}updateProperties(t){if(!t){return}for(const[e,s]of Object.entries(t)){this.updateProperty(e,s)}}updateSVGProperty(t,e){this.#rv[t]=e}toSVGProperties(){const t=this.#rv;this.#rv=Object.create(null);return{root:t}}reset(){this.#rv=Object.create(null)}updateAll(t=this){this.updateProperties(t)}clone(){B("Not implemented")}}class iU extends t1{#ry=null;#rw;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static #r_=null;static #rx=null;static #rE=null;static #rS=NaN;static #rC=null;static #rT=null;static #rM=NaN;static _INNER_MARGIN=3;constructor(t){super(t);this.#rw=t.mustBeCommitted||false;if(t.drawOutlines){this.#rP(t);this.#ra()}}#rP({drawOutlines:t,drawId:e,drawingOptions:s}){this.#ry=t;this._drawingOptions||=s;if(e>=0){this._drawId=e;this.parent.drawLayer.finalizeDraw(e,t.defaultProperties)}else{this._drawId=this.#rI(t,this.parent)}this.#rR(t.box)}#rI(t,e){const{id:s}=e.drawLayer.draw(iU._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),false,false);return s}static _mergeSVGProperties(t,e){const s=new Set(Object.keys(t));for(const[i,n]of Object.entries(e)){if(s.has(i)){Object.assign(t[i],n)}else{t[i]=n}}return t}static getDefaultDrawingOptions(t){B("Not implemented")}static get typesMap(){B("Not implemented")}static get isDrawer(){return true}static get supportMultipleDrawings(){return false}static updateDefaultParams(t,e){const s=this.typesMap.get(t);if(s){this._defaultDrawingOptions.updateProperty(s,e)}if(this._currentParent){iU.#r_.updateProperty(s,e);this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties())}}updateParams(t,e){const s=this.constructor.typesMap.get(t);if(s){this._updateProperty(t,s,e)}}static get defaultPropertiesToUpdate(){const t=[];const e=this._defaultDrawingOptions;for(const[s,i]of this.typesMap){t.push([s,e[i]])}return t}get propertiesToUpdate(){const t=[];const{_drawingOptions:e}=this;for(const[s,i]of this.constructor.typesMap){t.push([s,e[i]])}return t}_updateProperty(t,e,s){const i=this._drawingOptions;const n=i[e];const r=t=>{i.updateProperty(e,t);const s=this.#ry.updateProperty(e,t);if(s){this.#rR(s)}this.parent?.drawLayer.updateProperties(this._drawId,i.toSVGProperties())};this.addCommands({cmd:r.bind(this,s),undo:r.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:true,type:t,overwriteIfSameType:true,keepUndo:true})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,iU._mergeSVGProperties(this.#ry.getPathResizingSVGProperties(this.#rk()),{bbox:this.#rD()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,iU._mergeSVGProperties(this.#ry.getPathResizedSVGProperties(this.#rk()),{bbox:this.#rD()}))}_onTranslating(t,e){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#rD(t,e)})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,iU._mergeSVGProperties(this.#ry.getPathTranslatedSVGProperties(this.#rk(),this.parentDimensions),{bbox:this.#rD()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:true}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:false}})}commit(){super.commit();this.disableEditMode();this.disableEditing()}disableEditing(){super.disableEditing();this.div.classList.toggle("disabled",true)}enableEditing(){super.enableEditing();this.div.classList.toggle("disabled",false)}getBaseTranslation(){return[0,0]}get isResizable(){return true}onceAdded(t){if(!this.annotationElementId){this.parent.addUndoableEditor(this)}this._isDraggable=true;if(this.#rw){this.#rw=false;this.commit();this.parent.setSelected(this);if(t&&this.isOnScreen){this.div.focus()}}}remove(){this.#ru();super.remove()}rebuild(){if(!this.parent){return}super.rebuild();if(this.div===null){return}this.#ra();this.#rR(this.#ry.box);if(!this.isAttachedToDOM){this.parent.add(this)}}setParent(t){let e=false;if(this.parent&&!t){this._uiManager.removeShouldRescale(this);this.#ru()}else if(t){this._uiManager.addShouldRescale(this);this.#ra(t);e=!this.parent&&this.div?.classList.contains("selectedEditor")}super.setParent(t);if(e){this.select()}}#ru(){if(this._drawId===null||!this.parent){return}this.parent.drawLayer.remove(this._drawId);this._drawId=null;this._drawingOptions.reset()}#ra(t=this.parent){if(this._drawId!==null&&this.parent===t){return}if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll();this._drawId=this.#rI(this.#ry,t)}#rL([t,e,s,i]){const{parentDimensions:[n,r],rotation:a}=this;switch(a){case 90:return[e,1-t,s*(r/n),i*(n/r)];case 180:return[1-t,1-e,s,i];case 270:return[1-e,t,s*(r/n),i*(n/r)];default:return[t,e,s,i]}}#rk(){const{x:t,y:e,width:s,height:i,parentDimensions:[n,r],rotation:a}=this;switch(a){case 90:return[1-e,t,s*(n/r),i*(r/n)];case 180:return[1-t,1-e,s,i];case 270:return[e,1-t,s*(n/r),i*(r/n)];default:return[t,e,s,i]}}#rR(t){[this.x,this.y,this.width,this.height]=this.#rL(t);if(this.div){this.fixAndSetPosition();const[t,e]=this.parentDimensions;this.setDims(this.width*t,this.height*e)}this._onResized()}#rD(){const{x:t,y:e,width:s,height:i,rotation:n,parentRotation:r,parentDimensions:[a,o]}=this;switch((n*4+r)/90){case 1:return[1-e-i,t,i,s];case 2:return[1-t-s,1-e-i,s,i];case 3:return[e,1-t-s,i,s];case 4:return[t,e-s*(a/o),i*(o/a),s*(a/o)];case 5:return[1-e,t,s*(a/o),i*(o/a)];case 6:return[1-t-i*(o/a),1-e,i*(o/a),s*(a/o)];case 7:return[e-s*(a/o),1-t-i*(o/a),s*(a/o),i*(o/a)];case 8:return[t-s,e-i,s,i];case 9:return[1-e,t-s,i,s];case 10:return[1-t,1-e,s,i];case 11:return[e-i,1-t,i,s];case 12:return[t-i*(o/a),e,i*(o/a),s*(a/o)];case 13:return[1-e-s*(a/o),t-i*(o/a),s*(a/o),i*(o/a)];case 14:return[1-t,1-e-s*(a/o),i*(o/a),s*(a/o)];case 15:return[e,1-t,s*(a/o),i*(o/a)];default:return[t,e,s,i]}}rotate(){if(!this.parent){return}this.parent.drawLayer.updateProperties(this._drawId,iU._mergeSVGProperties({bbox:this.#rD()},this.#ry.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){if(!this.parent){return}this.#rR(this.#ry.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div){return this.div}const t=super.render();t.classList.add("draw");const e=document.createElement("div");t.append(e);e.setAttribute("aria-hidden","true");e.className="internal";const[s,i]=this.parentDimensions;this.setDims(this.width*s,this.height*i);this._uiManager.addShouldRescale(this);this.disableEditing();return t}static createDrawerInstance(t,e,s,i,n){B("Not implemented")}static startDrawing(t,e,s,i){const{target:n,offsetX:r,offsetY:a,pointerId:o,pointerType:l}=i;if(iU.#rC&&iU.#rC!==l){return}const{viewport:{rotation:h}}=t;const{width:c,height:d}=n.getBoundingClientRect();const u=iU.#rx=new AbortController;const f=t.combinedSignal(u);iU.#rS||=o;iU.#rC??=l;window.addEventListener("pointerup",t=>{if(iU.#rS===t.pointerId){this._endDraw(t)}else{iU.#rT?.delete(t.pointerId)}},{signal:f});window.addEventListener("pointercancel",t=>{if(iU.#rS===t.pointerId){this._currentParent.endDrawingSession()}else{iU.#rT?.delete(t.pointerId)}},{signal:f});window.addEventListener("pointerdown",t=>{if(iU.#rC!==t.pointerType){return}(iU.#rT||=new Set).add(t.pointerId);if(iU.#r_.isCancellable()){iU.#r_.removeLastElement();if(iU.#r_.isEmpty()){this._currentParent.endDrawingSession(true)}else{this._endDraw(null)}}},{capture:true,passive:false,signal:f});window.addEventListener("contextmenu",tk,{signal:f});n.addEventListener("pointermove",this._drawMove.bind(this),{signal:f});n.addEventListener("touchmove",t=>{if(t.timeStamp===iU.#rM){tD(t)}},{signal:f});t.toggleDrawing();e._editorUndoBar?.hide();if(iU.#r_){t.drawLayer.updateProperties(this._currentDrawId,iU.#r_.startNew(r,a,c,d,h));return}e.updateUIForDefaultProperties(this);iU.#r_=this.createDrawerInstance(r,a,c,d,h);iU.#rE=this.getDefaultDrawingOptions();this._currentParent=t;({id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(iU.#rE.toSVGProperties(),iU.#r_.defaultSVGProperties),true,false))}static _drawMove(t){iU.#rM=-1;if(!iU.#r_){return}const{offsetX:e,offsetY:s,pointerId:i}=t;if(iU.#rS!==i){return}if(iU.#rT?.size>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,iU.#r_.add(e,s));iU.#rM=t.timeStamp;tD(t)}static _cleanup(t){if(t){this._currentDrawId=-1;this._currentParent=null;iU.#r_=null;iU.#rE=null;iU.#rC=null;iU.#rM=NaN}if(iU.#rx){iU.#rx.abort();iU.#rx=null;iU.#rS=NaN;iU.#rT=null}}static _endDraw(t){const e=this._currentParent;if(!e){return}e.toggleDrawing(true);this._cleanup(false);if(t){e.drawLayer.updateProperties(this._currentDrawId,iU.#r_.end(t.offsetX,t.offsetY))}if(this.supportMultipleDrawings){const t=iU.#r_;const s=this._currentDrawId;const i=t.getLastElement();e.addCommands({cmd:()=>{e.drawLayer.updateProperties(s,t.setLastElement(i))},undo:()=>{e.drawLayer.updateProperties(s,t.removeLastElement())},mustExec:false,type:A.DRAW_STEP});return}this.endDrawing(false)}static endDrawing(t){const e=this._currentParent;if(!e){return null}e.toggleDrawing(true);e.cleanUndoStack(A.DRAW_STEP);if(!iU.#r_.isEmpty()){const{pageDimensions:[s,i],scale:n}=e;const r=e.createAndAddNewEditor({offsetX:0,offsetY:0},false,{drawId:this._currentDrawId,drawOutlines:iU.#r_.getOutlines(s*n,i*n,n,this._INNER_MARGIN),drawingOptions:iU.#rE,mustBeCommitted:!t});this._cleanup(true);return r}e.drawLayer.remove(this._currentDrawId);this._cleanup(true);return null}createDrawingOptions(t){}static deserializeDraw(t,e,s,i,n,r){B("Not implemented")}static async deserialize(t,e,s){const{rawDims:{pageWidth:i,pageHeight:n,pageX:r,pageY:a}}=e.viewport;const o=this.deserializeDraw(r,a,i,n,this._INNER_MARGIN,t);const l=await super.deserialize(t,e,s);l.createDrawingOptions(t);l.#rP({drawOutlines:o});l.#ra();l.onScaleChanging();l.rotate();return l}serializeDraw(t){const[e,s]=this.pageTranslation;const[i,n]=this.pageDimensions;return this.#ry.serialize([e,s,i,n],t)}renderAnnotationElement(t){t.updateEdited({rect:this.getRect(0,0)});return null}static canCreateNewEmptyEditor(){return false}};class i${#nd=new Float64Array(6);#iG;#rF;#sR;#nb;#nA;#rO="";#rN=0;#nz=new iG;#rB;#rH;constructor(t,e,s,i,n,r){this.#rB=s;this.#rH=i;this.#sR=n;this.#nb=r;[t,e]=this.#rz(t,e);const a=this.#iG=[NaN,NaN,NaN,NaN,t,e];this.#nA=[t,e];this.#rF=[{line:a,points:this.#nA}];this.#nd.set(a,0)}updateProperty(t,e){if(t==="stroke-width"){this.#nb=e}}#rz(t,e){return iR._normalizePoint(t,e,this.#rB,this.#rH,this.#sR)}isEmpty(){return!this.#rF||this.#rF.length===0}isCancellable(){return this.#nA.length<=10}add(t,e){[t,e]=this.#rz(t,e);const[s,i,n,r]=this.#nd.subarray(2,6);const a=t-n;const o=e-r;const l=Math.hypot(this.#rB*a,this.#rH*o);if(l<=2){return null}this.#nA.push(t,e);if(isNaN(s)){this.#nd.set([n,r,t,e],2);this.#iG.push(NaN,NaN,NaN,NaN,t,e);return{path:{d:this.toSVGPath()}}}if(isNaN(this.#nd[0])){this.#iG.splice(6,6)}this.#nd.set([s,i,n,r,t,e],0);this.#iG.push(...iR.createBezierPoints(s,i,n,r,t,e));return{path:{d:this.toSVGPath()}}}end(t,e){const s=this.add(t,e);if(s){return s}if(this.#nA.length===2){return{path:{d:this.toSVGPath()}}}return null}startNew(t,e,s,i,n){this.#rB=s;this.#rH=i;this.#sR=n;[t,e]=this.#rz(t,e);const r=this.#iG=[NaN,NaN,NaN,NaN,t,e];this.#nA=[t,e];const a=this.#rF.at(-1);if(a){a.line=new Float32Array(a.line);a.points=new Float32Array(a.points)}this.#rF.push({line:r,points:this.#nA});this.#nd.set(r,0);this.#rN=0;this.toSVGPath();return null}getLastElement(){return this.#rF.at(-1)}setLastElement(t){if(!this.#rF){return this.#nz.setLastElement(t)}this.#rF.push(t);this.#iG=t.line;this.#nA=t.points;this.#rN=0;return{path:{d:this.toSVGPath()}}}removeLastElement(){if(!this.#rF){return this.#nz.removeLastElement()}this.#rF.pop();this.#rO="";for(let t=0,e=this.#rF.length;t<e;t++){const{line:e,points:s}=this.#rF[t];this.#iG=e;this.#nA=s;this.#rN=0;this.toSVGPath()}return{path:{d:this.#rO}}}toSVGPath(){const t=iR.svgRound(this.#iG[4]);const e=iR.svgRound(this.#iG[5]);if(this.#nA.length===2){this.#rO=`${this.#rO} M ${t} ${e} Z`;return this.#rO}if(this.#nA.length<=6){const s=this.#rO.lastIndexOf("M");this.#rO=`${this.#rO.slice(0,s)} M ${t} ${e}`;this.#rN=6}if(this.#nA.length===4){const t=iR.svgRound(this.#iG[10]);const e=iR.svgRound(this.#iG[11]);this.#rO=`${this.#rO} L ${t} ${e}`;this.#rN=12;return this.#rO}const s=[];if(this.#rN===0){s.push(`M ${t} ${e}`);this.#rN=6}for(let t=this.#rN,e=this.#iG.length;t<e;t+=6){const[e,i,n,r,a,o]=this.#iG.slice(t,t+6).map(iR.svgRound);s.push(`C${e} ${i} ${n} ${r} ${a} ${o}`)}this.#rO+=s.join(" ");this.#rN=this.#iG.length;return this.#rO}getOutlines(t,e,s,i){const n=this.#rF.at(-1);n.line=new Float32Array(n.line);n.points=new Float32Array(n.points);this.#nz.build(this.#rF,t,e,s,this.#sR,this.#nb,i);this.#nd=null;this.#iG=null;this.#rF=null;this.#rO=null;return this.#nz}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:true},bbox:[0,0,1,1]}}}class iG extends iR{#nP;#rU=0;#nl;#rF;#rB;#rH;#r$;#sR;#nb;build(t,e,s,i,n,r,a){this.#rB=e;this.#rH=s;this.#r$=i;this.#sR=n;this.#nb=r;this.#nl=a??0;this.#rF=t;this.#rG()}setLastElement(t){this.#rF.push(t);return{path:{d:this.toSVGPath()}}}removeLastElement(){this.#rF.pop();return{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:e}of this.#rF){t.push(`M${iR.svgRound(e[4])} ${iR.svgRound(e[5])}`);if(e.length===6){t.push("Z");continue}if(e.length===12){t.push(`L${iR.svgRound(e[10])} ${iR.svgRound(e[11])}`);continue}for(let s=6,i=e.length;s<i;s+=6){const[i,n,r,a,o,l]=e.subarray(s,s+6).map(iR.svgRound);t.push(`C${i} ${n} ${r} ${a} ${o} ${l}`)}}return t.join("")}serialize([t,e,s,i],n){const r=[];const a=[];const[o,l,h,c]=this.#rj();let d,u,f,p,g,m,b,A,v;switch(this.#sR){case 0:v=iR._rescale;d=t;u=e+i;f=s;p=-i;g=t+o*s;m=e+(1-l-c)*i;b=t+(o+h)*s;A=e+(1-l)*i;break;case 90:v=iR._rescaleAndSwap;d=t;u=e;f=s;p=i;g=t+l*s;m=e+o*i;b=t+(l+c)*s;A=e+(o+h)*i;break;case 180:v=iR._rescale;d=t+s;u=e;f=-s;p=i;g=t+(1-o-h)*s;m=e+l*i;b=t+(1-o)*s;A=e+(l+c)*i;break;case 270:v=iR._rescaleAndSwap;d=t+s;u=e+i;f=-s;p=-i;g=t+(1-l-c)*s;m=e+(1-o-h)*i;b=t+(1-l)*s;A=e+(1-o)*i;break}for(const{line:t,points:e}of this.#rF){r.push(v(t,d,u,f,p,n?new Array(t.length):null));a.push(v(e,d,u,f,p,n?new Array(e.length):null))}return{lines:r,points:a,rect:[g,m,b,A]}}static deserialize(t,e,s,i,n,{paths:{lines:r,points:a},rotation:o,thickness:l}){const h=[];let c,d,u,f,p;switch(o){case 0:p=iR._rescale;c=-t/s;d=e/i+1;u=1/s;f=-1/i;break;case 90:p=iR._rescaleAndSwap;c=-e/i;d=-t/s;u=1/i;f=1/s;break;case 180:p=iR._rescale;c=t/s+1;d=-e/i;u=-1/s;f=1/i;break;case 270:p=iR._rescaleAndSwap;c=e/i+1;d=t/s+1;u=-1/i;f=-1/s;break}if(!r){r=[];for(const t of a){const e=t.length;if(e===2){r.push(new Float32Array([NaN,NaN,NaN,NaN,t[0],t[1]]));continue}if(e===4){r.push(new Float32Array([NaN,NaN,NaN,NaN,t[0],t[1],NaN,NaN,NaN,NaN,t[2],t[3]]));continue}const s=new Float32Array(3*(e-2));r.push(s);let[i,n,a,o]=t.subarray(0,4);s.set([NaN,NaN,NaN,NaN,i,n],0);for(let r=4;r<e;r+=2){const e=t[r];const l=t[r+1];s.set(iR.createBezierPoints(i,n,a,o,e,l),(r-2)*3);[i,n,a,o]=[a,o,e,l]}}}for(let t=0,e=r.length;t<e;t++){h.push({line:p(r[t].map(t=>t??NaN),c,d,u,f),points:p(a[t].map(t=>t??NaN),c,d,u,f)})}const g=new iG;g.build(h,s,i,1,o,l,n);return g}#rV(t=this.#nb){const e=this.#nl+t/2*this.#r$;return this.#sR%180===0?[e/this.#rB,e/this.#rH]:[e/this.#rH,e/this.#rB]}#rj(){const[t,e,s,i]=this.#nP;const[n,r]=this.#rV(0);return[t+n,e+r,s-2*n,i-2*r]}#rG(){const t=this.#nP=new Float32Array([Infinity,Infinity,-Infinity,-Infinity]);for(const{line:e}of this.#rF){if(e.length<=12){for(let s=4,i=e.length;s<i;s+=6){const[i,n]=e.subarray(s,s+2);t[0]=Math.min(t[0],i);t[1]=Math.min(t[1],n);t[2]=Math.max(t[2],i);t[3]=Math.max(t[3],n)}continue}let s=e[4],i=e[5];for(let n=6,r=e.length;n<r;n+=6){const[r,a,o,l,h,c]=e.subarray(n,n+6);ta.bezierBoundingBox(s,i,r,a,o,l,h,c,t);s=h;i=c}}const[e,s]=this.#rV();t[0]=Math.min(1,Math.max(0,t[0]-e));t[1]=Math.min(1,Math.max(0,t[1]-s));t[2]=Math.min(1,Math.max(0,t[2]+e));t[3]=Math.min(1,Math.max(0,t[3]+s));t[2]-=t[0];t[3]-=t[1]}get box(){return this.#nP}updateProperty(t,e){if(t==="stroke-width"){return this.#rh(e)}return null}#rh(t){const[e,s]=this.#rV();this.#nb=t;const[i,n]=this.#rV();const[r,a]=[i-e,n-s];const o=this.#nP;o[0]-=r;o[1]-=a;o[2]+=2*r;o[3]+=2*a;return o}updateParentDimensions([t,e],s){const[i,n]=this.#rV();this.#rB=t;this.#rH=e;this.#r$=s;const[r,a]=this.#rV();const o=r-i;const l=a-n;const h=this.#nP;h[0]-=o;h[1]-=l;h[2]+=2*o;h[3]+=2*l;return h}updateRotation(t){this.#rU=t;return{path:{transform:this.rotationTransform}}}get viewBox(){return this.#nP.map(iR.svgRound).join(" ")}get defaultProperties(){const[t,e]=this.#nP;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${iR.svgRound(t)} ${iR.svgRound(e)}`}}}get rotationTransform(){const[,,t,e]=this.#nP;let s=0,i=0,n=0,r=0,a=0,o=0;switch(this.#rU){case 90:i=e/t;n=-t/e;a=t;break;case 180:s=-1;r=-1;a=t;o=e;break;case 270:i=-e/t;n=t/e;o=e;break;default:return""}return`matrix(${s} ${i} ${n} ${r} ${iR.svgRound(a)} ${iR.svgRound(o)})`}getPathResizingSVGProperties([t,e,s,i]){const[n,r]=this.#rV();const[a,o,l,h]=this.#nP;if(Math.abs(l-n)<=iR.PRECISION||Math.abs(h-r)<=iR.PRECISION){const n=t+s/2-(a+l/2);const r=e+i/2-(o+h/2);return{path:{"transform-origin":`${iR.svgRound(t)} ${iR.svgRound(e)}`,transform:`${this.rotationTransform} translate(${n} ${r})`}}}const c=(s-2*n)/(l-2*n);const d=(i-2*r)/(h-2*r);const u=l/s;const f=h/i;return{path:{"transform-origin":`${iR.svgRound(a)} ${iR.svgRound(o)}`,transform:`${this.rotationTransform} scale(${u} ${f}) `+`translate(${iR.svgRound(n)} ${iR.svgRound(r)}) scale(${c} ${d}) `+`translate(${iR.svgRound(-n)} ${iR.svgRound(-r)})`}}}getPathResizedSVGProperties([t,e,s,i]){const[n,r]=this.#rV();const a=this.#nP;const[o,l,h,c]=a;a[0]=t;a[1]=e;a[2]=s;a[3]=i;if(Math.abs(h-n)<=iR.PRECISION||Math.abs(c-r)<=iR.PRECISION){const n=t+s/2-(o+h/2);const r=e+i/2-(l+c/2);for(const{line:t,points:e}of this.#rF){iR._translate(t,n,r,t);iR._translate(e,n,r,e)}return{root:{viewBox:this.viewBox},path:{"transform-origin":`${iR.svgRound(t)} ${iR.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const d=(s-2*n)/(h-2*n);const u=(i-2*r)/(c-2*r);const f=-d*(o+n)+t+n;const p=-u*(l+r)+e+r;if(d!==1||u!==1||f!==0||p!==0){for(const{line:t,points:e}of this.#rF){iR._rescale(t,f,p,d,u,t);iR._rescale(e,f,p,d,u,e)}}return{root:{viewBox:this.viewBox},path:{"transform-origin":`${iR.svgRound(t)} ${iR.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,e],s){const[i,n]=s;const r=this.#nP;const a=t-r[0];const o=e-r[1];if(this.#rB===i&&this.#rH===n){for(const{line:t,points:e}of this.#rF){iR._translate(t,a,o,t);iR._translate(e,a,o,e)}}else{const t=this.#rB/i;const e=this.#rH/n;this.#rB=i;this.#rH=n;for(const{line:s,points:i}of this.#rF){iR._rescale(s,a,o,t,e,s);iR._rescale(i,a,o,t,e,i)}r[2]*=t;r[3]*=e}r[0]=t;r[1]=e;return{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${iR.svgRound(t)} ${iR.svgRound(e)}`}}}get defaultSVGProperties(){const t=this.#nP;return{root:{viewBox:this.viewBox},rootClass:{draw:true},path:{d:this.toSVGPath(),"transform-origin":`${iR.svgRound(t[0])} ${iR.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}};class ij extends iz{#rW;constructor(t){super();this.#rW=t;super.updateProperties({fill:"none",stroke:t1._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,e){if(t==="stroke-width"){e??=this["stroke-width"];e*=this.#rW.realScale}super.updateSVGProperty(t,e)}clone(){const t=new ij(this.#rW);t.updateAll(this);return t}}class iV extends iU{static _type="ink";static _editorType=b.INK;static _defaultDrawingOptions=null;constructor(t){super({...t,name:"inkEditor"});this._willKeepAspectRatio=true}static initialize(t,e){t1.initialize(t,e);this._defaultDrawingOptions=new ij(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();e.updateProperties(t);return e}static get supportMultipleDrawings(){return true}static get typesMap(){return $(this,"typesMap",new Map([[A.INK_THICKNESS,"stroke-width"],[A.INK_COLOR,"stroke"],[A.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,e,s,i,n){return new i$(t,e,s,i,n,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,e,s,i,n,r){return iG.deserialize(t,e,s,i,n,r)}static async deserialize(t,e,s){let i=null;if(t instanceof iw){const{data:{inkLists:e,rect:s,rotation:n,id:r,color:a,opacity:o,borderStyle:{rawWidth:l},popupRef:h},parent:{page:{pageNumber:c}}}=t;i=t={annotationType:b.INK,color:Array.from(a),thickness:l,opacity:o,paths:{points:e},boxes:null,pageIndex:c-1,rect:s.slice(0),rotation:n,id:r,deleted:false,popupRef:h}}const n=await super.deserialize(t,e,s);n.annotationElementId=t.id||null;n._initialData=i;return n}onScaleChanging(){if(!this.parent){return}super.onScaleChanging();const{_drawId:t,_drawingOptions:e,parent:s}=this;e.updateSVGProperty("stroke-width");s.drawLayer.updateProperties(t,e.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;if(!t){return}super.onScaleChangingWhenDrawing();this._defaultDrawingOptions.updateSVGProperty("stroke-width");t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties())}createDrawingOptions({color:t,thickness:e,opacity:s}){this._drawingOptions=iV.getDefaultDrawingOptions({stroke:ta.makeHexColor(...t),"stroke-width":e,"stroke-opacity":s})}serialize(t=false){if(this.isEmpty()){return null}if(this.deleted){return this.serializeDeleted()}const{lines:e,points:s,rect:i}=this.serializeDraw(t);const{_drawingOptions:{stroke:n,"stroke-opacity":r,"stroke-width":a}}=this;const o={annotationType:b.INK,color:t1._colorManager.convert(n),opacity:r,thickness:a,paths:{lines:e,points:s},pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};if(t){return o}if(this.annotationElementId&&!this.#nr(o)){return null}o.id=this.annotationElementId;return o}#nr(t){const{color:e,thickness:s,opacity:i,pageIndex:n}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||t.color.some((t,s)=>t!==e[s])||t.thickness!==s||t.opacity!==i||t.pageIndex!==n}renderAnnotationElement(t){const{points:e,rect:s}=this.serializeDraw(false);t.updateEdited({rect:s,thickness:this._drawingOptions["stroke-width"],points:e});return null}};class iW extends t1{#rq=null;#rK=null;#rX=null;#rY=null;#rQ=null;#rJ="";#rZ=null;#r0=null;#r1=false;#r2=false;static _type="stamp";static _editorType=b.STAMP;constructor(t){super({...t,name:"stampEditor"});this.#rY=t.bitmapUrl;this.#rQ=t.bitmapFile}static initialize(t,e){t1.initialize(t,e)}static get supportedTypes(){const t=["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"];return $(this,"supportedTypes",t.map(t=>`image/${t}`))}static get supportedTypesStr(){return $(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(t){return this.supportedTypes.includes(t)}static paste(t,e){e.pasteEditor(b.STAMP,{bitmapFile:t.getAsFile()})}altTextFinish(){if(this._uiManager.useNewAltTextFlow){this.div.hidden=false}super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(t){const e=t.get("hasAltText");return{hasAltText:e.get(true)??0,hasNoAltText:e.get(false)??0}}#r3(t,e=false){if(!t){this.remove();return}this.#rq=t.bitmap;if(!e){this.#rK=t.id;this.#r1=t.isSvg}if(t.file){this.#rJ=t.file.name}this.#r5()}#r6(){this.#rX=null;this._uiManager.enableWaiting(false);if(!this.#rZ){return}if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#rq){this._editToolbar.hide();this._uiManager.editAltText(this,true);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#rq){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:false,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}async mlGuessAltText(t=null,e=true){if(this.hasAltTextData()){return null}const{mlManager:s}=this._uiManager;if(!s){throw new Error("No ML.")}if(!await s.isEnabledFor("altText")){throw new Error("ML isn't enabled for alt text.")}const{data:i,width:n,height:r}=t||this.copyCanvas(null,null,true).imageData;const a=await s.guess({name:"altText",request:{data:i,width:n,height:r,channels:i.length/(n*r)}});if(!a){throw new Error("No response from the AI service.")}if(a.error){throw new Error("Error from the AI service.")}if(a.cancel){return null}if(!a.output){throw new Error("No valid response from the AI service.")}const o=a.output;await this.setGuessedAltText(o);if(e&&!this.hasAltTextData()){this.altTextData={alt:o,decorative:false}}return o}#r4(){if(this.#rK){this._uiManager.enableWaiting(true);this._uiManager.imageManager.getFromId(this.#rK).then(t=>this.#r3(t,true)).finally(()=>this.#r6());return}if(this.#rY){const t=this.#rY;this.#rY=null;this._uiManager.enableWaiting(true);this.#rX=this._uiManager.imageManager.getFromUrl(t).then(t=>this.#r3(t)).finally(()=>this.#r6());return}if(this.#rQ){const t=this.#rQ;this.#rQ=null;this._uiManager.enableWaiting(true);this.#rX=this._uiManager.imageManager.getFromFile(t).then(t=>this.#r3(t)).finally(()=>this.#r6());return}const t=document.createElement("input");t.type="file";t.accept=iW.supportedTypesStr;const e=this._uiManager._signal;this.#rX=new Promise(s=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0){this.remove()}else{this._uiManager.enableWaiting(true);const e=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}});this.#r3(e)}s()},{signal:e});t.addEventListener("cancel",()=>{this.remove();s()},{signal:e})}).finally(()=>this.#r6());t.click()}remove(){if(this.#rK){this.#rq=null;this._uiManager.imageManager.deleteId(this.#rK);this.#rZ?.remove();this.#rZ=null;if(this.#r0){clearTimeout(this.#r0);this.#r0=null}}super.remove()}rebuild(){if(!this.parent){if(this.#rK){this.#r4()}return}super.rebuild();if(this.div===null){return}if(this.#rK&&this.#rZ===null){this.#r4()}if(!this.isAttachedToDOM){this.parent.add(this)}}onceAdded(t){this._isDraggable=true;if(t){this.div.focus()}}isEmpty(){return!(this.#rX||this.#rq||this.#rY||this.#rQ||this.#rK)}get isResizable(){return true}render(){if(this.div){return this.div}let t,e;if(this.width){t=this.x;e=this.y}super.render();this.div.hidden=true;this.div.setAttribute("role","figure");this.addAltTextButton();if(this.#rq){this.#r5()}else{this.#r4()}if(this.width&&!this.annotationElementId){const[s,i]=this.parentDimensions;this.setAt(t*s,e*i,this.width*s,this.height*i)}this._uiManager.addShouldRescale(this);return this.div}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent){return}if(this.#r0!==null){clearTimeout(this.#r0)}const t=200;this.#r0=setTimeout(()=>{this.#r0=null;this.#r8()},t)}#r5(){const{div:t}=this;let{width:e,height:s}=this.#rq;const[i,n]=this.pageDimensions;const r=.75;if(this.width){e=this.width*i;s=this.height*n}else if(e>r*i||s>r*n){const t=Math.min(r*i/e,r*n/s);e*=t;s*=t}const[a,o]=this.parentDimensions;this.setDims(e*a/i,s*o/n);this._uiManager.enableWaiting(false);const l=this.#rZ=document.createElement("canvas");l.setAttribute("role","img");this.addContainer(l);this.width=e/i;this.height=s/n;if(this._initialOptions?.isCentered){this.center()}else{this.fixAndSetPosition()}this._initialOptions=null;if(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId){t.hidden=false}this.#r8();if(!this.#r2){this.parent.addUndoableEditor(this);this.#r2=true}this._reportTelemetry({action:"inserted_image"});if(this.#rJ){l.setAttribute("aria-label",this.#rJ)}}copyCanvas(t,e,s=false){if(!t){t=224}const{width:i,height:n}=this.#rq;const r=new t$;let a=this.#rq;let o=i,l=n;let h=null;if(e){if(i>e||n>e){const t=Math.min(e/i,e/n);o=Math.floor(i*t);l=Math.floor(n*t)}h=document.createElement("canvas");const t=h.width=Math.ceil(o*r.sx);const s=h.height=Math.ceil(l*r.sy);if(!this.#r1){a=this.#r7(t,s)}const c=h.getContext("2d");c.filter=this._uiManager.hcmFilter;let d="white",u="#cfcfd8";if(this._uiManager.hcmFilter!=="none"){u="black"}else if(window.matchMedia?.("(prefers-color-scheme: dark)").matches){d="#8f8f9d";u="#42414d"}const f=15;const p=f*r.sx;const g=f*r.sy;const m=new OffscreenCanvas(p*2,g*2);const b=m.getContext("2d");b.fillStyle=d;b.fillRect(0,0,p*2,g*2);b.fillStyle=u;b.fillRect(0,0,p,g);b.fillRect(p,g,p,g);c.fillStyle=c.createPattern(m,"repeat");c.fillRect(0,0,t,s);c.drawImage(a,0,0,a.width,a.height,0,0,t,s)}let c=null;if(s){let e,s;if(r.symmetric&&a.width<t&&a.height<t){e=a.width;s=a.height}else{a=this.#rq;if(i>t||n>t){const r=Math.min(t/i,t/n);e=Math.floor(i*r);s=Math.floor(n*r);if(!this.#r1){a=this.#r7(e,s)}}}const o=new OffscreenCanvas(e,s);const l=o.getContext("2d",{willReadFrequently:true});l.drawImage(a,0,0,a.width,a.height,0,0,e,s);c={width:e,height:s,data:l.getImageData(0,0,e,s).data}}return{canvas:h,width:o,height:l,imageData:c}}#r7(t,e){const{width:s,height:i}=this.#rq;let n=s;let r=i;let a=this.#rq;while(n>2*t||r>2*e){const s=n;const i=r;if(n>2*t){n=n>=16384?Math.floor(n/2)-1:Math.ceil(n/2)}if(r>2*e){r=r>=16384?Math.floor(r/2)-1:Math.ceil(r/2)}const o=new OffscreenCanvas(n,r);const l=o.getContext("2d");l.drawImage(a,0,0,s,i,0,0,n,r);a=o.transferToImageBitmap()}return a}#r8(){const[t,e]=this.parentDimensions;const{width:s,height:i}=this;const n=new t$;const r=Math.ceil(s*t*n.sx);const a=Math.ceil(i*e*n.sy);const o=this.#rZ;if(!o||o.width===r&&o.height===a){return}o.width=r;o.height=a;const l=this.#r1?this.#rq:this.#r7(r,a);const h=o.getContext("2d");h.filter=this._uiManager.hcmFilter;h.drawImage(l,0,0,l.width,l.height,0,0,r,a)}getImageForAltText(){return this.#rZ}#r9(t){if(t){if(this.#r1){const t=this._uiManager.imageManager.getSvgUrl(this.#rK);if(t){return t}}const t=document.createElement("canvas");({width:t.width,height:t.height}=this.#rq);const e=t.getContext("2d");e.drawImage(this.#rq,0,0);return t.toDataURL()}if(this.#r1){const[t,e]=this.pageDimensions;const s=Math.round(this.width*t*t_.PDF_TO_CSS_UNITS);const i=Math.round(this.height*e*t_.PDF_TO_CSS_UNITS);const n=new OffscreenCanvas(s,i);const r=n.getContext("2d");r.drawImage(this.#rq,0,0,this.#rq.width,this.#rq.height,0,0,s,i);return n.transferToImageBitmap()}return structuredClone(this.#rq)}static async deserialize(t,e,s){let i=null;if(t instanceof iC){const{data:{rect:n,rotation:r,id:a,structParent:o,popupRef:l},container:h,parent:{page:{pageNumber:c}}}=t;const d=h.querySelector("canvas");const u=s.imageManager.getFromCanvas(h.id,d);d.remove();const f=(await e._structTree.getAriaAttributes(`${tb}${a}`))?.get("aria-label")||"";i=t={annotationType:b.STAMP,bitmapId:u.id,bitmap:u.bitmap,pageIndex:c-1,rect:n.slice(0),rotation:r,id:a,deleted:false,accessibilityData:{decorative:false,altText:f},isSvg:false,structParent:o,popupRef:l}}const n=await super.deserialize(t,e,s);const{rect:r,bitmap:a,bitmapUrl:o,bitmapId:l,isSvg:h,accessibilityData:c}=t;if(l&&s.imageManager.isValidId(l)){n.#rK=l;if(a){n.#rq=a}}else{n.#rY=o}n.#r1=h;const[d,u]=n.pageDimensions;n.width=(r[2]-r[0])/d;n.height=(r[3]-r[1])/u;n.annotationElementId=t.id||null;if(c){n.altTextData=c}n._initialData=i;n.#r2=!!i;return n}serialize(t=false,e=null){if(this.isEmpty()){return null}if(this.deleted){return this.serializeDeleted()}const s={annotationType:b.STAMP,bitmapId:this.#rK,pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:this.#r1,structTreeParentId:this._structTreeParentId};if(t){s.bitmapUrl=this.#r9(true);s.accessibilityData=this.serializeAltText(true);return s}const{decorative:i,altText:n}=this.serializeAltText(false);if(!i&&n){s.accessibilityData={type:"Figure",alt:n}}if(this.annotationElementId){const t=this.#nr(s);if(t.isSame){return null}if(t.isSameAltText){delete s.accessibilityData}else{s.accessibilityData.structParent=this._initialData.structParent??-1}}s.id=this.annotationElementId;if(e===null){return s}e.stamps||=new Map;const r=this.#r1?(s.rect[2]-s.rect[0])*(s.rect[3]-s.rect[1]):null;if(!e.stamps.has(this.#rK)){e.stamps.set(this.#rK,{area:r,serialized:s});s.bitmap=this.#r9(false)}else if(this.#r1){const t=e.stamps.get(this.#rK);if(r>t.area){t.area=r;t.serialized.bitmap.close();t.serialized.bitmap=this.#r9(false)}}return s}#nr(t){const{pageIndex:e,accessibilityData:{altText:s}}=this._initialData;const i=t.pageIndex===e;const n=(t.accessibilityData?.alt||"")===s;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&i&&n,isSameAltText:n}}renderAnnotationElement(t){t.updateEdited({rect:this.getRect(0,0)});return null}};class iq{#iJ;#at=false;#ae=null;#as=null;#ai=null;#an=new Map;#ar=false;#aa=false;#ao=false;#al=null;#ah=null;#ac=null;#ad=null;#g;static _initialized=false;static #U=new Map([iI,iV,iW,iH].map(t=>[t._editorType,t]));constructor({uiManager:t,pageIndex:e,div:s,structTreeLayer:i,accessibilityManager:n,annotationLayer:r,drawLayer:a,textLayer:o,viewport:l,l10n:h}){const c=[...iq.#U.values()];if(!iq._initialized){iq._initialized=true;for(const e of c){e.initialize(h,t)}}t.registerEditorTypes(c);this.#g=t;this.pageIndex=e;this.div=s;this.#iJ=n;this.#ae=r;this.viewport=l;this.#ac=o;this.drawLayer=a;this._structTree=i;this.#g.addLayer(this)}get isEmpty(){return this.#an.size===0}get isInvisible(){return this.isEmpty&&this.#g.getMode()===b.NONE}updateToolbar(t){this.#g.updateToolbar(t)}updateMode(t=this.#g.getMode()){this.#au();switch(t){case b.NONE:this.disableTextSelection();this.togglePointerEvents(false);this.toggleAnnotationLayerPointerEvents(true);this.disableClick();return;case b.INK:this.disableTextSelection();this.togglePointerEvents(true);this.enableClick();break;case b.HIGHLIGHT:this.enableTextSelection();this.togglePointerEvents(false);this.disableClick();break;default:this.disableTextSelection();this.togglePointerEvents(true);this.enableClick()}this.toggleAnnotationLayerPointerEvents(false);const{classList:e}=this.div;for(const s of iq.#U.values()){e.toggle(`${s._type}Editing`,t===s._editorType)}this.div.hidden=false}hasTextLayer(t){return t===this.#ac?.div}setEditingState(t){this.#g.setEditingState(t)}addCommands(t){this.#g.addCommands(t)}cleanUndoStack(t){this.#g.cleanUndoStack(t)}toggleDrawing(t=false){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=false){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=false){this.#ae?.div.classList.toggle("disabled",!t)}async enable(){this.#ao=true;this.div.tabIndex=0;this.togglePointerEvents(true);const t=new Set;for(const e of this.#an.values()){e.enableEditing();e.show(true);if(e.annotationElementId){this.#g.removeChangedExistingAnnotation(e);t.add(e.annotationElementId)}}if(!this.#ae){this.#ao=false;return}const e=this.#ae.getEditableAnnotations();for(const s of e){s.hide();if(this.#g.isDeletedAnnotationElement(s.data.id)){continue}if(t.has(s.data.id)){continue}const e=await this.deserialize(s);if(!e){continue}this.addOrRebuild(e);e.enableEditing()}this.#ao=false}disable(){this.#aa=true;this.div.tabIndex=-1;this.togglePointerEvents(false);const t=new Map;const e=new Map;for(const s of this.#an.values()){s.disableEditing();if(!s.annotationElementId){continue}if(s.serialize()!==null){t.set(s.annotationElementId,s);continue}else{e.set(s.annotationElementId,s)}this.getEditableAnnotation(s.annotationElementId)?.show();s.remove()}if(this.#ae){const s=this.#ae.getEditableAnnotations();for(const i of s){const{id:s}=i.data;if(this.#g.isDeletedAnnotationElement(s)){continue}let n=e.get(s);if(n){n.resetAnnotationElement(i);n.show(false);i.show();continue}n=t.get(s);if(n){this.#g.addChangedExistingAnnotation(n);if(n.renderAnnotationElement(i)){n.show(false)}}i.show()}}this.#au();if(this.isEmpty){this.div.hidden=true}const{classList:s}=this.div;for(const t of iq.#U.values()){s.remove(`${t._type}Editing`)}this.disableTextSelection();this.toggleAnnotationLayerPointerEvents(true);this.#aa=false}getEditableAnnotation(t){return this.#ae?.getEditableAnnotation(t)||null}setActiveEditor(t){const e=this.#g.getActive();if(e===t){return}this.#g.setActiveEditor(t)}enableTextSelection(){this.div.tabIndex=-1;if(this.#ac?.div&&!this.#ad){this.#ad=new AbortController;const t=this.#g.combinedSignal(this.#ad);this.#ac.div.addEventListener("pointerdown",this.#af.bind(this),{signal:t});this.#ac.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0;if(this.#ac?.div&&this.#ad){this.#ad.abort();this.#ad=null;this.#ac.div.classList.remove("highlighting")}}#af(t){this.#g.unselectAll();const{target:e}=t;if(e===this.#ac.div||(e.getAttribute("role")==="img"||e.classList.contains("endOfContent"))&&this.#ac.div.contains(e)){const{isMac:e}=tn.platform;if(t.button!==0||t.ctrlKey&&e){return}this.#g.showAllEditors("highlight",true,true);this.#ac.div.classList.add("free");this.toggleDrawing();iH.startHighlighting(this,this.#g.direction==="ltr",{target:this.#ac.div,x:t.x,y:t.y});this.#ac.div.addEventListener("pointerup",()=>{this.#ac.div.classList.remove("free");this.toggleDrawing(true)},{once:true,signal:this.#g._signal});t.preventDefault()}}enableClick(){if(this.#as){return}this.#as=new AbortController;const t=this.#g.combinedSignal(this.#as);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t});const e=this.pointerup.bind(this);this.div.addEventListener("pointerup",e,{signal:t});this.div.addEventListener("pointercancel",e,{signal:t})}disableClick(){this.#as?.abort();this.#as=null}attach(t){this.#an.set(t.id,t);const{annotationElementId:e}=t;if(e&&this.#g.isDeletedAnnotationElement(e)){this.#g.removeDeletedAnnotationElement(t)}}detach(t){this.#an.delete(t.id);this.#iJ?.removePointerInTextLayer(t.contentDiv);if(!this.#aa&&t.annotationElementId){this.#g.addDeletedAnnotationElement(t)}}remove(t){this.detach(t);this.#g.removeEditor(t);t.div.remove();t.isAttachedToDOM=false}changeParent(t){if(t.parent===this){return}if(t.parent&&t.annotationElementId){this.#g.addDeletedAnnotationElement(t.annotationElementId);t1.deleteAnnotationElement(t);t.annotationElementId=null}this.attach(t);t.parent?.detach(t);t.setParent(this);if(t.div&&t.isAttachedToDOM){t.div.remove();this.div.append(t.div)}}add(t){if(t.parent===this&&t.isAttachedToDOM){return}this.changeParent(t);this.#g.addEditor(t);this.attach(t);if(!t.isAttachedToDOM){const e=t.render();this.div.append(e);t.isAttachedToDOM=true}t.fixAndSetPosition();t.onceAdded(!this.#ao);this.#g.addToAnnotationStorage(t);t._reportTelemetry(t.telemetryInitialData)}moveEditorInDOM(t){if(!t.isAttachedToDOM){return}const{activeElement:e}=document;if(t.div.contains(e)&&!this.#ai){t._focusEventsAllowed=false;this.#ai=setTimeout(()=>{this.#ai=null;if(!t.div.contains(document.activeElement)){t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=true},{once:true,signal:this.#g._signal});e.focus()}else{t._focusEventsAllowed=true}},0)}t._structTreeParentId=this.#iJ?.moveElementInDOM(this.div,t.div,t.contentDiv,true)}addOrRebuild(t){if(t.needsToBeRebuilt()){t.parent||=this;t.rebuild();t.show()}else{this.add(t)}}addUndoableEditor(t){const e=()=>t._uiManager.rebuild(t);const s=()=>{t.remove()};this.addCommands({cmd:e,undo:s,mustExec:false})}getNextId(){return this.#g.getId()}get #ap(){return iq.#U.get(this.#g.getMode())}combinedSignal(t){return this.#g.combinedSignal(t)}#ag(t){const e=this.#ap;return e?new e.prototype.constructor(t):null}canCreateNewEmptyEditor(){return this.#ap?.canCreateNewEmptyEditor()}pasteEditor(t,e){this.#g.updateToolbar(t);this.#g.updateMode(t);const{offsetX:s,offsetY:i}=this.#am();const n=this.getNextId();const r=this.#ag({parent:this,id:n,x:s,y:i,uiManager:this.#g,isCentered:true,...e});if(r){this.add(r)}}async deserialize(t){return await iq.#U.get(t.annotationType??t.annotationEditorType)?.deserialize(t,this,this.#g)||null}createAndAddNewEditor(t,e,s={}){const i=this.getNextId();const n=this.#ag({parent:this,id:i,x:t.offsetX,y:t.offsetY,uiManager:this.#g,isCentered:e,...s});if(n){this.add(n)}return n}#am(){const{x:t,y:e,width:s,height:i}=this.div.getBoundingClientRect();const n=Math.max(0,t);const r=Math.max(0,e);const a=Math.min(window.innerWidth,t+s);const o=Math.min(window.innerHeight,e+i);const l=(n+a)/2-t;const h=(r+o)/2-e;const[c,d]=this.viewport.rotation%180===0?[l,h]:[h,l];return{offsetX:c,offsetY:d}}addNewEditor(){this.createAndAddNewEditor(this.#am(),true)}setSelected(t){this.#g.setSelected(t)}toggleSelected(t){this.#g.toggleSelected(t)}unselect(t){this.#g.unselect(t)}pointerup(t){const{isMac:e}=tn.platform;if(t.button!==0||t.ctrlKey&&e){return}if(t.target!==this.div){return}if(!this.#ar){return}this.#ar=false;if(this.#ap?.isDrawer&&this.#ap.supportMultipleDrawings){return}if(!this.#at){this.#at=true;return}if(this.#g.getMode()===b.STAMP){this.#g.unselectAll();return}this.createAndAddNewEditor(t,false)}pointerdown(t){if(this.#g.getMode()===b.HIGHLIGHT){this.enableTextSelection()}if(this.#ar){this.#ar=false;return}const{isMac:e}=tn.platform;if(t.button!==0||t.ctrlKey&&e){return}if(t.target!==this.div){return}this.#ar=true;if(this.#ap?.isDrawer){this.startDrawingSession(t);return}const s=this.#g.getActive();this.#at=!s||s.isEmpty()}startDrawingSession(t){this.div.focus();if(this.#al){this.#ap.startDrawing(this,this.#g,false,t);return}this.#g.setCurrentDrawingSession(this);this.#al=new AbortController;const e=this.#g.combinedSignal(this.#al);this.div.addEventListener("blur",({relatedTarget:t})=>{if(t&&!this.div.contains(t)){this.#ah=null;this.commitOrRemove()}},{signal:e});this.#ap.startDrawing(this,this.#g,false,t)}pause(t){if(t){const{activeElement:t}=document;if(this.div.contains(t)){this.#ah=t}return}if(this.#ah){setTimeout(()=>{this.#ah?.focus();this.#ah=null},0)}}endDrawingSession(t=false){if(!this.#al){return null}this.#g.setCurrentDrawingSession(null);this.#al.abort();this.#al=null;this.#ah=null;return this.#ap.endDrawing(t)}findNewParent(t,e,s){const i=this.#g.findParent(e,s);if(i===null||i===this){return false}i.changeParent(t);return true}commitOrRemove(){if(this.#al){this.endDrawingSession();return true}return false}onScaleChanging(){if(!this.#al){return}this.#ap.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove();if(this.#g.getActive()?.parent===this){this.#g.commitOrRemove();this.#g.setActiveEditor(null)}if(this.#ai){clearTimeout(this.#ai);this.#ai=null}for(const t of this.#an.values()){this.#iJ?.removePointerInTextLayer(t.contentDiv);t.setParent(null);t.isAttachedToDOM=false;t.div.remove()}this.div=null;this.#an.clear();this.#g.removeLayer(this)}#au(){for(const t of this.#an.values()){if(t.isEmpty()){t.remove()}}}render({viewport:t}){this.viewport=t;tU(this.div,t);for(const t of this.#g.getEditors(this.pageIndex)){this.add(t);t.rebuild()}this.updateMode()}update({viewport:t}){this.#g.commitOrRemove();this.#au();const e=this.viewport.rotation;const s=t.rotation;this.viewport=t;tU(this.div,{rotation:s});if(e!==s){for(const t of this.#an.values()){t.rotate(s)}}}get pageDimensions(){const{pageWidth:t,pageHeight:e}=this.viewport.rawDims;return[t,e]}get scale(){return this.#g.viewParameters.realScale}};class iK{#iI=null;#v=0;#ab=new Map;#aA=new Map;constructor({pageIndex:t}){this.pageIndex=t}setParent(t){if(!this.#iI){this.#iI=t;return}if(this.#iI!==t){if(this.#ab.size>0){for(const e of this.#ab.values()){e.remove();t.append(e)}}this.#iI=t}}static get _svgFactory(){return $(this,"_svgFactory",new s3)}static #av(t,[e,s,i,n]){const{style:r}=t;r.top=`${100*s}%`;r.left=`${100*e}%`;r.width=`${100*i}%`;r.height=`${100*n}%`}#ay(){const t=iK._svgFactory.create(1,1,true);this.#iI.append(t);t.setAttribute("aria-hidden",true);return t}#aw(t,e){const s=iK._svgFactory.createElement("clipPath");t.append(s);const i=`clip_${e}`;s.setAttribute("id",i);s.setAttribute("clipPathUnits","objectBoundingBox");const n=iK._svgFactory.createElement("use");s.append(n);n.setAttribute("href",`#${e}`);n.classList.add("clip");return i}#a_(t,e){for(const[s,i]of Object.entries(e)){if(i===null){t.removeAttribute(s)}else{t.setAttribute(s,i)}}}draw(t,e=false,s=false){const i=this.#v++;const n=this.#ay();const r=iK._svgFactory.createElement("defs");n.append(r);const a=iK._svgFactory.createElement("path");r.append(a);const o=`path_p${this.pageIndex}_${i}`;a.setAttribute("id",o);a.setAttribute("vector-effect","non-scaling-stroke");if(e){this.#aA.set(i,a)}const l=s?this.#aw(r,o):null;const h=iK._svgFactory.createElement("use");n.append(h);h.setAttribute("href",`#${o}`);this.updateProperties(n,t);this.#ab.set(i,n);return{id:i,clipPathId:`url(#${l})`}}drawOutline(t,e){const s=this.#v++;const i=this.#ay();const n=iK._svgFactory.createElement("defs");i.append(n);const r=iK._svgFactory.createElement("path");n.append(r);const a=`path_p${this.pageIndex}_${s}`;r.setAttribute("id",a);r.setAttribute("vector-effect","non-scaling-stroke");let o;if(e){const t=iK._svgFactory.createElement("mask");n.append(t);o=`mask_p${this.pageIndex}_${s}`;t.setAttribute("id",o);t.setAttribute("maskUnits","objectBoundingBox");const e=iK._svgFactory.createElement("rect");t.append(e);e.setAttribute("width","1");e.setAttribute("height","1");e.setAttribute("fill","white");const i=iK._svgFactory.createElement("use");t.append(i);i.setAttribute("href",`#${a}`);i.setAttribute("stroke","none");i.setAttribute("fill","black");i.setAttribute("fill-rule","nonzero");i.classList.add("mask")}const l=iK._svgFactory.createElement("use");i.append(l);l.setAttribute("href",`#${a}`);if(o){l.setAttribute("mask",`url(#${o})`)}const h=l.cloneNode();i.append(h);l.classList.add("mainOutline");h.classList.add("secondaryOutline");this.updateProperties(i,t);this.#ab.set(s,i);return s}finalizeDraw(t,e){this.#aA.delete(t);this.updateProperties(t,e)}updateProperties(t,e){if(!e){return}const{root:s,bbox:i,rootClass:n,path:r}=e;const a=typeof t==="number"?this.#ab.get(t):t;if(!a){return}if(s){this.#a_(a,s)}if(i){iK.#av(a,i)}if(n){const{classList:t}=a;for(const[e,s]of Object.entries(n)){t.toggle(e,s)}}if(r){const t=a.firstChild;const e=t.firstChild;this.#a_(e,r)}}updateParent(t,e){if(e===this){return}const s=this.#ab.get(t);if(!s){return}e.#iI.append(s);this.#ab.delete(t);e.#ab.set(t,s)}remove(t){this.#aA.delete(t);if(this.#iI===null){return}this.#ab.get(t).remove();this.#ab.delete(t)}destroy(){this.#iI=null;for(const t of this.#ab.values()){t.remove()}this.#ab.clear();this.#aA.clear()}};const iX="4.10.38";const iY="f9bea397f";{globalThis.pdfjsTestingUtils={HighlightOutliner:iL}}var iQ=a.AbortException;var iJ=a.AnnotationEditorLayer;var iZ=a.AnnotationEditorParamsType;var i0=a.AnnotationEditorType;var i1=a.AnnotationEditorUIManager;var i2=a.AnnotationLayer;var i3=a.AnnotationMode;var i5=a.ColorPicker;var i6=a.DOMSVGFactory;var i4=a.DrawLayer;var i8=a.FeatureTest;var i7=a.GlobalWorkerOptions;var i9=a.ImageKind;var nt=a.InvalidPDFException;var ne=a.MissingPDFException;var ns=a.OPS;var ni=a.OutputScale;var nn=a.PDFDataRangeTransport;var nr=a.PDFDateString;var na=a.PDFWorker;var no=a.PasswordResponses;var nl=a.PermissionFlag;var nh=a.PixelsPerInch;var nc=a.RenderingCancelledException;var nd=a.TextLayer;var nu=a.TouchManager;var nf=a.UnexpectedResponseException;var np=a.Util;var ng=a.VerbosityLevel;var nm=a.XfaLayer;var nb=a.build;var nA=a.createValidAbsoluteUrl;var nv=a.fetchData;var ny=a.getDocument;var nw=a.getFilenameFromUrl;var n_=a.getPdfFilenameFromUrl;var nx=a.getXfaPageViewport;var nE=a.isDataScheme;var nS=a.isPdfFile;var nC=a.noContextMenu;var nT=a.normalizeUnicode;var nM=a.setLayerDimensions;var nP=a.shadow;var nI=a.stopEvent;var nR=a.version}}]);